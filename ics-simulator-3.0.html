<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Philippine Incident Command System Training Simulator - RA 10121, RA 12287 Compliant">
<meta name="theme-color" content="#020617">
<title>ICS Simulator-3.0</title>
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com/3.4.17"></script>
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<!-- SDK Scripts -->
<script src="/_sdk/element_sdk.js"></script>
<script src="/_sdk/data_sdk.js"></script>
<script>
tailwind.config = {
theme: {
extend: {
colors: {
slate: { 850: '#151f32', 950: '#020617' },
blue: { 450: '#3b82f6', 550: '#2563eb', 650: '#1d4ed8' }
},
fontFamily: {
sans: ['Roboto Condensed', 'sans-serif']
},
animation: {
'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
'gradient-flow': 'gradientFlow 15s ease infinite',
'scanline': 'scanline 3s linear infinite',
'fade-in': 'fadeIn 0.6s ease forwards',
'pulse-alert': 'pulseAlert 1s ease-in-out infinite',
'float': 'float 3s ease-in-out infinite',
'slide-in': 'slideIn 0.3s ease-out'
},
keyframes: {
gradientFlow: {
'0%, 100%': { backgroundPosition: '0% 50%' },
'50%': { backgroundPosition: '100% 50%' }
},
scanline: {
'0%': { transform: 'translateY(-100%)' },
'100%': { transform: 'translateY(100%)' }
},
fadeIn: {
'from': { opacity: '0', transform: 'translateY(20px)' },
'to': { opacity: '1', transform: 'translateY(0)' }
},
pulseAlert: {
'0%, 100%': { opacity: 1 },
'50%': { opacity: 0.5 }
},
float: {
'0%, 100%': { transform: 'translateY(0)' },
'50%': { transform: 'translateY(-5px)' }
},
slideIn: {
'from': { transform: 'translateX(100%)', opacity: 0 },
'to': { transform: 'translateX(0)', opacity: 1 }
}
}
}
}
}
</script>
<style>
* { font-family: 'Roboto Condensed', sans-serif; box-sizing: border-box; }

/* ===== DESIGN SYSTEM - Apple HIG Compliant ===== */
.glass-panel {
background: linear-gradient(135deg,
rgba(30, 58, 138, 0.15) 0%,
rgba(59, 130, 246, 0.08) 50%,
rgba(30, 58, 138, 0.12) 100%);
backdrop-filter: blur(20px) saturate(180%);
-webkit-backdrop-filter: blur(20px) saturate(180%);
border: 1px solid rgba(147, 197, 253, 0.3);
box-shadow: 0 8px 32px rgba(30, 58, 138, 0.15),
inset 0 1px 0 rgba(255, 255, 255, 0.2),
inset 0 -1px 0 rgba(30, 58, 138, 0.1);
}

.glass-card {
background: linear-gradient(145deg,
rgba(59, 130, 246, 0.12) 0%,
rgba(30, 58, 138, 0.08) 100%);
backdrop-filter: blur(16px) saturate(150%);
-webkit-backdrop-filter: blur(16px) saturate(150%);
border: 1px solid rgba(147, 197, 253, 0.25);
border-radius: 16px;
box-shadow: 0 4px 24px rgba(30, 58, 138, 0.12),
inset 0 1px 0 rgba(255, 255, 255, 0.15);
transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.glass-card:hover {
transform: translateY(-4px) scale(1.02);
box-shadow: 0 12px 40px rgba(59, 130, 246, 0.25),
inset 0 1px 0 rgba(255, 255, 255, 0.25);
border-color: rgba(147, 197, 253, 0.5);
}

.glass-button {
background: linear-gradient(135deg,
rgba(59, 130, 246, 0.9) 0%,
rgba(37, 99, 235, 0.95) 100%);
backdrop-filter: blur(10px);
border: 1px solid rgba(147, 197, 253, 0.4);
border-radius: 12px;
box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4),
inset 0 1px 0 rgba(255, 255, 255, 0.2);
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.glass-button:hover:not(:disabled) {
transform: translateY(-2px);
box-shadow: 0 8px 30px rgba(59, 130, 246, 0.5),
inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

.glass-button:disabled {
opacity: 0.5;
cursor: not-allowed;
}

.glass-input {
background: rgba(30, 58, 138, 0.1);
backdrop-filter: blur(10px);
border: 1px solid rgba(147, 197, 253, 0.3);
border-radius: 12px;
transition: all 0.3s ease;
}

.glass-input:focus {
border-color: rgba(59, 130, 246, 0.6);
box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
outline: none;
}

/* ===== BACKGROUND EFFECTS ===== */
.grid-bg {
background-image:
linear-gradient(rgba(59, 130, 246, 0.03) 1px, transparent 1px),
linear-gradient(90deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px);
background-size: 40px 40px;
}

.animated-bg {
background: linear-gradient(135deg,
#020617 0%,
#0f172a 25%,
#1e293b 50%,
#0f172a 75%,
#020617 100%);
background-size: 400% 400%;
animation: gradient-flow 15s ease infinite;
}

/* ===== VISUAL EFFECTS ===== */
.glow-text {
text-shadow: 0 0 20px rgba(59, 130, 246, 0.5), 0 0 40px rgba(59, 130, 246, 0.3);
}

.glow-border {
box-shadow: 0 0 15px rgba(59, 130, 246, 0.3), inset 0 0 15px rgba(59, 130, 246, 0.1);
}

.scanline::after {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
height: 4px;
background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.4), transparent);
animation: scanline 3s linear infinite;
pointer-events: none;
}

.pulse-glow {
animation: pulse-glow 2s ease-in-out infinite;
}

@keyframes pulse-glow {
0%, 100% { opacity: 1; box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
50% { opacity: 0.8; box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); }
}

/* ===== MAP STYLES - Enhanced Grid System ===== */
.map-container {
background: linear-gradient(180deg,
rgba(0, 82, 165, 0.1) 0%,
rgba(0, 102, 204, 0.05) 100%);
border-radius: 16px;
overflow: hidden;
position: relative;
}

.map-grid {
display: grid;
grid-template-columns: repeat(12, 1fr);
grid-template-rows: repeat(6, 1fr);
gap: 2px;
background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
padding: 8px;
border-radius: 12px;
border: 2px solid rgba(147, 197, 253, 0.3);
min-height: 300px;
}

.map-cell {
aspect-ratio: 1;
border-radius: 6px;
transition: all 0.3s ease;
cursor: pointer;
position: relative;
overflow: hidden;
display: flex;
align-items: center;
justify-content: center;
font-size: 20px;
box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.map-cell:hover {
transform: scale(1.15);
z-index: 10;
box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
}

.map-cell-water {
background: linear-gradient(135deg, #0369a1 0%, #0284c7 100%);
border: 1px solid rgba(56, 189, 248, 0.5);
}

.map-cell-land {
background: linear-gradient(135deg, #15803d 0%, #22c55e 100%);
border: 1px solid rgba(74, 222, 128, 0.5);
}

.map-cell-urban {
background: linear-gradient(135deg, #475569 0%, #64748b 100%);
border: 1px solid rgba(148, 163, 184, 0.5);
}

.map-cell-flooded {
background: linear-gradient(135deg, #6d28d9 0%, #7c3aed 100%);
border: 2px solid rgba(167, 139, 250, 0.8);
animation: pulse-alert 2s ease-in-out infinite;
}

.map-cell-affected {
background: linear-gradient(135deg, #b91c1c 0%, #dc2626 100%);
border: 2px solid rgba(252, 165, 165, 0.8);
animation: pulse-alert 1.5s ease-in-out infinite;
}

.map-cell-evacuated {
background: linear-gradient(135deg, #b45309 0%, #d97706 100%);
border: 2px solid rgba(253, 215, 170, 0.8);
}

.map-cell-safe {
background: linear-gradient(135deg, #047857 0%, #10b981 100%);
border: 2px solid rgba(110, 231, 183, 0.8);
}

.map-cell-label {
position: absolute;
bottom: 2px;
right: 2px;
background: rgba(0, 0, 0, 0.7);
color: white;
font-size: 7px;
padding: 2px 4px;
border-radius: 2px;
opacity: 0;
transition: opacity 0.2s ease;
}

.map-cell:hover .map-cell-label {
opacity: 1;
}

.map-tools-panel {
position: absolute;
top: 12px;
right: 12px;
display: flex;
flex-direction: column;
gap: 8px;
z-index: 10;
}

.map-tool-btn {
background: rgba(2, 6, 23, 0.85);
backdrop-filter: blur(12px);
border: 1px solid rgba(59, 130, 246, 0.4);
border-radius: 8px;
padding: 8px 12px;
color: white;
font-size: 11px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
display: flex;
align-items: center;
gap: 6px;
white-space: nowrap;
}

.map-tool-btn:hover {
background: rgba(59, 130, 246, 0.3);
border-color: rgba(59, 130, 246, 0.7);
transform: translateX(-2px);
}

.map-tool-btn svg {
width: 14px;
height: 14px;
}

.map-legend {
background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
border: 2px solid rgba(71, 85, 99, 0.5);
border-radius: 12px;
padding: 12px;
max-height: 350px;
overflow-y: auto;
}

.legend-title {
font-weight: bold;
color: #fbbf24;
margin-bottom: 12px;
font-size: 13px;
display: flex;
align-items: center;
gap: 6px;
}

.legend-section {
margin-bottom: 14px;
padding-bottom: 12px;
border-bottom: 1px solid rgba(51, 65, 85, 0.5);
}

.legend-section:last-child {
border-bottom: none;
margin-bottom: 0;
}

.legend-item {
display: flex;
align-items: center;
gap: 8px;
margin-bottom: 8px;
font-size: 11px;
padding: 6px;
border-radius: 4px;
transition: all 0.2s ease;
cursor: help;
}

.legend-item:hover {
background: rgba(251, 191, 36, 0.1);
}

.legend-color-box {
width: 20px;
height: 20px;
border-radius: 4px;
border: 1px solid rgba(255, 255, 255, 0.3);
flex-shrink: 0;
}

.legend-text {
color: #e2e8f0;
font-size: 11px;
flex: 1;
}

.hazard-marker {
position: absolute;
width: 24px;
height: 24px;
border-radius: 50%;
animation: pulse 2s infinite;
cursor: pointer;
transition: transform 0.3s ease;
}

.hazard-marker:hover {
transform: scale(1.3);
}

@keyframes pulse {
0%, 100% { transform: scale(1); opacity: 1; }
50% { transform: scale(1.2); opacity: 0.7; }
}

/* ===== PROGRESS & SCORES ===== */
.progress-ring {
transform: rotate(-90deg);
}

.progress-ring circle {
transition: stroke-dashoffset 0.5s ease;
}

.score-bar {
transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
}

.progress-bar {
transition: width 0.5s ease;
}

/* ===== ACCESSIBILITY ===== */
@media (prefers-reduced-motion: reduce) {
*, *::before, *::after {
animation-duration: 0.01ms !important;
animation-iteration-count: 1 !important;
transition-duration: 0.01ms !important;
}
}

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 4px; }
::-webkit-scrollbar-thumb { background: rgba(59, 130, 246, 0.5); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: rgba(59, 130, 246, 0.7); }

.scrollbar-thin::-webkit-scrollbar { width: 6px; }
.scrollbar-thin::-webkit-scrollbar-track { background: #1e293b; }
.scrollbar-thin::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }

/* ===== TOAST NOTIFICATIONS - Enhanced ===== */
.toast {
animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideIn {
from { transform: translateX(100%); opacity: 0; }
to { transform: translateX(0); opacity: 1; }
}

/* ===== ROLE CARDS ===== */
.role-card {
position: relative;
overflow: hidden;
}

.role-card::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg,
transparent 0%,
rgba(255, 255, 255, 0.1) 50%,
transparent 100%);
transition: left 0.6s ease;
}

.role-card:hover::before {
left: 100%;
}

/* ===== TIMER CRITICAL ===== */
.timer-critical {
animation: timerPulse 0.5s ease infinite;
}

@keyframes timerPulse {
0%, 100% { color: #ef4444; }
50% { color: #fbbf24; }
}

/* ===== FADE IN ANIMATIONS ===== */
.fade-in { animation: fadeIn 0.6s ease forwards; }
.fade-in-delay-1 { animation-delay: 0.1s; opacity: 0; }
.fade-in-delay-2 { animation-delay: 0.2s; opacity: 0; }
.fade-in-delay-3 { animation-delay: 0.3s; opacity: 0; }
.fade-in-delay-4 { animation-delay: 0.4s; opacity: 0; }

/* ===== TOOLTIPS ===== */
.tooltip {
visibility: hidden;
opacity: 0;
transition: all 0.2s ease;
pointer-events: none;
z-index: 100;
}

.has-tooltip:hover .tooltip {
visibility: visible;
opacity: 1;
}

.tooltip-content {
background: #0f172a;
border: 1px solid rgba(71, 85, 99, 0.8);
padding: 8px 12px;
border-radius: 6px;
font-size: 11px;
color: #e2e8f0;
white-space: nowrap;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

/* ===== RESOURCE CARDS ===== */
.resource-card {
transition: all 0.2s ease;
}

.resource-card:hover:not(:disabled) {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.resource-card:disabled {
opacity: 0.5;
cursor: not-allowed;
}

/* ===== DECISION BUTTONS ===== */
.decision-btn {
transition: all 0.2s ease;
}

.decision-btn:hover {
transform: scale(1.02);
}

/* ===== STAT CARDS ===== */
.stat-card {
transition: all 0.3s ease;
}

.stat-card:hover {
transform: translateY(-2px);
box-shadow: 0 8px 24px rgba(59, 130, 246, 0.2);
}

/* ===== COMM LOG ===== */
.comm-log-entry {
animation: slideIn 0.3s ease-out;
}

/* ===== ALERT BADGES ===== */
.alert-badge {
animation: pulse-alert 2s ease-in-out infinite;
}
</style>
</head>
<body class="h-full bg-slate-950 text-white overflow-auto grid-bg">
<div id="app" class="min-h-full w-full relative">
<!-- Ambient Glow Effects -->
<div class="fixed top-0 left-1/4 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl pointer-events-none"></div>
<div class="fixed bottom-0 right-1/4 w-80 h-80 bg-blue-600/10 rounded-full blur-3xl pointer-events-none"></div>

<!-- Toast Container -->
<div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

<!-- Main Navigation -->
<nav class="glass-panel sticky top-0 z-40 px-4 md:px-6 py-4 scanline">
<div class="max-w-7xl mx-auto flex items-center justify-between flex-wrap gap-4">
<div class="flex items-center gap-3">
<div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center shadow-lg glow-border float-animation">
<svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
</svg>
</div>
<div>
<h1 id="nav-title" class="text-xl font-bold text-white glow-text">ICS SIMULATOR</h1>
<p class="text-xs text-blue-300/80">NDRRMC Compliant Training Platform</p>
</div>
</div>
<div class="flex items-center gap-2 md:gap-4">
<button onclick="App.showScreen('leaderboard')" class="text-blue-300/80 hover:text-white transition-colors px-3 py-2 rounded-lg hover:bg-white/10 text-sm has-tooltip relative" aria-label="View Leaderboard">
üèÜ Leaderboard
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content">View training records and rankings</div>
</div>
</button>
<button onclick="App.showScreen('learn')" class="text-blue-300/80 hover:text-white transition-colors px-3 py-2 rounded-lg hover:bg-white/10 text-sm has-tooltip relative" aria-label="Learn ICS">
üìö Learn ICS
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content">Study ICS protocols and guidelines</div>
</div>
</button>
<button onclick="App.showScreen('home')" class="text-blue-300/80 hover:text-white transition-colors px-3 py-2 rounded-lg hover:bg-white/10 text-sm has-tooltip relative" aria-label="Home">
üè† Home
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content">Return to main menu</div>
</div>
</button>
</div>
</div>
</nav>

<!-- Main Content Area -->
<main class="relative z-10 p-4 md:p-8 max-w-7xl mx-auto">
<!-- ===== HOME SCREEN ===== -->
<section id="home-screen" class="space-y-8">
<!-- Hero Section -->
<div class="glass-card p-6 md:p-8 fade-in">
<div class="flex flex-col lg:flex-row items-center gap-8">
<div class="flex-1">
<h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-4 leading-tight glow-text">Master Incident Command</h2>
<p class="text-blue-300/80 text-lg mb-6 leading-relaxed">
Train with real-world scenarios based on <strong>Philippine DRRM Law (RA 10121)</strong>,
<strong>RA 12287</strong>, and the <strong>National Incident Command System</strong>.
Integrated with GeoRiskPH HazardHunter mapping and enhanced with real-time statistics tracking.
</p>
<div class="flex flex-wrap gap-4">
<button onclick="App.showScreen('mode-select')" class="glass-button px-6 md:px-8 py-3 md:py-4 text-white font-semibold text-base md:text-lg pulse-glow">
üéÆ Start Training
</button>
<button onclick="App.showScreen('learn')" class="glass-card px-6 md:px-8 py-3 md:py-4 text-white font-medium hover:bg-white/20">
üìö Learn ICS
</button>
</div>
</div>
<div class="flex-1 max-w-md w-full">
<!-- Interactive Map Preview -->
<div class="map-container aspect-square glass-card p-4">
<!-- GeoRiskPH Map Tools -->
<div class="map-tools-panel">
<a href="https://hazardhunter.georisk.gov.ph/map" target="_blank" rel="noopener noreferrer" class="map-tool-btn has-tooltip relative" title="City/Municipality Hazard Mapping">
<svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
</svg>
City/Municipality
<div class="tooltip absolute right-full top-1/2 -translate-y-1/2 mr-2">
<div class="tooltip-content">Official GeoRiskPH hazard mapping</div>
</div>
</a>
<a href="https://geoanalytics.georisk.gov.ph/" target="_blank" rel="noopener noreferrer" class="map-tool-btn has-tooltip relative" title="Barangay Level Hazard Mapping">
<svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
</svg>
Barangay Level
<div class="tooltip absolute right-full top-1/2 -translate-y-1/2 mr-2">
<div class="tooltip-content">Barangay-level analytics</div>
</div>
</a>
</div>
<svg viewBox="0 0 400 400" class="w-full h-full" role="img" aria-label="Philippine Hazard Map">
<defs>
<linearGradient id="landGrad" x1="0%" y1="0%" x2="100%" y2="100%">
<stop offset="0%" style="stop-color:rgba(255,255,255,0.3)"/>
<stop offset="100%" style="stop-color:rgba(255,255,255,0.1)"/>
</linearGradient>
<filter id="glow">
<feGaussianBlur stdDeviation="3" result="coloredBlur"/>
<feMerge>
<feMergeNode in="coloredBlur"/>
<feMergeNode in="SourceGraphic"/>
</feMerge>
</filter>
</defs>
<rect width="400" height="400" fill="rgba(0,82,165,0.2)" rx="16"/>
<!-- Luzon -->
<path d="M180 40 L220 50 L240 80 L250 120 L240 160 L220 180 L180 190 L150 170 L140 130 L150 80 Z"
fill="url(#landGrad)" stroke="rgba(255,255,255,0.5)" stroke-width="2"/>
<!-- Visayas -->
<path d="M120 220 L180 210 L220 230 L200 260 L150 270 L120 250 Z"
fill="url(#landGrad)" stroke="rgba(255,255,255,0.5)" stroke-width="2"/>
<path d="M230 220 L280 230 L290 260 L260 280 L230 260 Z"
fill="url(#landGrad)" stroke="rgba(255,255,255,0.5)" stroke-width="2"/>
<!-- Mindanao -->
<path d="M140 300 L200 290 L260 300 L280 340 L260 370 L200 380 L150 360 L130 330 Z"
fill="url(#landGrad)" stroke="rgba(255,255,255,0.5)" stroke-width="2"/>
<!-- Hazard Markers -->
<circle cx="200" cy="130" r="12" fill="#ef4444" filter="url(#glow)" opacity="0.9">
<animate attributeName="r" values="12;16;12" dur="2s" repeatCount="indefinite"/>
</circle>
<circle cx="170" cy="240" r="10" fill="#f59e0b" filter="url(#glow)" opacity="0.9">
<animate attributeName="r" values="10;14;10" dur="2.5s" repeatCount="indefinite"/>
</circle>
<circle cx="220" cy="340" r="11" fill="#ef4444" filter="url(#glow)" opacity="0.9">
<animate attributeName="r" values="11;15;11" dur="1.8s" repeatCount="indefinite"/>
</circle>
<!-- Legend -->
<rect x="20" y="340" width="100" height="50" rx="8" fill="rgba(0,0,0,0.3)"/>
<circle cx="35" cy="355" r="5" fill="#ef4444"/>
<text x="45" y="359" fill="white" font-size="10">High Risk</text>
<circle cx="35" cy="375" r="5" fill="#f59e0b"/>
<text x="45" y="379" fill="white" font-size="10">Moderate</text>
</svg>
</div>
</div>
</div>
</div>

<!-- Features Grid -->
<div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
<div class="glass-card p-6 text-center fade-in fade-in-delay-1">
<div class="text-4xl mb-3">üéØ</div>
<h3 class="text-white font-bold text-lg mb-2">Role-Based Training</h3>
<p class="text-blue-300/70 text-sm">Practice as Incident Commander, Operations, Planning, Logistics, or Finance Chief per NDRRMC guidelines</p>
</div>
<div class="glass-card p-6 text-center fade-in fade-in-delay-2">
<div class="text-4xl mb-3">üó∫Ô∏è</div>
<h3 class="text-white font-bold text-lg mb-2">GeoRiskPH Integration</h3>
<p class="text-blue-300/70 text-sm">Real hazard data from HazardHunterPH for authentic scenarios</p>
</div>
<div class="glass-card p-6 text-center fade-in fade-in-delay-3">
<div class="text-4xl mb-3">üë•</div>
<h3 class="text-white font-bold text-lg mb-2">Single & Multi-Player</h3>
<p class="text-blue-300/70 text-sm">Train individually or collaborate with team members in coordinated response</p>
</div>
<div class="glass-card p-6 text-center fade-in fade-in-delay-4">
<div class="text-4xl mb-3">üèõÔ∏è</div>
<h3 class="text-white font-bold text-lg mb-2">PH Standards</h3>
<p class="text-blue-300/70 text-sm">RA 10121, RA 12287, and NDRRMC protocols compliant</p>
</div>
</div>

<!-- Quick Stats -->
<div class="glass-card p-6">
<h3 class="text-white font-bold text-xl mb-4">üìà Training Statistics</h3>
<div id="stats-display" class="grid grid-cols-2 md:grid-cols-4 gap-4">
<div class="text-center p-4 bg-white/10 rounded-xl stat-card">
<div class="text-3xl font-bold text-white" id="stat-sessions">0</div>
<div class="text-blue-300/70 text-sm">Sessions Completed</div>
</div>
<div class="text-center p-4 bg-white/10 rounded-xl stat-card">
<div class="text-3xl font-bold text-white" id="stat-avg-score">0</div>
<div class="text-blue-300/70 text-sm">Average Score</div>
</div>
<div class="text-center p-4 bg-white/10 rounded-xl stat-card">
<div class="text-3xl font-bold text-white" id="stat-best-role">--</div>
<div class="text-blue-300/70 text-sm">Best Role</div>
</div>
<div class="text-center p-4 bg-white/10 rounded-xl stat-card">
<div class="text-3xl font-bold text-white" id="stat-total-decisions">0</div>
<div class="text-blue-300/70 text-sm">Decisions Made</div>
</div>
</div>
</div>
</section>

<!-- ===== MODE SELECT SCREEN ===== -->
<section id="mode-select-screen" class="hidden max-w-4xl mx-auto space-y-8">
<div class="glass-card p-8 text-center">
<h2 class="text-3xl font-bold text-white mb-6">Select Training Mode</h2>
<div class="grid md:grid-cols-2 gap-6">
<div class="glass-card p-6 cursor-pointer hover:border-blue-400/50 transition-all" onclick="App.selectMode('single')" role="button" tabindex="0" aria-label="Single Player Mode">
<div class="text-5xl mb-4">üë§</div>
<h3 class="text-xl font-bold text-white mb-2">Single Player</h3>
<p class="text-blue-300/70 mb-4">Individual training and assessment. Perfect for self-paced learning and certification preparation.</p>
<ul class="text-left text-sm text-blue-300/70 space-y-2">
<li>‚úì Personal progress tracking</li>
<li>‚úì Flexible scheduling</li>
<li>‚úì Immediate feedback</li>
</ul>
</div>
<div class="glass-card p-6 cursor-pointer hover:border-blue-400/50 transition-all" onclick="App.selectMode('multi')" role="button" tabindex="0" aria-label="Multi Player Mode">
<div class="text-5xl mb-4">üë•</div>
<h3 class="text-xl font-bold text-white mb-2">Multi-Player</h3>
<p class="text-blue-300/70 mb-4">Collaborative team training. Simulate real ICS coordination with multiple roles working together.</p>
<ul class="text-left text-sm text-blue-300/70 space-y-2">
<li>‚úì Team coordination practice</li>
<li>‚úì Communication exercises</li>
<li>‚úì Unified command simulation</li>
</ul>
</div>
</div>
<button onclick="App.showScreen('home')" class="glass-card px-6 py-3 text-white font-medium hover:bg-white/20 mt-6">
‚Üê Back to Home
</button>
</div>
</section>

<!-- ===== PLAYER SETUP SCREEN ===== -->
<section id="player-setup-screen" class="hidden max-w-4xl mx-auto space-y-8">
<div class="glass-card p-6 md:p-8">
<h2 class="text-2xl md:text-3xl font-bold text-white mb-6 text-center">üéÆ Configure Training Session</h2>
<!-- Mode Display -->
<div class="glass-panel rounded-xl p-4 mb-6">
<div class="flex items-center justify-between">
<div>
<p class="text-blue-300/70 text-sm">Training Mode</p>
<p class="text-white font-bold text-lg" id="display-mode">Single Player</p>
</div>
<button onclick="App.showScreen('mode-select')" class="text-blue-400 hover:text-white text-sm">Change</button>
</div>
</div>
<div class="space-y-6">
<!-- Player Name(s) -->
<div id="player-names-container">
<label class="block text-white font-medium mb-2">Operator Callsign</label>
<input type="text" id="player-name-input" placeholder="Enter your name"
class="glass-input w-full px-4 py-3 text-white placeholder-blue-400/50"
aria-label="Player Name">
</div>
<!-- Role Selection -->
<div>
<label class="block text-white font-medium mb-4">Select ICS Role (Per NDRRMC)</label>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3" id="role-selection">
<!-- Roles rendered dynamically -->
</div>
</div>
<!-- Multi-Player Team Selection -->
<div id="multi-player-roles" class="hidden">
<label class="block text-white font-medium mb-4">Assign Team Roles</label>
<p class="text-blue-300/70 text-sm mb-4">Select which roles will be played by team members</p>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-3" id="team-role-selection">
<!-- Team roles rendered dynamically -->
</div>
</div>
<!-- Scenario Selection -->
<div>
<label class="block text-white font-medium mb-4">Select Scenario</label>
<div class="grid gap-4" id="scenario-selection">
<!-- Scenarios rendered dynamically -->
</div>
</div>
<!-- Difficulty -->
<div>
<label class="block text-white font-medium mb-3">Difficulty Level</label>
<div class="grid grid-cols-3 gap-3">
<button onclick="App.setDifficulty('easy')" class="glass-card p-3 text-center hover:border-green-400/50 difficulty-btn has-tooltip relative" data-difficulty="easy">
<div class="text-2xl mb-1">üü¢</div>
<div class="text-white font-medium text-sm">Basic</div>
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content">20 min ‚Ä¢ 150% resources ‚Ä¢ Low casualties</div>
</div>
</button>
<button onclick="App.setDifficulty('medium')" class="glass-card p-3 text-center hover:border-yellow-400/50 difficulty-btn has-tooltip relative" data-difficulty="medium">
<div class="text-2xl mb-1">üü°</div>
<div class="text-white font-medium text-sm">Intermediate</div>
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content">15 min ‚Ä¢ 100% resources ‚Ä¢ Medium casualties</div>
</div>
</button>
<button onclick="App.setDifficulty('hard')" class="glass-card p-3 text-center hover:border-red-400/50 difficulty-btn has-tooltip relative" data-difficulty="hard">
<div class="text-2xl mb-1">üî¥</div>
<div class="text-white font-medium text-sm">Advanced</div>
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content">10 min ‚Ä¢ 75% resources ‚Ä¢ High casualties</div>
</div>
</button>
</div>
</div>
<button id="start-simulation-btn" onclick="App.startSimulation()"
class="glass-button w-full py-4 text-white font-bold text-lg mt-6" disabled>
üöÄ Begin Simulation
</button>
</div>
</div>
</section>

<!-- ===== SIMULATION SCREEN ===== -->
<section id="simulation-screen" class="hidden space-y-6">
<!-- Status Bar -->
<div class="glass-panel rounded-xl p-4 flex flex-wrap items-center justify-between gap-4">
<div class="flex items-center gap-4 md:gap-6">
<div class="flex items-center gap-2">
<div class="w-3 h-3 rounded-full bg-green-400 animate-pulse"></div>
<span class="text-blue-300/80 text-sm font-medium">ACTIVE</span>
</div>
<div class="text-blue-300/80 text-sm">
<span class="text-blue-400/70">Mode:</span> <span id="sim-mode" class="font-medium">-</span>
</div>
<div class="text-blue-300/80 text-sm">
<span class="text-blue-400/70">Role:</span> <span id="sim-role" class="font-medium">-</span>
</div>
<div class="text-blue-300/80 text-sm">
<span class="text-blue-400/70">Scenario:</span> <span id="sim-scenario" class="font-medium">-</span>
</div>
</div>
<div class="flex items-center gap-4">
<div class="text-blue-300/80 text-sm flex items-center gap-2 has-tooltip relative">
<svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
</svg>
<span id="timer" class="font-mono text-lg">15:00</span>
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content">Time remaining in simulation</div>
</div>
</div>
<div class="text-blue-300/80 text-sm">
Phase: <span id="phase-num" class="font-bold text-blue-100">1</span>/<span id="phase-total">5</span>
</div>
</div>
</div>

<div class="grid lg:grid-cols-3 gap-6">
<!-- Left Panel - Situation Map & Briefing -->
<div class="lg:col-span-2 space-y-6">
<!-- Situation Map - Enhanced Grid System -->
<div class="glass-card p-6">
<div class="flex items-center justify-between mb-4">
<h3 class="text-white font-bold text-lg">üó∫Ô∏è Situation Map - GeoRiskPH</h3>
<div class="flex items-center gap-2 text-sm">
<span class="px-2 py-1 bg-red-500/30 rounded text-white text-xs alert-badge">Critical</span>
<span class="px-2 py-1 bg-orange-500/30 rounded text-white text-xs">Affected</span>
<span class="px-2 py-1 bg-green-500/30 rounded text-white text-xs">Safe</span>
</div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
<!-- Map Grid -->
<div class="lg:col-span-3">
<div id="simulation-map" class="map-container bg-gradient-to-br from-blue-900/50 to-blue-800/30 rounded-xl relative overflow-hidden">
<!-- GeoRiskPH Map Tools -->
<div class="map-tools-panel">
<a href="https://hazardhunter.georisk.gov.ph/map" target="_blank" rel="noopener noreferrer" class="map-tool-btn has-tooltip relative" title="City/Municipality Hazard Mapping">
<svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
</svg>
City/Municipality
<div class="tooltip absolute right-full top-1/2 -translate-y-1/2 mr-2">
<div class="tooltip-content">Official GeoRiskPH hazard mapping</div>
</div>
</a>
<a href="https://geoanalytics.georisk.gov.ph/" target="_blank" rel="noopener noreferrer" class="map-tool-btn has-tooltip relative" title="Barangay Level Hazard Mapping">
<svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
</svg>
Barangay Level
<div class="tooltip absolute right-full top-1/2 -translate-y-1/2 mr-2">
<div class="tooltip-content">Barangay-level analytics</div>
</div>
</a>
</div>
<!-- Interactive Grid Map -->
<div id="map-grid" class="map-grid">
<!-- Map cells generated dynamically -->
</div>
<!-- Selected Cell Info Panel -->
<div id="selected-cell-info" class="hidden mt-4 p-4 bg-slate-900/50 rounded-lg border-l-4 border-amber-500">
<div class="flex items-center justify-between mb-3">
<div>
<h4 id="cell-name" class="font-bold text-amber-400 text-lg">Area Name</h4>
<p id="cell-status" class="text-sm text-slate-400 mt-1">Status information</p>
</div>
</div>
<div id="cell-actions" class="flex flex-wrap gap-2">
<!-- Action buttons appear here -->
</div>
</div>
</div>
</div>
<!-- Map Legend -->
<div class="lg:col-span-1">
<div class="map-legend scrollbar-thin">
<div class="legend-title"><span>üìã</span> Legend</div>
<!-- Area Types -->
<div class="legend-section">
<div style="font-size: 10px; font-weight: bold; color: #94a3b8; margin-bottom: 8px; text-transform: uppercase;">Area Types</div>
<div class="legend-item">
<div class="legend-icon">üèòÔ∏è</div>
<div class="legend-text">Urban</div>
</div>
<div class="legend-item">
<div class="legend-icon">üåä</div>
<div class="legend-text">Water</div>
</div>
<div class="legend-item">
<div class="legend-icon">üå≥</div>
<div class="legend-text">Land</div>
</div>
</div>
<!-- Status Colors -->
<div class="legend-section">
<div style="font-size: 10px; font-weight: bold; color: #94a3b8; margin-bottom: 8px; text-transform: uppercase;">Status</div>
<div class="legend-item">
<div class="legend-color-box" style="background: linear-gradient(135deg, #475569 0%, #64748b 100%); border: 1px solid #cbd5e1;"></div>
<div class="legend-text">Normal</div>
</div>
<div class="legend-item">
<div class="legend-color-box" style="background: linear-gradient(135deg, #b91c1c 0%, #dc2626 100%); border: 2px solid #fca5a5;"></div>
<div class="legend-text">Affected</div>
</div>
<div class="legend-item">
<div class="legend-color-box" style="background: linear-gradient(135deg, #6d28d9 0%, #7c3aed 100%); border: 2px solid #a78bfa;"></div>
<div class="legend-text">Flooded</div>
</div>
<div class="legend-item">
<div class="legend-color-box" style="background: linear-gradient(135deg, #b45309 0%, #d97706 100%); border: 2px solid #fed7aa;"></div>
<div class="legend-text">Evacuating</div>
</div>
<div class="legend-item">
<div class="legend-color-box" style="background: linear-gradient(135deg, #047857 0%, #10b981 100%); border: 2px solid #6ee7b7;"></div>
<div class="legend-text">Safe</div>
</div>
</div>
<!-- Tips -->
<div class="legend-section">
<div style="font-size: 10px; font-weight: bold; color: #94a3b8; margin-bottom: 8px; text-transform: uppercase;">Tips</div>
<div style="font-size: 10px; color: #cbd5e1; line-height: 1.4; padding: 6px; background: rgba(251, 191, 36, 0.05); border-radius: 4px;">
üí° <strong>Hover</strong> over cells to see details. <strong>Click</strong> to take action. Monitor resources carefully.
</div>
</div>
</div>
</div>
</div>
<!-- Map Legend (Bottom) -->
<div class="flex flex-wrap gap-4 mt-4 text-xs">
<div class="flex items-center gap-2">
<span class="w-3 h-3 rounded-full bg-red-500"></span>
<span class="text-blue-300/80">Critical Zone</span>
</div>
<div class="flex items-center gap-2">
<span class="w-3 h-3 rounded-full bg-orange-500"></span>
<span class="text-blue-300/80">Affected Area</span>
</div>
<div class="flex items-center gap-2">
<span class="w-3 h-3 rounded-full bg-green-500"></span>
<span class="text-blue-300/80">Command Post</span>
</div>
<div class="flex items-center gap-2">
<span class="w-3 h-3 rounded-full bg-blue-400"></span>
<span class="text-blue-300/80">Resources</span>
</div>
</div>
</div>

<!-- Real-Time Statistics Dashboard -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-3">
<div class="glass-card p-3 text-center stat-card has-tooltip relative">
<div class="text-2xl mb-1">üë•</div>
<div id="stat-population" class="text-xl font-bold text-white">12,450</div>
<div class="text-xs text-blue-300/70">Total Population</div>
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content">Total residents in affected area</div>
</div>
</div>
<div class="glass-card p-3 text-center stat-card has-tooltip relative">
<div class="text-2xl mb-1">üèÉ</div>
<div id="stat-evacuated" class="text-xl font-bold text-green-400">0</div>
<div class="text-xs text-blue-300/70">Evacuated</div>
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content">People successfully moved to safety</div>
</div>
</div>
<div class="glass-card p-3 text-center stat-card has-tooltip relative">
<div class="text-2xl mb-1">‚ö†Ô∏è</div>
<div id="stat-affected" class="text-xl font-bold text-amber-400">0</div>
<div class="text-xs text-blue-300/70">Affected</div>
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content">People impacted by the disaster</div>
</div>
</div>
<div class="glass-card p-3 text-center stat-card has-tooltip relative">
<div class="text-2xl mb-1">üíî</div>
<div id="stat-casualties" class="text-xl font-bold text-red-400">0</div>
<div class="text-xs text-blue-300/70">Casualties</div>
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content">Deaths and severe injuries - minimize at all costs</div>
</div>
</div>
</div>

<!-- Incident Briefing -->
<div class="glass-card p-6">
<h3 class="text-white font-bold text-lg mb-3">üìã Incident Briefing</h3>
<div id="incident-briefing" class="text-blue-300/80 space-y-3 text-sm">
<!-- Briefing content -->
</div>
<!-- Legal Reference -->
<div class="mt-4 pt-4 border-t border-white/10">
<p class="text-xs text-blue-400/70">
<strong>Legal Basis:</strong> RA 10121 (DRRM Act), RA 12287 (DRRM Enhancement), NDRRMC Memorandum Circulars
</p>
</div>
</div>
</div>

<!-- Right Panel - Decision Making -->
<div class="space-y-6">
<!-- Resources Panel -->
<div class="glass-card p-6">
<h3 class="text-white font-bold text-lg mb-3 flex items-center gap-2">
<span>üì¶</span> Available Resources
</h3>
<div id="resources-panel" class="grid grid-cols-2 gap-2">
<!-- Resource cards generated dynamically -->
</div>
</div>

<!-- Current Objective -->
<div class="glass-card p-6">
<h3 class="text-white font-bold text-lg mb-3">üéØ Current Objective</h3>
<div id="current-objective" class="text-blue-300/80 text-sm">
<!-- Objective content -->
</div>
</div>

<!-- Decision Options -->
<div class="glass-card p-6">
<div class="flex items-center justify-between mb-4">
<h3 class="text-white font-bold text-lg">‚ö° Make Your Decision</h3>
<div id="decision-timer" class="text-2xl font-bold text-yellow-400" aria-live="polite">30</div>
</div>
<div id="decision-options" class="space-y-3">
<!-- Decision buttons -->
</div>
</div>

<!-- Live Scores -->
<div class="glass-card p-6">
<h3 class="text-white font-bold text-lg mb-4">üìä Live Performance</h3>
<div class="grid grid-cols-2 gap-4">
<div class="text-center p-3 bg-white/10 rounded-lg">
<p class="text-blue-400/70 text-xs uppercase">Decision</p>
<p id="live-decision" class="text-xl font-bold text-white">0</p>
</div>
<div class="text-center p-3 bg-white/10 rounded-lg">
<p class="text-blue-400/70 text-xs uppercase">Time</p>
<p id="live-time" class="text-xl font-bold text-white">0</p>
</div>
<div class="text-center p-3 bg-white/10 rounded-lg">
<p class="text-blue-400/70 text-xs uppercase">Coordination</p>
<p id="live-coord" class="text-xl font-bold text-white">0</p>
</div>
<div class="text-center p-3 bg-white/10 rounded-lg">
<p class="text-blue-400/70 text-xs uppercase">Communication</p>
<p id="live-comm" class="text-xl font-bold text-white">0</p>
</div>
</div>
</div>

<!-- Communications Log -->
<div class="glass-card p-4">
<h3 class="text-white font-bold text-sm mb-2 flex items-center gap-2">
<span>üìª</span> Communications Log
</h3>
<div id="comm-log" class="space-y-2 text-xs max-h-32 overflow-auto scrollbar-thin">
<div class="text-slate-500">Waiting for updates...</div>
</div>
</div>

<!-- ICS Reference -->
<div class="glass-card p-4">
<button onclick="App.toggleReference()" class="w-full flex items-center justify-between text-white"
aria-expanded="false" aria-controls="ics-reference">
<span class="font-medium">üìñ ICS Quick Reference</span>
<svg id="ref-arrow" class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
</svg>
</button>
<div id="ics-reference" class="hidden mt-4 text-sm text-blue-300/80 space-y-2">
<p><strong>Command:</strong> Overall incident management (RA 10121 Sec. 16)</p>
<p><strong>Operations:</strong> Tactical operations to achieve objectives</p>
<p><strong>Planning:</strong> Information gathering & situation planning</p>
<p><strong>Logistics:</strong> Resources, facilities & support services</p>
<p><strong>Finance:</strong> Cost tracking & procurement (RA 9184)</p>
</div>
</div>
</div>
</div>
</section>

<!-- ===== RESULTS SCREEN ===== -->
<section id="results-screen" class="hidden max-w-4xl mx-auto space-y-8">
<div class="glass-card p-6 md:p-8 text-center">
<div class="w-20 h-20 mx-auto rounded-full bg-blue-500/20 flex items-center justify-center mb-6 glow-border float-animation">
<svg class="w-10 h-10 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
</svg>
</div>
<h2 class="text-2xl md:text-3xl font-bold text-white mb-2 glow-text">SIMULATION COMPLETE</h2>
<p id="result-player" class="text-blue-300/80 mb-6">-</p>

<!-- Total Score Circle -->
<div class="relative w-48 h-48 mx-auto mb-8">
<svg class="progress-ring w-full h-full" viewBox="0 0 100 100">
<circle class="stroke-blue-900/30" cx="50" cy="50" r="45" fill="none" stroke-width="8"/>
<circle id="score-ring" class="stroke-blue-400" cx="50" cy="50" r="45" fill="none" stroke-width="8"
stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="283"/>
</svg>
<div class="absolute inset-0 flex flex-col items-center justify-center">
<span id="total-score" class="text-4xl md:text-5xl font-bold text-white">0</span>
<span class="text-blue-400/70 text-sm uppercase tracking-wider">Total Score</span>
</div>
</div>

<!-- Enhanced Performance Metrics -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-2xl mx-auto mb-8">
<div class="glass-card p-4 text-center stat-card">
<div class="text-3xl font-bold text-amber-400" id="result-score">0</div>
<div class="text-sm text-blue-300/70">Final Score</div>
</div>
<div class="glass-card p-4 text-center stat-card">
<div class="text-3xl font-bold text-green-400" id="result-saved">0</div>
<div class="text-sm text-blue-300/70">Lives Saved</div>
</div>
<div class="glass-card p-4 text-center stat-card">
<div class="text-3xl font-bold text-blue-400" id="result-efficiency">0%</div>
<div class="text-sm text-blue-300/70">Resource Efficiency</div>
</div>
<div class="glass-card p-4 text-center stat-card">
<div class="text-3xl font-bold text-purple-400" id="result-decisions">0</div>
<div class="text-sm text-blue-300/70">Decisions Made</div>
</div>
</div>

<!-- Score Breakdown -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto mb-8">
<div class="glass-card p-4">
<div class="flex justify-between items-center mb-2">
<span class="text-blue-300/80 text-sm">Decision Quality</span>
<span id="result-decision" class="text-white font-bold">0/25</span>
</div>
<div class="h-2 bg-blue-900/30 rounded-full overflow-hidden">
<div id="bar-decision" class="score-bar h-full bg-gradient-to-r from-blue-500 to-blue-400 rounded-full" style="width: 0%"></div>
</div>
</div>
<div class="glass-card p-4">
<div class="flex justify-between items-center mb-2">
<span class="text-blue-300/80 text-sm">Time Management</span>
<span id="result-time" class="text-white font-bold">0/25</span>
</div>
<div class="h-2 bg-blue-900/30 rounded-full overflow-hidden">
<div id="bar-time" class="score-bar h-full bg-gradient-to-r from-green-500 to-green-400 rounded-full" style="width: 0%"></div>
</div>
</div>
<div class="glass-card p-4">
<div class="flex justify-between items-center mb-2">
<span class="text-blue-300/80 text-sm">Coordination</span>
<span id="result-coord" class="text-white font-bold">0/25</span>
</div>
<div class="h-2 bg-blue-900/30 rounded-full overflow-hidden">
<div id="bar-coord" class="score-bar h-full bg-gradient-to-r from-purple-500 to-purple-400 rounded-full" style="width: 0%"></div>
</div>
</div>
<div class="glass-card p-4">
<div class="flex justify-between items-center mb-2">
<span class="text-blue-300/80 text-sm">Communication</span>
<span id="result-comm" class="text-white font-bold">0/25</span>
</div>
<div class="h-2 bg-blue-900/30 rounded-full overflow-hidden">
<div id="bar-comm" class="score-bar h-full bg-gradient-to-r from-amber-500 to-amber-400 rounded-full" style="width: 0%"></div>
</div>
</div>
</div>

<!-- Performance Bars -->
<div class="glass-card p-6 max-w-2xl mx-auto mb-6">
<h4 class="font-bold text-white mb-4">Performance Analysis</h4>
<div id="performance-bars" class="space-y-3">
<!-- Performance bars generated dynamically -->
</div>
</div>

<!-- Performance Rating -->
<div class="glass-card p-6 max-w-md mx-auto mb-6">
<p class="text-blue-400/70 text-sm uppercase tracking-wider mb-2">Performance Rating</p>
<p id="performance-rating" class="text-2xl font-bold text-white">-</p>
<p id="performance-desc" class="text-blue-300/80 text-sm mt-2">-</p>
</div>

<!-- Enhanced Debriefing Notes -->
<div id="result-feedback" class="glass-panel rounded-xl p-4 mb-6 text-left max-w-2xl mx-auto">
<h4 class="font-bold text-amber-400 mb-2">üìã Debriefing Notes</h4>
<ul id="feedback-list" class="text-sm text-blue-300/80 space-y-2">
<!-- Feedback items generated dynamically -->
</ul>
</div>

<!-- Legal Compliance Note -->
<div class="glass-panel rounded-xl p-4 mb-6 text-left max-w-2xl mx-auto">
<h4 class="font-bold text-white mb-2">‚öñÔ∏è Legal Compliance Assessment</h4>
<ul class="text-sm text-blue-300/80 space-y-1" id="compliance-checklist">
<!-- Compliance items -->
</ul>
</div>

<div class="flex flex-wrap justify-center gap-4">
<button onclick="App.restartSimulation()" class="glass-button px-6 py-3 text-white font-medium flex items-center gap-2">
<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
</svg>
New Simulation
</button>
<button onclick="App.showScreen('home')" class="glass-card px-6 py-3 text-white font-medium hover:bg-white/20">
üè† Home
</button>
</div>
</div>
</section>

<!-- ===== LEADERBOARD SCREEN ===== -->
<section id="leaderboard-screen" class="hidden max-w-4xl mx-auto">
<div class="glass-card p-6 md:p-8">
<h2 class="text-2xl md:text-3xl font-bold text-white mb-6 text-center">üèÜ Training Leaderboard</h2>
<div id="leaderboard-content" class="space-y-4">
<!-- Leaderboard entries -->
</div>
<div id="empty-leaderboard" class="hidden text-center py-12">
<div class="text-6xl mb-4">üìä</div>
<p class="text-blue-300/80 text-lg">No training sessions yet!</p>
<p class="text-blue-400/70 text-sm mt-2">Complete a simulation to appear on the leaderboard.</p>
</div>
<div class="text-center mt-6">
<button onclick="App.showScreen('home')" class="glass-card px-6 py-3 text-white font-medium hover:bg-white/20">
‚Üê Back to Home
</button>
</div>
</div>
</section>

<!-- ===== LEARN ICS SCREEN ===== -->
<section id="learn-screen" class="hidden max-w-5xl mx-auto space-y-8">
<div class="glass-card p-6 md:p-8">
<h2 class="text-2xl md:text-3xl font-bold text-white mb-6">üìö Philippine Incident Command System</h2>
<!-- ICS Structure -->
<div class="mb-8">
<h3 class="text-xl font-bold text-white mb-4">üèõÔ∏è ICS Organizational Structure (NDRRMC)</h3>
<div class="bg-white/10 rounded-xl p-6 overflow-x-auto">
<div class="flex flex-col items-center min-w-[600px]">
<!-- Incident Commander -->
<div class="glass-card p-4 text-center mb-4 w-64">
<div class="text-2xl mb-2">üë®‚Äç‚úàÔ∏è</div>
<div class="font-bold text-white">Incident Commander</div>
<div class="text-xs text-blue-300/80">Overall Authority (RA 10121 Sec. 16)</div>
</div>
<div class="w-0.5 h-8 bg-white/30"></div>
<!-- Command Staff -->
<div class="flex gap-4 mb-4">
<div class="glass-card p-3 text-center w-32">
<div class="text-xl">üì¢</div>
<div class="text-sm font-medium text-white">PIO</div>
</div>
<div class="glass-card p-3 text-center w-32">
<div class="text-xl">‚ö†Ô∏è</div>
<div class="text-sm font-medium text-white">Safety</div>
</div>
<div class="glass-card p-3 text-center w-32">
<div class="text-xl">ü§ù</div>
<div class="text-sm font-medium text-white">Liaison</div>
</div>
</div>
<div class="w-0.5 h-8 bg-white/30"></div>
<!-- General Staff -->
<div class="grid grid-cols-4 gap-4">
<div class="glass-card p-4 text-center">
<div class="text-2xl mb-2">‚öôÔ∏è</div>
<div class="font-bold text-white text-sm">Operations</div>
<div class="text-xs text-blue-300/80">Tactical</div>
</div>
<div class="glass-card p-4 text-center">
<div class="text-2xl mb-2">üìã</div>
<div class="font-bold text-white text-sm">Planning</div>
<div class="text-xs text-blue-300/80">Intel & Plan</div>
</div>
<div class="glass-card p-4 text-center">
<div class="text-2xl mb-2">üì¶</div>
<div class="font-bold text-white text-sm">Logistics</div>
<div class="text-xs text-blue-300/80">Resources</div>
</div>
<div class="glass-card p-4 text-center">
<div class="text-2xl mb-2">üí∞</div>
<div class="font-bold text-white text-sm">Finance</div>
<div class="text-xs text-blue-300/80">Costs</div>
</div>
</div>
</div>
</div>
</div>
<!-- Legal Framework -->
<div class="mb-8">
<h3 class="text-xl font-bold text-white mb-4">‚öñÔ∏è Legal Framework</h3>
<div class="grid md:grid-cols-2 gap-4">
<div class="glass-card p-5">
<h4 class="font-bold text-white mb-2">RA 10121 - DRRM Act of 2010</h4>
<ul class="text-blue-300/80 text-sm space-y-1">
<li>‚Ä¢ Establishes NDRRMC framework</li>
<li>‚Ä¢ Mandates local DRRM councils</li>
<li>‚Ä¢ Requires DRRM Plans at all levels</li>
<li>‚Ä¢ Defines ICS roles and responsibilities</li>
<li>‚Ä¢ Section 16: Incident Command System</li>
</ul>
</div>
<div class="glass-card p-5">
<h4 class="font-bold text-white mb-2">RA 12287 - DRRM Enhancement</h4>
<ul class="text-blue-300/80 text-sm space-y-1">
<li>‚Ä¢ Enhanced early warning systems</li>
<li>‚Ä¢ Improved coordination protocols</li>
<li>‚Ä¢ Strengthened local capacities</li>
<li>‚Ä¢ Updated ICS implementation guidelines</li>
<li>‚Ä¢ Better resource mobilization</li>
</ul>
</div>
<div class="glass-card p-5">
<h4 class="font-bold text-white mb-2">NDRRMC Memorandum Circulars</h4>
<ul class="text-blue-300/80 text-sm space-y-1">
<li>‚Ä¢ MC No. 04: ICS Implementation</li>
<li>‚Ä¢ MC No. 06: EOC Operations</li>
<li>‚Ä¢ MC No. 10: Unified Command</li>
<li>‚Ä¢ Regular updates on protocols</li>
</ul>
</div>
<div class="glass-card p-5">
<h4 class="font-bold text-white mb-2">Related Laws</h4>
<ul class="text-blue-300/80 text-sm space-y-1">
<li>‚Ä¢ RA 9184: Government Procurement</li>
<li>‚Ä¢ RA 10821: Children's Emergency Relief</li>
<li>‚Ä¢ RA 11054: BARMM DRRM</li>
<li>‚Ä¢ Local Government Code (RA 7160)</li>
</ul>
</div>
</div>
</div>
<!-- Scoring Rubrics -->
<div>
<h3 class="text-xl font-bold text-white mb-4">üìä Scientific Scoring Rubrics</h3>
<div class="overflow-x-auto">
<table class="w-full text-sm">
<thead>
<tr class="text-left border-b border-white/20">
<th class="p-3 text-white font-bold">Competency</th>
<th class="p-3 text-white font-bold">Exemplary (4)</th>
<th class="p-3 text-white font-bold">Proficient (3)</th>
<th class="p-3 text-white font-bold">Developing (2)</th>
<th class="p-3 text-white font-bold">Beginning (1)</th>
</tr>
</thead>
<tbody class="text-blue-300/80">
<tr class="border-b border-white/10">
<td class="p-3 font-medium text-white">Decision Speed</td>
<td class="p-3">&lt;10 sec</td>
<td class="p-3">10-20 sec</td>
<td class="p-3">20-30 sec</td>
<td class="p-3">&gt;30 sec</td>
</tr>
<tr class="border-b border-white/10">
<td class="p-3 font-medium text-white">Protocol Adherence</td>
<td class="p-3">100% correct</td>
<td class="p-3">85-99%</td>
<td class="p-3">70-84%</td>
<td class="p-3">&lt;70%</td>
</tr>
<tr class="border-b border-white/10">
<td class="p-3 font-medium text-white">Resource Management</td>
<td class="p-3">Optimal use</td>
<td class="p-3">Efficient</td>
<td class="p-3">Adequate</td>
<td class="p-3">Inefficient</td>
</tr>
<tr>
<td class="p-3 font-medium text-white">Communication</td>
<td class="p-3">Clear & timely</td>
<td class="p-3">Mostly clear</td>
<td class="p-3">Needs work</td>
<td class="p-3">Unclear</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="text-center">
<button onclick="App.showScreen('home')" class="glass-button px-6 md:px-8 py-3 text-white font-semibold">
‚Üê Back to Home
</button>
</div>
</section>
</main>

<!-- ===== MODALS ===== -->
<!-- Multi-Player Team Setup Modal -->
<div id="multiplayer-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
<div class="absolute inset-0 bg-slate-950/80 backdrop-blur-sm" onclick="App.closeMultiplayerModal()"></div>
<div class="glass-panel rounded-2xl p-6 w-full max-w-2xl max-h-[80%] overflow-auto relative z-10">
<div class="flex items-center justify-between mb-6">
<h2 class="text-xl font-semibold text-white flex items-center gap-2">
<svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
</svg>
Team Configuration
</h2>
<button onclick="App.closeMultiplayerModal()" class="w-10 h-10 rounded-lg glass-card flex items-center justify-center hover:bg-white/20 transition-colors">
<svg class="w-5 h-5 text-blue-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
</svg>
</button>
</div>
<div id="multiplayer-content" class="space-y-4">
<!-- Dynamic content -->
</div>
<div class="flex justify-end gap-4 mt-6">
<button onclick="App.closeMultiplayerModal()" class="glass-card px-6 py-3 text-white font-medium hover:bg-white/20">
Cancel
</button>
<button onclick="App.confirmMultiplayerSetup()" class="glass-button px-6 py-3 text-white font-medium">
Confirm Team
</button>
</div>
</div>
</div>
</div>

<!-- ===== APPLICATION LOGIC ===== -->
<script>
/**
* ICS Command Simulator PH - Enhanced v4.0
* Compliant with RA 10121, RA 12287, and NDRRMC Guidelines
* Enhanced with EOC Simulator features
*/
const App = {
// ===== CONFIGURATION =====
config: {
app_title: 'ICS COMMAND SIMULATOR PH',
welcome_message: 'NDRRMC Compliant Training Platform',
background_color: '#020617',
surface_color: 'rgba(30, 58, 138, 0.15)',
text_color: '#bfdbfe',
primary_action: '#3b82f6',
secondary_action: '#1e3a8a'
},

// ===== STATE MANAGEMENT =====
state: {
mode: 'single',
playerName: '',
teamMembers: [],
selectedRole: null,
teamRoles: [],
selectedScenario: null,
difficulty: 'medium',
currentPhase: 0,
scores: { decision: 0, time: 0, coordination: 0, communication: 0 },
timerInterval: null,
decisionTimer: null,
timeRemaining: 900,
phaseStartTime: 0,
decisionStartTime: 0,
allRecords: [],
// Enhanced statistics
population: 12450,
evacuated: 0,
affected: 0,
casualties: 0,
// Resources
resources: {
rescue_boats: { name: 'üö£ Rescue Boats', count: 8, max: 8 },
medical_teams: { name: 'üè• Medical Teams', count: 5, max: 5 },
evacuation_trucks: { name: 'üöõ Evac Trucks', count: 6, max: 6 },
relief_packs: { name: 'üì¶ Relief Packs', count: 500, max: 500 },
responders: { name: 'üë∑ Responders', count: 50, max: 50 }
},
// Map cells
mapCells: [],
selectedCell: null,
// Performance metrics
metrics: {
responseTime: 0,
resourceEfficiency: 100,
communicationScore: 100,
decisionQuality: 100
},
// Decision history
decisions: []
},

// ===== ICS ROLES =====
roles: [
{
id: 'incident_commander',
title: 'Incident Commander',
icon: 'üë®‚Äç‚úàÔ∏è',
description: 'Overall incident management authority. Sets objectives and priorities per RA 10121 Sec. 16.',
responsibilities: ['Set incident objectives', 'Manage overall incident', 'Ensure safety', 'Coordinate with agencies'],
color: 'from-red-500 to-orange-500'
},
{
id: 'operations_chief',
title: 'Operations Section Chief',
icon: '‚öôÔ∏è',
description: 'Manages tactical operations to achieve incident objectives.',
responsibilities: ['Direct tactical operations', 'Manage field resources', 'Report to IC', 'Execute IAP'],
color: 'from-orange-500 to-yellow-500'
},
{
id: 'planning_chief',
title: 'Planning Section Chief',
icon: 'üìã',
description: 'Collects and evaluates information for incident planning.',
responsibilities: ['Gather intelligence', 'Prepare IAP', 'Track resources', 'Document incident'],
color: 'from-blue-500 to-cyan-500'
},
{
id: 'logistics_chief',
title: 'Logistics Section Chief',
icon: 'üì¶',
description: 'Provides resources and services to support incident operations.',
responsibilities: ['Procure resources', 'Manage facilities', 'Provide communications', 'Support personnel'],
color: 'from-green-500 to-emerald-500'
},
{
id: 'finance_chief',
title: 'Finance/Admin Section Chief',
icon: 'üí∞',
description: 'Monitors costs and provides accounting and procurement services per RA 9184.',
responsibilities: ['Track costs', 'Process claims', 'Manage contracts', 'Maintain records'],
color: 'from-purple-500 to-pink-500'
}
],

// ===== SCENARIOS =====
scenarios: {
typhoon: {
id: 'typhoon',
name: 'Super Typhoon Response',
briefing: `A Super Typhoon with Signal No. 5 is making landfall. Wind speeds exceed 220 km/h with storm surge warnings. Over 50,000 residents are in evacuation zones. The Provincial DRRMO has activated the EOC and requests immediate ICS implementation per RA 10121.`,
hazardType: 'Typhoon',
location: 'Eastern Visayas',
difficulty: { easy: 3, medium: 5, hard: 5 },
phases: {
incident_commander: [
{
phase: 'Initial Response',
objective: 'Establish Incident Command Post',
question: 'Initial reports indicate 12 barangays severely affected. What is your FIRST priority action per ICS protocols?',
options: [
{ text: 'Establish Incident Command Post at a safe elevated location', points: { decision: 5, coordination: 4, communication: 3 }, correct: true, feedback: 'Correct! Per ICS protocols and RA 10121, ICP should be in a safe, accessible location away from hazard zones.' },
{ text: 'Immediately deploy all available rescue teams', points: { decision: 2, coordination: 1, communication: 1 }, feedback: 'Risky. Resources should be deployed after command structure is established.' },
{ text: 'Contact national agencies for additional resources', points: { decision: 3, coordination: 2, communication: 2 }, feedback: 'Important but not the first priority. Local ICS should be established first.' },
{ text: 'Begin damage assessment of all affected areas', points: { decision: 2, coordination: 2, communication: 1 }, feedback: 'Assessment is important but command structure comes first per NDRRMC guidelines.' }
]
},
{
phase: 'Unified Command',
objective: 'Integrate Multi-Agency Response',
question: 'The Mayor requests to take command of operations. How do you respond per RA 10121?',
options: [
{ text: 'Brief the Mayor and integrate them into Unified Command', points: { decision: 5, coordination: 5, communication: 5 }, correct: true, feedback: 'Correct! Unified Command allows multiple agencies to work together while maintaining ICS structure.' },
{ text: 'Transfer full command to the Mayor immediately', points: { decision: 1, coordination: 2, communication: 2 }, feedback: 'Command transfer requires proper briefing and documentation per ICS protocols.' },
{ text: 'Politely decline and continue solo command', points: { decision: 2, coordination: 1, communication: 1 }, feedback: 'Incorrect. Local officials should be integrated into the command structure.' },
{ text: 'Ask the Mayor to handle media relations only', points: { decision: 3, coordination: 2, communication: 3 }, feedback: 'Limited role. Mayor should have proper command integration.' }
]
},
{
phase: 'Resource Management',
objective: 'Activate ICS Structure',
question: 'Multiple agencies are arriving. What ICS structure do you establish?',
options: [
{ text: 'Full ICS with all General Staff positions activated', points: { decision: 5, coordination: 5, communication: 4 }, correct: true, feedback: 'Correct! Full activation ensures proper coordination per NDRRMC guidelines.' },
{ text: 'Operations and Logistics sections only', points: { decision: 3, coordination: 3, communication: 2 }, feedback: 'Incomplete. All sections should be considered for major incidents.' },
{ text: 'Let each agency operate independently', points: { decision: 1, coordination: 1, communication: 1 }, feedback: 'Incorrect. This leads to resource duplication and gaps per ICS principles.' },
{ text: 'Create ad-hoc teams based on availability', points: { decision: 2, coordination: 2, communication: 2 }, feedback: 'Not recommended. Standard ICS structure ensures proper coordination.' }
]
},
{
phase: 'Operations Coordination',
objective: 'Prioritize Rescue Operations',
question: 'A rescue team reports finding 200 stranded residents needing immediate evacuation. Your decision?',
options: [
{ text: 'Coordinate with Operations Chief to prioritize and allocate assets based on IAP', points: { decision: 5, coordination: 5, communication: 4 }, correct: true, feedback: 'Correct! Proper channel coordination ensures efficient resource use per ICS.' },
{ text: 'Personally direct helicopter resources to the location', points: { decision: 2, coordination: 1, communication: 2 }, feedback: 'Bypasses chain of command. Should work through Operations Chief.' },
{ text: 'Tell them to wait until more resources arrive', points: { decision: 1, coordination: 1, communication: 1 }, feedback: 'Incorrect. Life safety is the priority per DRRM principles.' },
{ text: 'Request military assistance directly', points: { decision: 3, coordination: 2, communication: 3 }, feedback: 'Good option but should coordinate through proper channels first.' }
]
},
{
phase: 'Sustained Operations',
objective: 'Plan Operational Periods',
question: 'The incident is expected to last 72+ hours. What operational period structure do you implement?',
options: [
{ text: '12-hour operational periods with shift changes and planning meetings', points: { decision: 5, coordination: 5, communication: 5 }, correct: true, feedback: 'Correct! Standard ICS operational periods ensure responder safety and continuity.' },
{ text: 'Continuous 24-hour operations until incident resolved', points: { decision: 2, coordination: 2, communication: 2 }, feedback: 'Unsafe. Responder fatigue leads to errors and accidents.' },
{ text: '8-hour shifts like regular work schedule', points: { decision: 3, coordination: 3, communication: 3 }, feedback: 'Not optimal for emergency operations. 12-hour periods are standard.' },
{ text: 'Let section chiefs decide their own schedules', points: { decision: 1, coordination: 1, communication: 2 }, feedback: 'Incorrect. Unified operational periods ensure coordination.' }
]
}
]
}
}
},

// ===== INITIALIZATION =====
async init() {
await this.initializeSDKs();
this.renderRoles();
this.renderScenarios();
this.updateStats();
this.applyConfig();
this.setupEventListeners();
this.registerServiceWorker();
},

async initializeSDKs() {
if (window.elementSdk) {
window.elementSdk.init({
defaultConfig: this.config,
onConfigChange: async (cfg) => {
this.config = { ...this.config, ...cfg };
this.applyConfig();
}
});
}
if (window.dataSdk) {
const result = await window.dataSdk.init({
onDataChanged: (data) => {
this.state.allRecords = data;
this.updateStats();
this.renderLeaderboard();
}
});
if (!result.isOk) {
console.warn('Data SDK initialization failed, using local storage');
this.loadLocalRecords();
}
} else {
this.loadLocalRecords();
}
},

loadLocalRecords() {
try {
const stored = localStorage.getItem('ics_training_records');
this.state.allRecords = stored ? JSON.parse(stored) : [];
} catch (e) {
this.state.allRecords = [];
}
},

saveLocalRecords() {
try {
localStorage.setItem('ics_training_records', JSON.stringify(this.state.allRecords));
} catch (e) {
console.warn('Local storage save failed');
}
},

registerServiceWorker() {
if ('serviceWorker' in navigator) {
navigator.serviceWorker.register('/sw.js').catch(() => {});
}
},

// ===== UI FUNCTIONS =====
showScreen(screenId) {
const screens = ['home', 'mode-select', 'player-setup', 'simulation', 'results', 'leaderboard', 'learn'];
screens.forEach(s => {
const el = document.getElementById(`${s}-screen`);
if (el) el.classList.toggle('hidden', s !== screenId);
});
window.scrollTo({ top: 0, behavior: 'smooth' });
},

selectMode(mode) {
this.state.mode = mode;
document.getElementById('display-mode').textContent = mode === 'single' ? 'Single Player' : 'Multi-Player Team';
if (mode === 'multi') {
document.getElementById('multi-player-roles').classList.remove('hidden');
this.renderTeamRoles();
} else {
document.getElementById('multi-player-roles').classList.add('hidden');
}
this.showScreen('player-setup');
},

setDifficulty(difficulty) {
this.state.difficulty = difficulty;
document.querySelectorAll('.difficulty-btn').forEach(btn => {
btn.classList.remove('border-blue-400', 'bg-blue-500/20');
if (btn.dataset.difficulty === difficulty) {
btn.classList.add('border-blue-400', 'bg-blue-500/20');
}
});
this.checkStartButton();
},

renderRoles() {
const container = document.getElementById('role-selection');
container.innerHTML = this.roles.map(role => `
<div class="role-card glass-card p-3 md:p-4 cursor-pointer transition-all ${this.state.selectedRole === role.id ? 'ring-2 ring-blue-400 bg-blue-500/20' : ''}"
onclick="App.selectRole('${role.id}')" role="button" tabindex="0" aria-pressed="${this.state.selectedRole === role.id}">
<div class="flex items-start gap-3">
<div class="text-2xl md:text-3xl">${role.icon}</div>
<div class="flex-1">
<h4 class="font-bold text-white text-sm md:text-base">${role.title}</h4>
<p class="text-xs md:text-sm text-blue-300/80 mt-1">${role.description}</p>
</div>
</div>
</div>
`).join('');
},

renderTeamRoles() {
const container = document.getElementById('team-role-selection');
container.innerHTML = this.roles.map(role => `
<label class="glass-card p-3 cursor-pointer hover:border-blue-400/50 transition-all flex items-center gap-3">
<input type="checkbox" value="${role.id}" class="team-role-checkbox w-4 h-4" onchange="App.updateTeamRoles()">
<div class="text-xl">${role.icon}</div>
<div class="flex-1">
<div class="font-medium text-white text-sm">${role.title}</div>
<div class="text-xs text-blue-300/80">${role.responsibilities[0]}</div>
</div>
</label>
`).join('');
},

updateTeamRoles() {
const checkboxes = document.querySelectorAll('.team-role-checkbox:checked');
this.state.teamRoles = Array.from(checkboxes).map(cb => cb.value);
this.checkStartButton();
},

selectRole(roleId) {
this.state.selectedRole = roleId;
this.renderRoles();
this.checkStartButton();
},

renderScenarios() {
const container = document.getElementById('scenario-selection');
container.innerHTML = Object.values(this.scenarios).map(scenario => `
<div class="glass-card p-4 cursor-pointer transition-all ${this.state.selectedScenario === scenario.id ? 'ring-2 ring-blue-400 bg-blue-500/20' : ''}"
onclick="App.selectScenario('${scenario.id}')">
<div class="flex items-center justify-between">
<div>
<h4 class="font-bold text-white text-lg">${scenario.name}</h4>
<p class="text-sm text-blue-300/80 mt-1">${scenario.briefing.substring(0, 100)}...</p>
</div>
<span class="px-3 py-1 rounded-full text-xs font-medium bg-blue-500/30 text-blue-200">
${scenario.hazardType}
</span>
</div>
</div>
`).join('');
},

selectScenario(scenarioId) {
this.state.selectedScenario = scenarioId;
this.renderScenarios();
this.checkStartButton();
},

checkStartButton() {
const btn = document.getElementById('start-simulation-btn');
const playerName = document.getElementById('player-name-input').value.trim();
let valid = playerName && this.state.selectedScenario;
if (this.state.mode === 'single') {
valid = valid && this.state.selectedRole;
} else {
valid = valid && this.state.teamRoles.length > 0;
}
btn.disabled = !valid;
},

setupEventListeners() {
document.getElementById('player-name-input')?.addEventListener('input', () => this.checkStartButton());
},

// ===== SIMULATION FUNCTIONS =====
startSimulation() {
const playerName = document.getElementById('player-name-input').value.trim();
if (!playerName) {
this.showToast('Please enter your name', 'error');
return;
}
this.state.playerName = playerName;
this.state.currentPhase = 0;
this.state.scores = { decision: 0, time: 0, coordination: 0, communication: 0 };
this.state.timeRemaining = 900;
// Reset enhanced statistics
this.state.evacuated = 0;
this.state.affected = 0;
this.state.casualties = 0;
this.state.decisions = [];
this.state.metrics = {
responseTime: 0,
resourceEfficiency: 100,
communicationScore: 100,
decisionQuality: 100
};
// Reset resources
Object.keys(this.state.resources).forEach(key => {
this.state.resources[key].count = this.state.resources[key].max;
});
this.showScreen('simulation');
this.initializeMap();
this.updateResourcesPanel();
this.renderSimulationMap();
this.updateSimulationStatus();
this.updateStatsDisplay();
this.loadPhase();
this.startTimer();
this.addCommLog('üìª EOC activated. All units report to stations.');
this.showToast('Simulation started! Good luck, Commander!', 'success');
},

initializeMap() {
const mapContainer = document.getElementById('map-grid');
mapContainer.innerHTML = '';
const mapLayout = [
{ name: 'Coastal', type: 'water', icon: 'üåä' },
{ name: 'Port', type: 'urban', icon: '‚öì' },
{ name: 'Downtown', type: 'urban', icon: 'üè¢' },
{ name: 'Market', type: 'urban', icon: 'üè™' },
{ name: 'Government', type: 'urban', icon: 'üèõÔ∏è' },
{ name: 'Hospital', type: 'urban', icon: 'üè•' },
{ name: 'School', type: 'urban', icon: 'üè´' },
{ name: 'Resort', type: 'land', icon: 'üè®' },
{ name: 'Forest', type: 'land', icon: 'üå≤' },
{ name: 'Mountain', type: 'land', icon: '‚õ∞Ô∏è' },
{ name: 'Ridge', type: 'land', icon: 'üèîÔ∏è' },
{ name: 'Cliff', type: 'land', icon: 'ü™®' }
];
this.state.mapCells = [];
for (let i = 0; i < mapLayout.length; i++) {
const cellData = mapLayout[i];
const cellData_complete = {
id: i,
name: cellData.name,
type: cellData.type,
icon: cellData.icon,
status: 'normal',
population: cellData.type === 'urban' ? Math.floor(Math.random() * 500) + 200 : 0,
affected: 0,
evacuated: 0
};
this.state.mapCells.push(cellData_complete);
const cell = document.createElement('div');
cell.className = `map-cell map-cell-${cellData.type} has-tooltip relative`;
cell.id = `cell-${i}`;
cell.onclick = () => this.selectMapCell(i);
cell.innerHTML = `
<div class="text-3xl">${cellData.icon}</div>
<div class="map-cell-label">${cellData.name.substring(0, 6)}</div>
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content text-center">
<div class="font-bold">${cellData.name}</div>
<div class="text-xs mt-1">${cellData.type === 'urban' ? 'üë• ' + cellData_complete.population + ' pop' : cellData.type}</div>
</div>
</div>
`;
mapContainer.appendChild(cell);
}
},

selectMapCell(cellId) {
this.state.selectedCell = cellId;
const cell = this.state.mapCells[cellId];
const infoPanel = document.getElementById('selected-cell-info');
infoPanel.classList.remove('hidden');
document.getElementById('cell-name').textContent = cell.name;
let statusText = 'Status: ';
let statusColor = 'text-green-400';
switch(cell.status) {
case 'affected':
statusText += 'Affected (' + cell.affected + ' people)';
statusColor = 'text-red-400';
break;
case 'flooded':
statusText += 'Flooded';
statusColor = 'text-violet-400';
break;
case 'evacuated':
statusText += 'Evacuated';
statusColor = 'text-amber-400';
break;
case 'safe':
statusText += 'Safe Zone';
statusColor = 'text-green-400';
break;
default:
statusText += 'Normal (Pop: ' + cell.population + ')';
}
document.getElementById('cell-status').innerHTML = `<span class="${statusColor}">${statusText}</span>`;
const actionsDiv = document.getElementById('cell-actions');
actionsDiv.innerHTML = '';
if (cell.status === 'affected' && cell.affected > 0) {
actionsDiv.innerHTML = `
<button onclick="App.deployRescue(${cellId})" class="glass-button px-3 py-1 text-xs font-bold transition-colors has-tooltip relative">
üö£ Rescue
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content whitespace-nowrap">Deploy rescue team to this area</div>
</div>
</button>
`;
} else if (cell.type === 'urban' && cell.status === 'normal') {
actionsDiv.innerHTML = `
<button onclick="App.preEvacuate(${cellId})" class="glass-button px-3 py-1 text-xs font-bold transition-colors has-tooltip relative">
üì¢ Pre-Evacuate
<div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2">
<div class="tooltip-content whitespace-nowrap">Issue evacuation order before disaster hits</div>
</div>
</button>
`;
}
},

deployRescue(cellId) {
const cell = this.state.mapCells[cellId];
if (this.state.resources.rescue_boats.count < 1 || this.state.resources.responders.count < 5) {
this.showToast('‚ö†Ô∏è Insufficient resources for rescue operation!', 'error');
return;
}
this.state.resources.rescue_boats.count -= 1;
this.state.resources.responders.count -= 5;
const rescued = Math.min(cell.affected, 50);
cell.affected -= rescued;
cell.evacuated += rescued;
this.state.evacuated += rescued;
this.state.scores.decision += 2;
if (cell.affected === 0) {
cell.status = 'evacuated';
this.updateCellVisual(cellId);
}
this.updateStatsDisplay();
this.updateResourcesPanel();
this.addCommLog(`üö£ Rescue team deployed to ${cell.name}. ${rescued} people rescued.`);
this.showToast(`‚úÖ ${rescued} people rescued from ${cell.name}!`, 'success');
this.selectMapCell(cellId);
setTimeout(() => {
this.state.resources.rescue_boats.count = Math.min(this.state.resources.rescue_boats.count + 1, this.state.resources.rescue_boats.max);
this.state.resources.responders.count = Math.min(this.state.resources.responders.count + 5, this.state.resources.responders.max);
this.updateResourcesPanel();
this.addCommLog(`üö£ Rescue team returned from ${cell.name}.`);
}, 30000);
},

preEvacuate(cellId) {
const cell = this.state.mapCells[cellId];
if (this.state.resources.responders.count < 3) {
this.showToast('‚ö†Ô∏è Not enough responders available!', 'error');
return;
}
this.state.resources.responders.count -= 3;
const evacuated = Math.floor(cell.population * 0.5);
cell.population -= evacuated;
cell.evacuated += evacuated;
this.state.evacuated += evacuated;
this.state.scores.decision += 1;
cell.status = 'evacuated';
this.updateCellVisual(cellId);
this.updateStatsDisplay();
this.updateResourcesPanel();
this.addCommLog(`üì¢ Pre-emptive evacuation in ${cell.name}. ${evacuated} residents moved.`);
this.showToast(`‚úÖ ${evacuated} people evacuated from ${cell.name}!`, 'success');
this.selectMapCell(cellId);
setTimeout(() => {
this.state.resources.responders.count = Math.min(this.state.resources.responders.count + 3, this.state.resources.responders.max);
this.updateResourcesPanel();
}, 20000);
},

updateCellVisual(cellId) {
const cell = this.state.mapCells[cellId];
const cellElement = document.getElementById(`cell-${cellId}`);
cellElement.className = `map-cell map-cell-${cell.status !== 'normal' ? cell.status : cell.type} has-tooltip relative`;
},

updateSimulationStatus() {
document.getElementById('sim-mode').textContent = this.state.mode === 'single' ? 'Single Player' : 'Multi-Player';
document.getElementById('sim-role').textContent = this.state.mode === 'single'
? this.roles.find(r => r.id === this.state.selectedRole)?.title
: 'Team (' + this.state.teamRoles.length + ' roles)';
document.getElementById('sim-scenario').textContent = this.scenarios[this.state.selectedScenario]?.name;
},

renderSimulationMap() {
const scenario = this.scenarios[this.state.selectedScenario];
document.getElementById('incident-briefing').innerHTML = `
<p class="font-bold text-white">${scenario.name}</p>
<p class="mt-2">${scenario.briefing}</p>
<div class="mt-3 flex flex-wrap gap-2">
<span class="px-2 py-1 bg-red-500/30 rounded text-xs text-white">Signal No. 5</span>
<span class="px-2 py-1 bg-orange-500/30 rounded text-xs text-white">Mass Evacuation</span>
<span class="px-2 py-1 bg-blue-500/30 rounded text-xs text-white">Multi-Agency</span>
</div>
`;
},

updateResourcesPanel() {
const panel = document.getElementById('resources-panel');
panel.innerHTML = '';
Object.entries(this.state.resources).forEach(([key, resource]) => {
const percentage = (resource.count / resource.max) * 100;
let colorClass = 'bg-green-500';
if (percentage < 30) colorClass = 'bg-red-500';
else if (percentage < 60) colorClass = 'bg-amber-500';
const card = document.createElement('div');
card.className = 'resource-card glass-card p-2';
card.innerHTML = `
<div class="flex items-center justify-between mb-1">
<span class="text-xs text-blue-300/80">${resource.name}</span>
</div>
<div class="flex items-center gap-2">
<div class="flex-1 bg-slate-700 rounded-full h-2">
<div class="progress-bar ${colorClass} h-2 rounded-full" style="width: ${percentage}%"></div>
</div>
<span class="text-xs font-bold text-white">${resource.count}</span>
</div>
`;
panel.appendChild(card);
});
},

loadPhase() {
const scenario = this.scenarios[this.state.selectedScenario];
const role = this.state.mode === 'single' ? this.state.selectedRole : this.state.teamRoles[0];
const phases = scenario.phases[role];
if (!phases || this.state.currentPhase >= phases.length) {
this.endSimulation();
return;
}
const phase = phases[this.state.currentPhase];
document.getElementById('phase-num').textContent = this.state.currentPhase + 1;
document.getElementById('phase-total').textContent = phases.length;
document.getElementById('current-objective').innerHTML = `
<p class="font-bold text-white mb-2">${phase.phase}</p>
<p class="text-base">${phase.objective}</p>
<p class="text-lg mt-3">${phase.question}</p>
`;
const optionsContainer = document.getElementById('decision-options');
optionsContainer.innerHTML = phase.options.map((opt, i) => `
<button class="w-full text-left glass-card p-4 hover:bg-white/20 transition-all group decision-btn"
onclick="App.makeDecision(${i})" role="button" aria-label="Option ${String.fromCharCode(65 + i)}">
<div class="flex items-start gap-3">
<span class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center font-bold text-white group-hover:bg-white/30">
${String.fromCharCode(65 + i)}
</span>
<span class="text-white flex-1">${opt.text}</span>
</div>
</button>
`).join('');
this.startDecisionTimer();
},

startTimer() {
this.state.phaseStartTime = Date.now();
if (this.state.timerInterval) clearInterval(this.state.timerInterval);
this.state.timerInterval = setInterval(() => {
this.state.timeRemaining--;
this.updateTimerDisplay();
if (this.state.timeRemaining <= 0) {
this.endSimulation();
}
}, 1000);
},

startDecisionTimer() {
this.state.decisionStartTime = Date.now();
let timeLeft = 30;
if (this.state.decisionTimer) clearInterval(this.state.decisionTimer);
this.state.decisionTimer = setInterval(() => {
timeLeft--;
const timerEl = document.getElementById('decision-timer');
timerEl.textContent = timeLeft;
if (timeLeft <= 10) {
timerEl.classList.add('timer-critical');
} else {
timerEl.classList.remove('timer-critical');
}
if (timeLeft <= 0) {
clearInterval(this.state.decisionTimer);
this.makeDecision(-1);
}
}, 1000);
},

updateTimerDisplay() {
const minutes = Math.floor(this.state.timeRemaining / 60);
const seconds = this.state.timeRemaining % 60;
document.getElementById('timer').textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
const timerEl = document.getElementById('timer');
if (this.state.timeRemaining <= 30) {
timerEl.classList.add('text-red-400');
timerEl.classList.remove('text-amber-400');
} else if (this.state.timeRemaining <= 60) {
timerEl.classList.add('text-amber-400');
timerEl.classList.remove('text-red-400');
} else {
timerEl.classList.remove('text-amber-400', 'text-red-400');
}
},

makeDecision(optionIndex) {
clearInterval(this.state.decisionTimer);
const scenario = this.scenarios[this.state.selectedScenario];
const role = this.state.mode === 'single' ? this.state.selectedRole : this.state.teamRoles[0];
const phases = scenario.phases[role];
const phase = phases[this.state.currentPhase];
const decisionTime = (Date.now() - this.state.decisionStartTime) / 1000;
if (optionIndex >= 0 && phase.options[optionIndex]) {
const option = phase.options[optionIndex];
this.state.scores.decision += option.points.decision;
this.state.scores.coordination += option.points.coordination;
this.state.scores.communication += option.points.communication;
const timeBonus = Math.max(0, Math.round(5 - (decisionTime / 12)));
this.state.scores.time += timeBonus;
// Store decision
this.state.decisions.push({
phase: this.state.currentPhase,
event: phase.phase,
choice: option.text,
feedback: option.feedback
});
this.showToast(option.correct ? '‚úì Correct decision!' : '‚ñ≥ Not optimal', option.correct ? 'success' : 'warning');
const optionsContainer = document.getElementById('decision-options');
optionsContainer.innerHTML = `
<div class="glass-card p-4 ${option.correct ? 'bg-green-500/20' : 'bg-yellow-500/20'}">
<p class="text-white font-medium mb-2">${option.correct ? '‚úì' : '‚ñ≥'} ${option.feedback}</p>
<p class="text-blue-300/80 text-sm">Decision Time: ${decisionTime.toFixed(1)}s | Time Bonus: +${timeBonus}</p>
</div>
`;
} else {
this.showToast('‚è±Ô∏è Time expired!', 'error');
}
this.updateLiveScores();
this.addCommLog(`üìù Decision made: ${phase.phase}`);
setTimeout(() => {
this.state.currentPhase++;
this.loadPhase();
}, 2000);
},

updateLiveScores() {
document.getElementById('live-decision').textContent = this.state.scores.decision;
document.getElementById('live-time').textContent = this.state.scores.time;
document.getElementById('live-coord').textContent = this.state.scores.coordination;
document.getElementById('live-comm').textContent = this.state.scores.communication;
},

updateStatsDisplay() {
document.getElementById('stat-population').textContent = this.state.population.toLocaleString();
document.getElementById('stat-evacuated').textContent = this.state.evacuated.toLocaleString();
document.getElementById('stat-affected').textContent = this.state.affected.toLocaleString();
document.getElementById('stat-casualties').textContent = this.state.casualties.toLocaleString();
},

addCommLog(message) {
const logContainer = document.getElementById('comm-log');
const time = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
const entry = document.createElement('div');
entry.className = 'text-blue-300/80 comm-log-entry';
entry.innerHTML = `<span class="text-slate-500">[${time}]</span> ${message}`;
logContainer.insertBefore(entry, logContainer.firstChild);
while (logContainer.children.length > 10) {
logContainer.removeChild(logContainer.lastChild);
}
},

async endSimulation() {
clearInterval(this.state.timerInterval);
clearInterval(this.state.decisionTimer);
const totalScore = this.state.scores.decision + this.state.scores.time +
this.state.scores.coordination + this.state.scores.communication;
const performance = this.getPerformanceRating(totalScore);
// Calculate metrics
const livesSaved = this.state.evacuated;
const resourcesUsed = Object.values(this.state.resources).reduce((acc, r) => acc + (r.max - r.count), 0);
const totalResources = Object.values(this.state.resources).reduce((acc, r) => acc + r.max, 0);
const resourceEfficiency = Math.round(((totalResources - resourcesUsed) / totalResources) * 100);
// Save results
const record = {
id: `session_${Date.now()}`,
player_name: this.state.playerName,
mode: this.state.mode,
role: this.state.mode === 'single' ? this.state.selectedRole : 'team',
team_roles: this.state.teamRoles,
scenario: this.state.selectedScenario,
difficulty: this.state.difficulty,
total_score: totalScore,
decision_score: this.state.scores.decision,
time_score: this.state.scores.time,
coordination_score: this.state.scores.coordination,
communication_score: this.state.scores.communication,
lives_saved: livesSaved,
resource_efficiency: resourceEfficiency,
decisions_made: this.state.decisions.length,
completed_at: new Date().toISOString()
};
if (window.dataSdk && this.state.allRecords.length < 999) {
await window.dataSdk.create(record);
} else {
this.state.allRecords.push(record);
this.saveLocalRecords();
}
// Display results
this.showScreen('results');
this.renderResults(totalScore, performance, livesSaved, resourceEfficiency);
},

getPerformanceRating(score) {
const maxScore = 100;
const percentage = (score / maxScore) * 100;
if (percentage >= 90) return { rating: 'EXEMPLARY', desc: 'Outstanding ICS competency. Ready for complex, multi-agency incidents.' };
if (percentage >= 80) return { rating: 'PROFICIENT', desc: 'Strong command of ICS principles. Effective incident management.' };
if (percentage >= 70) return { rating: 'COMPETENT', desc: 'Adequate ICS application. Room for improvement in coordination.' };
if (percentage >= 60) return { rating: 'DEVELOPING', desc: 'Basic ICS understanding. Additional training recommended.' };
return { rating: 'NEEDS IMPROVEMENT', desc: 'Fundamental ICS concepts require reinforcement.' };
},

renderResults(totalScore, performance, livesSaved, resourceEfficiency) {
const maxScore = 100;
document.getElementById('result-player').textContent =
`${this.state.playerName} ‚Ä¢ ${this.state.mode === 'single' ? this.roles.find(r => r.id === this.state.selectedRole)?.title : 'Multi-Player Team'} ‚Ä¢ ${this.scenarios[this.state.selectedScenario]?.name}`;
document.getElementById('total-score').textContent = totalScore;
// Animate score ring
const ring = document.getElementById('score-ring');
const circumference = 283;
const offset = circumference - (totalScore / maxScore) * circumference;
setTimeout(() => { ring.style.strokeDashoffset = offset; }, 100);
// Update enhanced metrics
document.getElementById('result-score').textContent = totalScore;
document.getElementById('result-saved').textContent = livesSaved.toLocaleString();
document.getElementById('result-efficiency').textContent = resourceEfficiency + '%';
document.getElementById('result-decisions').textContent = this.state.decisions.length;
// Update breakdowns
document.getElementById('result-decision').textContent = `${this.state.scores.decision}/25`;
document.getElementById('result-time').textContent = `${this.state.scores.time}/25`;
document.getElementById('result-coord').textContent = `${this.state.scores.coordination}/25`;
document.getElementById('result-comm').textContent = `${this.state.scores.communication}/25`;
// Animate bars
setTimeout(() => {
document.getElementById('bar-decision').style.width = `${(this.state.scores.decision / 25) * 100}%`;
document.getElementById('bar-time').style.width = `${(this.state.scores.time / 25) * 100}%`;
document.getElementById('bar-coord').style.width = `${(this.state.scores.coordination / 25) * 100}%`;
document.getElementById('bar-comm').style.width = `${(this.state.scores.communication / 25) * 100}%`;
}, 200);
// Performance bars
const performanceBars = document.getElementById('performance-bars');
performanceBars.innerHTML = `
<div class="flex items-center gap-3">
<span class="w-32 text-xs text-blue-300/80">Response Speed</span>
<div class="flex-1 bg-slate-700 rounded-full h-3">
<div class="bg-cyan-500 h-3 rounded-full transition-all" style="width: ${Math.min(100, 100 - (this.state.casualties * 2))}%"></div>
</div>
</div>
<div class="flex items-center gap-3">
<span class="w-32 text-xs text-blue-300/80">Resource Mgmt</span>
<div class="flex-1 bg-slate-700 rounded-full h-3">
<div class="bg-green-500 h-3 rounded-full transition-all" style="width: ${resourceEfficiency}%"></div>
</div>
</div>
<div class="flex items-center gap-3">
<span class="w-32 text-xs text-blue-300/80">Communication</span>
<div class="flex-1 bg-slate-700 rounded-full h-3">
<div class="bg-purple-500 h-3 rounded-full transition-all" style="width: ${this.state.metrics.communicationScore}%"></div>
</div>
</div>
<div class="flex items-center gap-3">
<span class="w-32 text-xs text-blue-300/80">Lives Saved</span>
<div class="flex-1 bg-slate-700 rounded-full h-3">
<div class="bg-amber-500 h-3 rounded-full transition-all" style="width: ${Math.min(100, (livesSaved / 2000) * 100)}%"></div>
</div>
</div>
`;
document.getElementById('performance-rating').textContent = performance.rating;
document.getElementById('performance-desc').textContent = performance.desc;
// Enhanced debriefing
const feedbackList = document.getElementById('feedback-list');
feedbackList.innerHTML = this.state.decisions.slice(-3).map(d => `
<li>‚Ä¢ ${d.feedback}</li>
`).join('');
if (this.state.casualties === 0) {
feedbackList.innerHTML += '<li class="text-green-400">‚Ä¢ Zero casualties achieved! Excellent leadership.</li>';
}
if (resourceEfficiency > 80) {
feedbackList.innerHTML += '<li class="text-blue-400">‚Ä¢ Efficient resource utilization demonstrated.</li>';
}
if (livesSaved > 2000) {
feedbackList.innerHTML += '<li class="text-amber-400">‚Ä¢ Mass evacuation successfully coordinated.</li>';
}
// Compliance checklist
const complianceItems = [
{ check: this.state.scores.decision >= 20, text: 'RA 10121 Protocol Adherence' },
{ check: this.state.scores.coordination >= 20, text: 'NDRRMC Coordination Guidelines' },
{ check: this.state.scores.communication >= 15, text: 'ICS Communication Standards' },
{ check: this.state.scores.time >= 15, text: 'Response Time Requirements' }
];
document.getElementById('compliance-checklist').innerHTML = complianceItems.map(item => `
<li class="flex items-center gap-2">
<span class="${item.check ? 'text-green-400' : 'text-red-400'}">${item.check ? '‚úì' : '‚úó'}</span>
<span class="${item.check ? 'text-white' : 'text-blue-300/80'}">${item.text}</span>
</li>
`).join('');
},

restartSimulation() {
this.showScreen('mode-select');
},

// ===== STATISTICS & LEADERBOARD =====
updateStats() {
const sessions = this.state.allRecords.length;
const avgScore = sessions > 0
? Math.round(this.state.allRecords.reduce((sum, r) => sum + (r.total_score || 0), 0) / sessions)
: 0;
const totalDecisionsMade = this.state.allRecords.reduce((sum, r) => sum + (r.decisions_made || 5), 0);
// Find best role
const roleScores = {};
this.state.allRecords.forEach(r => {
if (r.role && r.role !== 'team') {
if (!roleScores[r.role]) roleScores[r.role] = { total: 0, count: 0 };
roleScores[r.role].total += (r.total_score || 0);
roleScores[r.role].count += 1;
}
});
let bestRole = '--';
let bestAvg = 0;
Object.entries(roleScores).forEach(([role, data]) => {
const avg = data.total / data.count;
if (avg > bestAvg) {
bestAvg = avg;
bestRole = this.roles.find(r => r.id === role)?.title || role;
}
});
document.getElementById('stat-sessions').textContent = sessions;
document.getElementById('stat-avg-score').textContent = avgScore;
document.getElementById('stat-best-role').textContent = bestRole;
document.getElementById('stat-total-decisions').textContent = totalDecisionsMade;
},

renderLeaderboard() {
const container = document.getElementById('leaderboard-content');
const emptyState = document.getElementById('empty-leaderboard');
if (this.state.allRecords.length === 0) {
container.classList.add('hidden');
emptyState.classList.remove('hidden');
return;
}
container.classList.remove('hidden');
emptyState.classList.add('hidden');
const sorted = [...this.state.allRecords].sort((a, b) => (b.total_score || 0) - (a.total_score || 0)).slice(0, 10);
container.innerHTML = sorted.map((record, i) => {
const scenarioIcon = record.scenario === 'typhoon' ? 'üåÄ' : record.scenario === 'earthquake' ? 'üèöÔ∏è' : 'üåä';
const medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : `${i + 1}`;
const date = new Date(record.completed_at).toLocaleDateString('en-PH', { month: 'short', day: 'numeric' });
return `
<div class="glass-card p-4 flex items-center gap-4">
<div class="text-2xl font-bold w-12 text-center">${medal}</div>
<div class="flex-1">
<div class="font-bold text-white">${record.player_name || 'Anonymous'}</div>
<div class="text-sm text-blue-300/80">${scenarioIcon} ${record.scenario} ‚Ä¢ ${date}</div>
</div>
<div class="text-right">
<div class="text-2xl font-bold text-white">${record.total_score || 0}</div>
<div class="text-xs text-blue-300/80">${record.mode}</div>
</div>
</div>
`;
}).join('');
},

// ===== UTILITIES =====
toggleReference() {
const ref = document.getElementById('ics-reference');
const arrow = document.getElementById('ref-arrow');
ref.classList.toggle('hidden');
arrow.classList.toggle('rotate-180');
},

showToast(message, type = 'info') {
const container = document.getElementById('toast-container');
const colors = {
success: 'from-green-500 to-emerald-600',
error: 'from-red-500 to-rose-600',
info: 'from-blue-500 to-cyan-600',
warning: 'from-yellow-500 to-orange-600'
};
const toast = document.createElement('div');
toast.className = `toast glass-card p-4 bg-gradient-to-r ${colors[type]} text-white font-medium max-w-sm`;
toast.textContent = message;
toast.setAttribute('role', 'alert');
container.appendChild(toast);
setTimeout(() => {
toast.style.opacity = '0';
toast.style.transform = 'translateX(100%)';
setTimeout(() => toast.remove(), 300);
}, 4000);
},

applyConfig() {
const navTitle = document.getElementById('nav-title');
if (navTitle) navTitle.textContent = this.config.app_title;
},

closeMultiplayerModal() {
document.getElementById('multiplayer-modal').classList.add('hidden');
},

confirmMultiplayerSetup() {
this.closeMultiplayerModal();
this.checkStartButton();
}
};

// Initialize App
document.addEventListener('DOMContentLoaded', () => App.init());
</script>
</body>
</html>
