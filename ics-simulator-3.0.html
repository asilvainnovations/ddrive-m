<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ICS Commander PH</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Roboto Condensed', sans-serif; }
    
    /* Liquid Glass Design System */
    .glass-surface {
      background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.25) 0%, 
        rgba(255, 255, 255, 0.1) 50%,
        rgba(255, 255, 255, 0.05) 100%);
      backdrop-filter: blur(40px) saturate(180%);
      -webkit-backdrop-filter: blur(40px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 
        0 8px 32px rgba(0, 82, 165, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -1px 0 rgba(0, 0, 0, 0.05);
    }
    
    .glass-card {
      background: linear-gradient(145deg,
        rgba(255, 255, 255, 0.35) 0%,
        rgba(255, 255, 255, 0.15) 100%);
      backdrop-filter: blur(30px) saturate(150%);
      -webkit-backdrop-filter: blur(30px) saturate(150%);
      border: 1px solid rgba(255, 255, 255, 0.4);
      border-radius: 24px;
      box-shadow: 
        0 4px 24px rgba(0, 82, 165, 0.12),
        inset 0 2px 0 rgba(255, 255, 255, 0.5);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .glass-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 
        0 12px 40px rgba(0, 82, 165, 0.2),
        inset 0 2px 0 rgba(255, 255, 255, 0.6);
    }
    
    .glass-button {
      background: linear-gradient(135deg,
        rgba(0, 102, 204, 0.9) 0%,
        rgba(0, 82, 165, 0.95) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 16px;
      box-shadow: 
        0 4px 16px rgba(0, 82, 165, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .glass-button:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 8px 24px rgba(0, 82, 165, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }
    
    .glass-button:active {
      transform: translateY(0);
      box-shadow: 
        0 2px 8px rgba(0, 82, 165, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
    
    .glass-input {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      transition: all 0.3s ease;
    }
    
    .glass-input:focus {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(0, 102, 204, 0.6);
      box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.15);
      outline: none;
    }
    
    /* Animated Background */
    .animated-bg {
      background: linear-gradient(135deg, 
        #0052a5 0%, 
        #0066cc 25%, 
        #1a73e8 50%, 
        #0052a5 75%, 
        #003d7a 100%);
      background-size: 400% 400%;
      animation: gradientFlow 15s ease infinite;
    }
    
    @keyframes gradientFlow {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    /* Map Styles */
    .map-container {
      background: linear-gradient(180deg,
        rgba(0, 82, 165, 0.1) 0%,
        rgba(0, 102, 204, 0.05) 100%);
      border-radius: 20px;
      overflow: hidden;
      position: relative;
    }
    
    .hazard-marker {
      position: absolute;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      animation: pulse 2s infinite;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    
    .hazard-marker:hover {
      transform: scale(1.3);
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.7; }
    }
    
    /* Role Cards */
    .role-card {
      position: relative;
      overflow: hidden;
    }
    
    .role-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.3) 50%,
        transparent 100%);
      transition: left 0.6s ease;
    }
    
    .role-card:hover::before {
      left: 100%;
    }
    
    /* Score Animation */
    .score-ring {
      transform-origin: center;
      animation: scoreRotate 3s linear infinite;
    }
    
    @keyframes scoreRotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    /* Toast Notification */
    .toast {
      animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    @keyframes slideIn {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    /* Progress Bar */
    .progress-fill {
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Decision Timer */
    .timer-critical {
      animation: timerPulse 0.5s ease infinite;
    }
    
    @keyframes timerPulse {
      0%, 100% { color: #ef4444; }
      50% { color: #fbbf24; }
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: rgba(0, 102, 204, 0.5); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(0, 102, 204, 0.7); }
  </style>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="h-full overflow-auto animated-bg">
  <div id="app" class="min-h-full w-full">
   <!-- Toast Container -->
   <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div><!-- Main Navigation -->
   <nav id="main-nav" class="glass-surface sticky top-0 z-40 px-6 py-4">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
     <div class="flex items-center gap-3">
      <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center shadow-lg">
       <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
       </svg>
      </div>
      <div>
       <h1 id="nav-title" class="text-xl font-bold text-white">ICS Commander PH</h1>
       <p class="text-xs text-blue-100 opacity-80">Philippine Incident Command Training</p>
      </div>
     </div>
     <div class="flex items-center gap-4">
      <button onclick="showScreen('leaderboard')" class="text-white/80 hover:text-white transition-colors px-3 py-2 rounded-xl hover:bg-white/10"> ğŸ† Leaderboard </button> <button onclick="showScreen('home')" class="text-white/80 hover:text-white transition-colors px-3 py-2 rounded-xl hover:bg-white/10"> ğŸ  Home </button>
     </div>
    </div>
   </nav><!-- Home Screen -->
   <section id="home-screen" class="max-w-7xl mx-auto px-6 py-8">
    <!-- Hero Section -->
    <div class="glass-card p-8 mb-8">
     <div class="flex flex-col lg:flex-row items-center gap-8">
      <div class="flex-1">
       <h2 id="hero-title" class="text-4xl lg:text-5xl font-bold text-white mb-4 leading-tight">Master Incident Command</h2>
       <p class="text-blue-100 text-lg mb-6 leading-relaxed">Train with real-world scenarios based on Philippine DRRM Law (RA 10121), RA 12287, and the National Incident Command System. Integrated with GeoRiskPH HazardHunter mapping for authentic hazard assessment.</p>
       <div class="flex flex-wrap gap-4">
        <button onclick="showScreen('player-setup')" class="glass-button px-8 py-4 text-white font-semibold text-lg"> ğŸ® Start Training </button> <button onclick="showScreen('learn')" class="glass-card px-8 py-4 text-white font-medium hover:bg-white/20"> ğŸ“š Learn ICS </button>
       </div>
      </div>
      <div class="flex-1 max-w-md">
       <!-- Interactive Map Preview -->
       <div class="map-container aspect-square glass-card p-4">
        <svg viewbox="0 0 400 400" class="w-full h-full">
         <!-- Philippine Islands Simplified --> <defs>
          <lineargradient id="landGrad" x1="0%" y1="0%" x2="100%" y2="100%">
           <stop offset="0%" style="stop-color:rgba(255,255,255,0.3)" />
           <stop offset="100%" style="stop-color:rgba(255,255,255,0.1)" />
          </lineargradient>
          <filter id="glow">
           <fegaussianblur stddeviation="3" result="coloredBlur" />
           <femerge>
            <femergenode in="coloredBlur" />
            <femergenode in="SourceGraphic" />
           </femerge>
          </filter>
         </defs> <!-- Water Background --> <rect width="400" height="400" fill="rgba(0,82,165,0.2)" rx="16" /> <!-- Luzon --> <path d="M180 40 L220 50 L240 80 L250 120 L240 160 L220 180 L180 190 L150 170 L140 130 L150 80 Z" fill="url(#landGrad)" stroke="rgba(255,255,255,0.5)" stroke-width="2" /> <!-- Visayas --> <path d="M120 220 L180 210 L220 230 L200 260 L150 270 L120 250 Z" fill="url(#landGrad)" stroke="rgba(255,255,255,0.5)" stroke-width="2" /> <path d="M230 220 L280 230 L290 260 L260 280 L230 260 Z" fill="url(#landGrad)" stroke="rgba(255,255,255,0.5)" stroke-width="2" /> <!-- Mindanao --> <path d="M140 300 L200 290 L260 300 L280 340 L260 370 L200 380 L150 360 L130 330 Z" fill="url(#landGrad)" stroke="rgba(255,255,255,0.5)" stroke-width="2" /> <!-- Hazard Markers --> <circle cx="200" cy="130" r="12" fill="#ef4444" filter="url(#glow)" opacity="0.9">
          <animate attributename="r" values="12;16;12" dur="2s" repeatcount="indefinite" />
         </circle> <circle cx="170" cy="240" r="10" fill="#f59e0b" filter="url(#glow)" opacity="0.9">
          <animate attributename="r" values="10;14;10" dur="2.5s" repeatcount="indefinite" />
         </circle> <circle cx="220" cy="340" r="11" fill="#ef4444" filter="url(#glow)" opacity="0.9">
          <animate attributename="r" values="11;15;11" dur="1.8s" repeatcount="indefinite" />
         </circle> <!-- Legend --> <rect x="20" y="340" width="100" height="50" rx="8" fill="rgba(0,0,0,0.3)" /> <circle cx="35" cy="355" r="5" fill="#ef4444" /> <text x="45" y="359" fill="white" font-size="10">
          High Risk
         </text> <circle cx="35" cy="375" r="5" fill="#f59e0b" /> <text x="45" y="379" fill="white" font-size="10">
          Moderate
         </text>
        </svg>
       </div>
      </div>
     </div>
    </div><!-- Features Grid -->
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
     <div class="glass-card p-6 text-center">
      <div class="text-4xl mb-3">
       ğŸ¯
      </div>
      <h3 class="text-white font-bold text-lg mb-2">Role-Based Training</h3>
      <p class="text-blue-100 text-sm">Practice as Incident Commander, Operations, Planning, Logistics, or Finance Chief</p>
     </div>
     <div class="glass-card p-6 text-center">
      <div class="text-4xl mb-3">
       ğŸ—ºï¸
      </div>
      <h3 class="text-white font-bold text-lg mb-2">GeoRiskPH Integration</h3>
      <p class="text-blue-100 text-sm">Real hazard data from HazardHunterPH for authentic scenarios</p>
     </div>
     <div class="glass-card p-6 text-center">
      <div class="text-4xl mb-3">
       ğŸ“Š
      </div>
      <h3 class="text-white font-bold text-lg mb-2">Scientific Scoring</h3>
      <p class="text-blue-100 text-sm">Competency-based rubrics aligned with DRRM standards</p>
     </div>
     <div class="glass-card p-6 text-center">
      <div class="text-4xl mb-3">
       ğŸ›ï¸
      </div>
      <h3 class="text-white font-bold text-lg mb-2">PH Standards</h3>
      <p class="text-blue-100 text-sm">RA 10121, RA 12287, and NDRRMC protocols</p>
     </div>
    </div><!-- Quick Stats -->
    <div class="glass-card p-6">
     <h3 class="text-white font-bold text-xl mb-4">ğŸ“ˆ Training Statistics</h3>
     <div id="stats-display" class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div class="text-center p-4 bg-white/10 rounded-2xl">
       <div class="text-3xl font-bold text-white" id="stat-sessions">
        0
       </div>
       <div class="text-blue-200 text-sm">
        Sessions Completed
       </div>
      </div>
      <div class="text-center p-4 bg-white/10 rounded-2xl">
       <div class="text-3xl font-bold text-white" id="stat-avg-score">
        0%
       </div>
       <div class="text-blue-200 text-sm">
        Average Score
       </div>
      </div>
      <div class="text-center p-4 bg-white/10 rounded-2xl">
       <div class="text-3xl font-bold text-white" id="stat-best-role">
        --
       </div>
       <div class="text-blue-200 text-sm">
        Best Role
       </div>
      </div>
      <div class="text-center p-4 bg-white/10 rounded-2xl">
       <div class="text-3xl font-bold text-white" id="stat-total-decisions">
        0
       </div>
       <div class="text-blue-200 text-sm">
        Decisions Made
       </div>
      </div>
     </div>
    </div>
   </section><!-- Player Setup Screen -->
   <section id="player-setup-screen" class="hidden max-w-4xl mx-auto px-6 py-8">
    <div class="glass-card p-8">
     <h2 class="text-3xl font-bold text-white mb-6 text-center">ğŸ® Start Your Training</h2>
     <div class="space-y-6">
      <div>
       <label class="block text-white font-medium mb-2">Commander Name</label> <input type="text" id="player-name-input" placeholder="Enter your name" class="glass-input w-full px-4 py-3 text-white placeholder-white/50">
      </div>
      <div>
       <label class="block text-white font-medium mb-4">Select Your Role</label>
       <div class="grid md:grid-cols-2 gap-4" id="role-selection">
        <!-- Roles will be rendered here -->
       </div>
      </div>
      <div>
       <label class="block text-white font-medium mb-4">Select Scenario</label>
       <div class="grid gap-4" id="scenario-selection">
        <!-- Scenarios will be rendered here -->
       </div>
      </div><button id="start-simulation-btn" onclick="startSimulation()" class="glass-button w-full py-4 text-white font-bold text-lg mt-6" disabled> ğŸš€ Begin Simulation </button>
     </div>
    </div>
   </section><!-- Simulation Screen -->
   <section id="simulation-screen" class="hidden max-w-7xl mx-auto px-6 py-8">
    <div class="grid lg:grid-cols-3 gap-6">
     <!-- Left Panel - Situation Map -->
     <div class="lg:col-span-2">
      <div class="glass-card p-6 mb-6">
       <div class="flex items-center justify-between mb-4">
        <h3 class="text-white font-bold text-xl">ğŸ—ºï¸ Situation Map - GeoRiskPH</h3>
        <div class="flex items-center gap-4">
         <span class="text-blue-200 text-sm" id="sim-timer">â±ï¸ 00:00</span> <span class="px-3 py-1 bg-red-500/30 rounded-full text-white text-sm" id="sim-phase">Phase 1</span>
        </div>
       </div><!-- Interactive Map -->
       <div id="simulation-map" class="map-container aspect-video bg-gradient-to-br from-blue-900/50 to-blue-800/30 rounded-2xl relative overflow-hidden">
        <!-- Map content rendered dynamically -->
       </div><!-- Map Legend -->
       <div class="flex flex-wrap gap-4 mt-4 text-sm">
        <div class="flex items-center gap-2">
         <span class="w-4 h-4 rounded-full bg-red-500"></span> <span class="text-white">Critical Zone</span>
        </div>
        <div class="flex items-center gap-2">
         <span class="w-4 h-4 rounded-full bg-orange-500"></span> <span class="text-white">Affected Area</span>
        </div>
        <div class="flex items-center gap-2">
         <span class="w-4 h-4 rounded-full bg-green-500"></span> <span class="text-white">Command Post</span>
        </div>
        <div class="flex items-center gap-2">
         <span class="w-4 h-4 rounded-full bg-blue-400"></span> <span class="text-white">Resources</span>
        </div>
       </div>
      </div><!-- Incident Briefing -->
      <div class="glass-card p-6">
       <h3 class="text-white font-bold text-lg mb-3">ğŸ“‹ Incident Briefing</h3>
       <div id="incident-briefing" class="text-blue-100 space-y-3">
        <!-- Briefing content -->
       </div>
      </div>
     </div><!-- Right Panel - Decision Making -->
     <div class="space-y-6">
      <!-- Current Objective -->
      <div class="glass-card p-6">
       <h3 class="text-white font-bold text-lg mb-3">ğŸ¯ Current Objective</h3>
       <div id="current-objective" class="text-blue-100">
        <!-- Objective content -->
       </div>
      </div><!-- Decision Options -->
      <div class="glass-card p-6">
       <div class="flex items-center justify-between mb-4">
        <h3 class="text-white font-bold text-lg">âš¡ Make Your Decision</h3>
        <div id="decision-timer" class="text-2xl font-bold text-yellow-400">
         30
        </div>
       </div>
       <div id="decision-options" class="space-y-3">
        <!-- Decision buttons -->
       </div>
      </div><!-- Score Progress -->
      <div class="glass-card p-6">
       <h3 class="text-white font-bold text-lg mb-3">ğŸ“Š Performance</h3>
       <div class="space-y-4">
        <div>
         <div class="flex justify-between text-sm mb-1">
          <span class="text-blue-200">Decision Accuracy</span> <span class="text-white" id="accuracy-percent">0%</span>
         </div>
         <div class="h-3 bg-white/20 rounded-full overflow-hidden">
          <div id="accuracy-bar" class="h-full bg-gradient-to-r from-green-400 to-emerald-500 progress-fill" style="width: 0%"></div>
         </div>
        </div>
        <div>
         <div class="flex justify-between text-sm mb-1">
          <span class="text-blue-200">Time Efficiency</span> <span class="text-white" id="efficiency-percent">100%</span>
         </div>
         <div class="h-3 bg-white/20 rounded-full overflow-hidden">
          <div id="efficiency-bar" class="h-full bg-gradient-to-r from-blue-400 to-cyan-500 progress-fill" style="width: 100%"></div>
         </div>
        </div>
        <div class="pt-3 border-t border-white/20">
         <div class="flex justify-between">
          <span class="text-blue-200">Current Score</span> <span class="text-2xl font-bold text-white" id="current-score">0</span>
         </div>
        </div>
       </div>
      </div><!-- ICS Reference -->
      <div class="glass-card p-4">
       <button onclick="toggleReference()" class="w-full flex items-center justify-between text-white"> <span class="font-medium">ğŸ“– ICS Quick Reference</span>
        <svg id="ref-arrow" class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg></button>
       <div id="ics-reference" class="hidden mt-4 text-sm text-blue-100 space-y-2">
        <p><strong>Command:</strong> Overall incident management</p>
        <p><strong>Operations:</strong> Tactical operations</p>
        <p><strong>Planning:</strong> Information gathering &amp; planning</p>
        <p><strong>Logistics:</strong> Resources &amp; facilities</p>
        <p><strong>Finance:</strong> Cost tracking &amp; procurement</p>
       </div>
      </div>
     </div>
    </div>
   </section><!-- Results Screen -->
   <section id="results-screen" class="hidden max-w-4xl mx-auto px-6 py-8">
    <div class="glass-card p-8 text-center">
     <div class="mb-6">
      <div id="result-badge" class="w-32 h-32 mx-auto mb-4 rounded-full flex items-center justify-center text-6xl">
       ğŸ†
      </div>
      <h2 id="result-title" class="text-3xl font-bold text-white mb-2">Simulation Complete!</h2>
      <p id="result-subtitle" class="text-blue-200">Great work, Commander!</p>
     </div><!-- Score Breakdown -->
     <div class="grid md:grid-cols-2 gap-6 mb-8">
      <div class="glass-card p-6">
       <h3 class="text-white font-bold text-lg mb-4">ğŸ“Š Score Breakdown</h3>
       <div class="space-y-4" id="score-breakdown">
        <!-- Score details -->
       </div>
      </div>
      <div class="glass-card p-6">
       <h3 class="text-white font-bold text-lg mb-4">ğŸ“‹ Rubric Assessment</h3>
       <div class="space-y-3" id="rubric-assessment">
        <!-- Rubric details -->
       </div>
      </div>
     </div><!-- Final Score -->
     <div class="glass-card p-6 mb-6">
      <div class="text-6xl font-bold text-white mb-2" id="final-score">
       0
      </div>
      <div class="text-blue-200" id="final-grade">
       Score Grade
      </div>
      <div class="mt-4 h-4 bg-white/20 rounded-full overflow-hidden max-w-md mx-auto">
       <div id="final-score-bar" class="h-full bg-gradient-to-r from-blue-400 via-green-400 to-yellow-400 progress-fill" style="width: 0%"></div>
      </div>
     </div>
     <div class="flex flex-wrap justify-center gap-4">
      <button onclick="restartSimulation()" class="glass-button px-8 py-3 text-white font-semibold"> ğŸ”„ Try Again </button> <button onclick="showScreen('player-setup')" class="glass-card px-8 py-3 text-white font-medium hover:bg-white/20"> ğŸ® New Scenario </button> <button onclick="showScreen('home')" class="glass-card px-8 py-3 text-white font-medium hover:bg-white/20"> ğŸ  Home </button>
     </div>
    </div>
   </section><!-- Leaderboard Screen -->
   <section id="leaderboard-screen" class="hidden max-w-4xl mx-auto px-6 py-8">
    <div class="glass-card p-8">
     <h2 class="text-3xl font-bold text-white mb-6 text-center">ğŸ† Training Leaderboard</h2>
     <div id="leaderboard-content" class="space-y-4">
      <!-- Leaderboard entries -->
     </div>
     <div id="empty-leaderboard" class="hidden text-center py-12">
      <div class="text-6xl mb-4">
       ğŸ“Š
      </div>
      <p class="text-blue-200 text-lg">No training sessions yet!</p>
      <p class="text-blue-300 text-sm mt-2">Complete a simulation to appear on the leaderboard.</p>
     </div>
    </div>
   </section><!-- Learn ICS Screen -->
   <section id="learn-screen" class="hidden max-w-6xl mx-auto px-6 py-8 overflow-y-auto"><!-- Header -->
    <div class="glass-card p-8 mb-8">
     <h2 class="text-4xl font-bold text-white mb-3">ğŸ“š Philippine Incident Command System (ICS)</h2>
     <p class="text-blue-100 text-lg">Formally adopted under Republic Act 10121 (Disaster Risk Reduction and Management Act of 2010)</p>
    </div><!-- Introduction -->
    <div class="glass-card p-6 mb-8">
     <h3 class="text-xl font-bold text-white mb-4">ğŸ‡µğŸ‡­ What is ICS in the Philippine Context?</h3>
     <div class="grid md:grid-cols-2 gap-6">
      <div>
       <p class="text-blue-100 mb-4">The Philippine Incident Command System is a standardized, on-scene disaster response mechanism formalized by the <strong class="text-white">National Disaster Risk Reduction and Management Council (NDRRMC)</strong>. It ensures coordination among agencies during emergencies.</p>
       <div class="space-y-3">
        <div class="flex items-start gap-3"><span class="text-2xl">âœ“</span>
         <div>
          <p class="font-bold text-white">Unity of Command</p>
          <p class="text-sm text-blue-200">Single authority structure in chaotic situations</p>
         </div>
        </div>
        <div class="flex items-start gap-3"><span class="text-2xl">âœ“</span>
         <div>
          <p class="font-bold text-white">Multi-Agency Coordination</p>
          <p class="text-sm text-blue-200">Harmonizes LGUs, national agencies, NGOs, and volunteers</p>
         </div>
        </div>
        <div class="flex items-start gap-3"><span class="text-2xl">âœ“</span>
         <div>
          <p class="font-bold text-white">Legal Mandate</p>
          <p class="text-sm text-blue-200">Mandatory adoption under RA 10121 and RA 12287</p>
         </div>
        </div>
        <div class="flex items-start gap-3"><span class="text-2xl">âœ“</span>
         <div>
          <p class="font-bold text-white">Scalability</p>
          <p class="text-sm text-blue-200">Expands/contracts from barangay to national level</p>
         </div>
        </div>
       </div>
      </div>
      <div class="glass-surface p-6 rounded-2xl">
       <p class="font-bold text-white mb-3">Key Principles</p>
       <ul class="text-blue-100 text-sm space-y-2">
        <li>ğŸ¯ <strong>Clear Accountability:</strong> Avoids duplication of efforts</li>
        <li>ğŸ“‹ <strong>Standardized Procedures:</strong> Consistent across all incidents</li>
        <li>ğŸ”„ <strong>Integrated Response:</strong> Barangay to national levels</li>
        <li>ğŸ’¡ <strong>Efficient Resource Use:</strong> Transparent financial management</li>
        <li>ğŸ¤ <strong>Responder Safety:</strong> Safety Officer ensures protocol compliance</li>
       </ul>
      </div>
     </div>
    </div><!-- ICS Organizational Chart -->
    <div class="glass-card p-8 mb-8">
     <h3 class="text-2xl font-bold text-white mb-6">ğŸ“Š Philippine ICS Organizational Structure</h3>
     <div class="bg-white/5 rounded-2xl p-8 overflow-x-auto">
      <svg viewbox="0 0 1000 700" class="w-full h-auto min-w-max"><defs>
        <lineargradient id="icGrad" x1="0%" y1="0%" x2="100%" y2="100%">
         <stop offset="0%" style="stop-color:rgba(239,68,68,0.3)" />
         <stop offset="100%" style="stop-color:rgba(239,68,68,0.1)" />
        </lineargradient>
        <lineargradient id="cmdGrad" x1="0%" y1="0%" x2="100%" y2="100%">
         <stop offset="0%" style="stop-color:rgba(245,158,11,0.3)" />
         <stop offset="100%" style="stop-color:rgba(245,158,11,0.1)" />
        </lineargradient>
        <lineargradient id="staffGrad" x1="0%" y1="0%" x2="100%" y2="100%">
         <stop offset="0%" style="stop-color:rgba(59,130,246,0.3)" />
         <stop offset="100%" style="stop-color:rgba(59,130,246,0.1)" />
        </lineargradient>
       </defs> <!-- IC Box (Top) --> <rect x="350" y="10" width="300" height="80" rx="12" fill="url(#icGrad)" stroke="rgba(239,68,68,0.6)" stroke-width="2" /> <text x="500" y="45" text-anchor="middle" font-size="18" font-weight="bold" fill="white">
        Incident Commander (IC)
       </text> <text x="500" y="65" text-anchor="middle" font-size="12" fill="rgba(255,255,255,0.8)">
        Overall Authority &amp; Direction
       </text> <!-- Lines from IC --> <line x1="500" y1="90" x2="500" y2="120" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <line x1="150" y1="120" x2="850" y2="120" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <!-- Command Staff Section --> <line x1="150" y1="120" x2="150" y2="150" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <line x1="300" y1="120" x2="300" y2="150" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <line x1="500" y1="120" x2="500" y2="150" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <line x1="700" y1="120" x2="700" y2="150" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <line x1="850" y1="120" x2="850" y2="150" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <!-- PIO --> <rect x="80" y="150" width="140" height="70" rx="10" fill="url(#cmdGrad)" stroke="rgba(245,158,11,0.5)" stroke-width="2" /> <text x="150" y="175" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
        ğŸ“¢ PIO
       </text> <text x="150" y="195" text-anchor="middle" font-size="11" fill="rgba(255,255,255,0.8)">
        Public Information
       </text> <text x="150" y="210" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.7)">
        Media &amp; Communication
       </text> <!-- Safety Officer --> <rect x="230" y="150" width="140" height="70" rx="10" fill="url(#cmdGrad)" stroke="rgba(245,158,11,0.5)" stroke-width="2" /> <text x="300" y="175" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
        âš ï¸ Safety
       </text> <text x="300" y="195" text-anchor="middle" font-size="11" fill="rgba(255,255,255,0.8)">
        Responder &amp; Public
       </text> <text x="300" y="210" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.7)">
        Safety Compliance
       </text> <!-- Liaison Officer --> <rect x="430" y="150" width="140" height="70" rx="10" fill="url(#cmdGrad)" stroke="rgba(245,158,11,0.5)" stroke-width="2" /> <text x="500" y="175" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
        ğŸ¤ Liaison
       </text> <text x="500" y="195" text-anchor="middle" font-size="11" fill="rgba(255,255,255,0.8)">
        Multi-Agency
       </text> <text x="500" y="210" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.7)">
        Coordination
       </text> <!-- General Staff Section --> <line x1="150" y1="270" x2="150" y2="300" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <line x1="150" y1="300" x2="850" y2="300" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <line x1="300" y1="300" x2="300" y2="330" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <line x1="500" y1="300" x2="500" y2="330" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <line x1="700" y1="300" x2="700" y2="330" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <line x1="850" y1="300" x2="850" y2="330" stroke="rgba(255,255,255,0.3)" stroke-width="2" /> <!-- Operations Section --> <rect x="180" y="330" width="240" height="90" rx="10" fill="url(#staffGrad)" stroke="rgba(59,130,246,0.5)" stroke-width="2" /> <text x="300" y="355" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
        âš™ï¸ Operations Section
       </text> <text x="300" y="378" text-anchor="middle" font-size="11" fill="rgba(255,255,255,0.9)">
        Search &amp; Rescue
       </text> <text x="300" y="395" text-anchor="middle" font-size="11" fill="rgba(255,255,255,0.9)">
        Evacuation â€¢ Medical â€¢ Security
       </text> <text x="300" y="412" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.7)">
        Tactical Response Units
       </text> <!-- Planning Section --> <rect x="430" y="330" width="240" height="90" rx="10" fill="url(#staffGrad)" stroke="rgba(59,130,246,0.5)" stroke-width="2" /> <text x="550" y="355" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
        ğŸ“‹ Planning Section
       </text> <text x="550" y="378" text-anchor="middle" font-size="11" fill="rgba(255,255,255,0.9)">
        Intelligence &amp; Analysis
       </text> <text x="550" y="395" text-anchor="middle" font-size="11" fill="rgba(255,255,255,0.9)">
        Incident Action Plans (IAP)
       </text> <text x="550" y="412" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.7)">
        Future Projections &amp; Planning
       </text> <!-- Logistics Section --> <rect x="680" y="330" width="240" height="90" rx="10" fill="url(#staffGrad)" stroke="rgba(59,130,246,0.5)" stroke-width="2" /> <text x="800" y="355" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
        ğŸ“¦ Logistics Section
       </text> <text x="800" y="378" text-anchor="middle" font-size="11" fill="rgba(255,255,255,0.9)">
        Equipment &amp; Supplies
       </text> <text x="800" y="395" text-anchor="middle" font-size="11" fill="rgba(255,255,255,0.9)">
        Transport â€¢ Facilities â€¢ Food
       </text> <text x="800" y="412" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.7)">
        Responder Support
       </text> <!-- Finance Section --> <rect x="430" y="540" width="240" height="90" rx="10" fill="url(#staffGrad)" stroke="rgba(59,130,246,0.5)" stroke-width="2" /> <text x="550" y="565" text-anchor="middle" font-size="14" font-weight="bold" fill="white">
        ğŸ’° Finance/Admin Section
       </text> <text x="550" y="588" text-anchor="middle" font-size="11" fill="rgba(255,255,255,0.9)">
        Cost Tracking &amp; Procurement
       </text> <text x="550" y="605" text-anchor="middle" font-size="11" fill="rgba(255,255,255,0.9)">
        Contracts â€¢ Accountability
       </text> <text x="550" y="622" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.7)">
        Financial Transparency
       </text> <!-- Connection to Finance --> <line x1="550" y1="420" x2="550" y2="540" stroke="rgba(255,255,255,0.3)" stroke-width="2" />
      </svg>
     </div>
    </div><!-- Core ICS Roles Details -->
    <div class="glass-card p-8 mb-8">
     <h3 class="text-2xl font-bold text-white mb-6">ğŸ”‘ Core ICS Roles &amp; Functions</h3>
     <div class="space-y-4"><!-- IC -->
      <div class="glass-surface p-4 rounded-xl">
       <div class="flex items-start gap-4">
        <div class="text-3xl">
         ğŸ‘¨â€âœˆï¸
        </div>
        <div class="flex-1">
         <h4 class="font-bold text-white text-lg mb-2">Incident Commander (IC)</h4>
         <p class="text-blue-100 mb-3">Overall authority at the incident site. Responsible for setting objectives, strategies, and priorities.</p>
         <ul class="text-sm text-blue-100 space-y-1">
          <li>âœ“ Sets incident objectives and strategies</li>
          <li>âœ“ Ensures compliance with RA 10121 protocols</li>
          <li>âœ“ Maintains NDRRMC coordination standards</li>
          <li>âœ“ Makes critical decisions under uncertainty</li>
         </ul>
        </div>
       </div>
      </div><!-- Command Staff -->
      <div class="glass-surface p-4 rounded-xl">
       <div class="flex items-start gap-4">
        <div class="text-3xl">
         ğŸ‘¥
        </div>
        <div class="flex-1">
         <h4 class="font-bold text-white text-lg mb-2">Command Staff (Supporting IC)</h4>
         <p class="text-blue-100 mb-3">Specialized support personnel assisting the IC in key areas:</p>
         <div class="grid md:grid-cols-3 gap-4 mt-3">
          <div class="bg-white/10 p-3 rounded-lg">
           <p class="font-bold text-white">ğŸ“¢ PIO</p>
           <p class="text-sm text-blue-200 mt-1">Manages communication with public and media</p>
          </div>
          <div class="bg-white/10 p-3 rounded-lg">
           <p class="font-bold text-white">âš ï¸ Safety Officer</p>
           <p class="text-sm text-blue-200 mt-1">Ensures responder and public safety</p>
          </div>
          <div class="bg-white/10 p-3 rounded-lg">
           <p class="font-bold text-white">ğŸ¤ Liaison Officer</p>
           <p class="text-sm text-blue-200 mt-1">Coordinates with LGUs, NGOs, agencies</p>
          </div>
         </div>
        </div>
       </div>
      </div><!-- Operations Chief -->
      <div class="glass-surface p-4 rounded-xl">
       <div class="flex items-start gap-4">
        <div class="text-3xl">
         âš™ï¸
        </div>
        <div class="flex-1">
         <h4 class="font-bold text-white text-lg mb-2">Operations Section Chief</h4>
         <p class="text-blue-100 mb-3">Directs tactical response actions to achieve incident objectives.</p>
         <ul class="text-sm text-blue-100 space-y-1">
          <li>âœ“ Manages Search and Rescue operations</li>
          <li>âœ“ Coordinates evacuation efforts</li>
          <li>âœ“ Directs medical response teams</li>
          <li>âœ“ Coordinates field units and execution of Incident Action Plans</li>
         </ul>
        </div>
       </div>
      </div><!-- Planning Chief -->
      <div class="glass-surface p-4 rounded-xl">
       <div class="flex items-start gap-4">
        <div class="text-3xl">
         ğŸ“‹
        </div>
        <div class="flex-1">
         <h4 class="font-bold text-white text-lg mb-2">Planning Section Chief</h4>
         <p class="text-blue-100 mb-3">Collects and analyzes incident data for strategic planning.</p>
         <ul class="text-sm text-blue-100 space-y-1">
          <li>âœ“ Gathers intelligence and situational data</li>
          <li>âœ“ Prepares Incident Action Plans (IAPs)</li>
          <li>âœ“ Anticipates future needs and trends</li>
          <li>âœ“ Critical for adapting to evolving disaster scenarios</li>
         </ul>
        </div>
       </div>
      </div><!-- Logistics Chief -->
      <div class="glass-surface p-4 rounded-xl">
       <div class="flex items-start gap-4">
        <div class="text-3xl">
         ğŸ“¦
        </div>
        <div class="flex-1">
         <h4 class="font-bold text-white text-lg mb-2">Logistics Section Chief</h4>
         <p class="text-blue-100 mb-3">Provides resources and services to support incident operations.</p>
         <ul class="text-sm text-blue-100 space-y-1">
          <li>âœ“ Procures equipment and supplies</li>
          <li>âœ“ Manages facilities and transportation</li>
          <li>âœ“ Coordinates communications systems</li>
          <li>âœ“ Ensures responders have necessary support</li>
         </ul>
        </div>
       </div>
      </div><!-- Finance Chief -->
      <div class="glass-surface p-4 rounded-xl">
       <div class="flex items-start gap-4">
        <div class="text-3xl">
         ğŸ’°
        </div>
        <div class="flex-1">
         <h4 class="font-bold text-white text-lg mb-2">Finance/Administration Section Chief</h4>
         <p class="text-blue-100 mb-3">Monitors costs and provides accountability and transparency.</p>
         <ul class="text-sm text-blue-100 space-y-1">
          <li>âœ“ Tracks all incident-related costs</li>
          <li>âœ“ Processes procurement and contracts</li>
          <li>âœ“ Manages responder compensation and claims</li>
          <li>âœ“ Maintains detailed financial records</li>
         </ul>
        </div>
       </div>
      </div>
     </div>
    </div><!-- Philippine Integration -->
    <div class="glass-card p-8 mb-8">
     <h3 class="text-2xl font-bold text-white mb-6">ğŸ‡µğŸ‡­ Philippine-Specific Emphasis</h3>
     <div class="grid md:grid-cols-2 gap-6">
      <div class="glass-surface p-5 rounded-xl">
       <p class="font-bold text-white text-lg mb-3">ğŸ“ Integration with PDRRMS</p>
       <p class="text-blue-100 text-sm">ICS is embedded within the Philippine Disaster Risk Reduction and Management System, ensuring alignment from barangay to national levels. Each LGU operates within the unified command structure.</p>
      </div>
      <div class="glass-surface p-5 rounded-xl">
       <p class="font-bold text-white text-lg mb-3">ğŸ¤ Multi-Agency Coordination</p>
       <p class="text-blue-100 text-sm">ICS roles are designed to harmonize efforts of LGUs, national agencies (DILG, PNP, AFP), NGOs, and community volunteers under one command structure.</p>
      </div>
      <div class="glass-surface p-5 rounded-xl">
       <p class="font-bold text-white text-lg mb-3">âš–ï¸ Legal Mandate</p>
       <p class="text-blue-100 text-sm">RA 10121 mandates ICS adoption in disaster response operations, making it not just best practice but a regulatory obligation. Compliance is essential for all response operations.</p>
      </div>
      <div class="glass-surface p-5 rounded-xl">
       <p class="font-bold text-white text-lg mb-3">ğŸ“ Training &amp; Compliance</p>
       <p class="text-blue-100 text-sm">NDRRMC guidelines emphasize regular ICS training, simulation exercises, and adherence to communication standards to avoid fragmented response and ensure readiness.</p>
      </div>
     </div>
    </div><!-- Why ICS Matters -->
    <div class="glass-card p-8 mb-8">
     <h3 class="text-2xl font-bold text-white mb-6">ğŸ§­ Why ICS Matters in the Philippines</h3>
     <div class="space-y-4">
      <div class="flex gap-4 items-start"><span class="text-4xl">ğŸŒ€</span>
       <div>
        <p class="font-bold text-white">Effective Response to Natural Disasters</p>
        <p class="text-blue-100 text-sm mt-1">Typhoons, earthquakes, and floods require coordinated response across multiple agencies. ICS provides the framework for unified action.</p>
       </div>
      </div>
      <div class="flex gap-4 items-start"><span class="text-4xl">âš¡</span>
       <div>
        <p class="font-bold text-white">Clear Command &amp; Accountability</p>
        <p class="text-blue-100 text-sm mt-1">Unity of command eliminates confusion. Every responder knows their role and the chain of authority, avoiding duplicate efforts.</p>
       </div>
      </div>
      <div class="flex gap-4 items-start"><span class="text-4xl">ğŸ”—</span>
       <div>
        <p class="font-bold text-white">Strengthened Inter-Agency Coordination</p>
        <p class="text-blue-100 text-sm mt-1">The Liaison Officer role ensures LGUs, national agencies, NGOs, and community groups work cohesively without gaps or overlaps.</p>
       </div>
      </div>
      <div class="flex gap-4 items-start"><span class="text-4xl">ğŸ’¡</span>
       <div>
        <p class="font-bold text-white">Efficient Resource Use &amp; Transparency</p>
        <p class="text-blue-100 text-sm mt-1">Finance/Admin section ensures accountability. Resources are allocated based on need, not politics, with full documentation.</p>
       </div>
      </div>
      <div class="flex gap-4 items-start"><span class="text-4xl">ğŸ“ˆ</span>
       <div>
        <p class="font-bold text-white">Scalability from Local to National</p>
        <p class="text-blue-100 text-sm mt-1">The structure expands or contracts depending on incident sizeâ€”from barangay floods to nationwide typhoonsâ€”maintaining consistency.</p>
       </div>
      </div>
     </div>
    </div><!-- Scoring Rubrics -->
    <div class="glass-card p-8 mb-8">
     <h3 class="text-2xl font-bold text-white mb-6">ğŸ“Š Scientific Scoring Rubrics</h3>
     <div class="overflow-x-auto">
      <table class="w-full text-sm">
       <thead>
        <tr class="text-left border-b border-white/20">
         <th class="p-3 text-white font-bold">Competency</th>
         <th class="p-3 text-white font-bold">Exemplary (4)</th>
         <th class="p-3 text-white font-bold">Proficient (3)</th>
         <th class="p-3 text-white font-bold">Developing (2)</th>
         <th class="p-3 text-white font-bold">Beginning (1)</th>
        </tr>
       </thead>
       <tbody class="text-blue-100">
        <tr class="border-b border-white/10">
         <td class="p-3 font-medium text-white">Decision Speed</td>
         <td class="p-3">&lt; 10 sec</td>
         <td class="p-3">10-20 sec</td>
         <td class="p-3">20-30 sec</td>
         <td class="p-3">&gt; 30 sec</td>
        </tr>
        <tr class="border-b border-white/10">
         <td class="p-3 font-medium text-white">Protocol Adherence</td>
         <td class="p-3">100% correct</td>
         <td class="p-3">85-99%</td>
         <td class="p-3">70-84%</td>
         <td class="p-3">&lt; 70%</td>
        </tr>
        <tr class="border-b border-white/10">
         <td class="p-3 font-medium text-white">Resource Management</td>
         <td class="p-3">Optimal use</td>
         <td class="p-3">Efficient</td>
         <td class="p-3">Adequate</td>
         <td class="p-3">Inefficient</td>
        </tr>
        <tr>
         <td class="p-3 font-medium text-white">Communication</td>
         <td class="p-3">Clear &amp; timely</td>
         <td class="p-3">Mostly clear</td>
         <td class="p-3">Needs work</td>
         <td class="p-3">Unclear</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
    <div class="text-center">
     <button onclick="showScreen('home')" class="glass-button px-8 py-3 text-white font-semibold rounded-lg"> â† Back to Home </button>
    </div>
   </section>
  </div>
  <script>
    // ============================================
    // Configuration & State Management
    // ============================================
    
    const defaultConfig = {
      app_title: 'ICS Commander PH',
      welcome_message: 'Master Incident Command',
      background_color: '#0052a5',
      surface_color: 'rgba(255,255,255,0.25)',
      text_color: '#ffffff',
      primary_action: '#0066cc',
      secondary_action: '#1a73e8'
    };
    
    let config = { ...defaultConfig };
    let allRecords = [];
    let selectedRole = null;
    let selectedScenario = null;
    let currentDecisionIndex = 0;
    let simulationScore = 0;
    let correctDecisions = 0;
    let totalDecisions = 0;
    let decisionTimer = null;
    let simulationTimer = null;
    let simulationStartTime = null;
    let currentPlayerName = '';
    
    // ============================================
    // ICS Roles Definition (Philippine Standards)
    // ============================================
    
    const ICS_ROLES = [
      {
        id: 'incident_commander',
        title: 'Incident Commander',
        icon: 'ğŸ‘¨â€âœˆï¸',
        description: 'Overall incident management authority. Sets objectives and priorities.',
        responsibilities: ['Set incident objectives', 'Manage overall incident', 'Ensure safety', 'Coordinate with agencies'],
        color: 'from-red-500 to-orange-500'
      },
      {
        id: 'operations_chief',
        title: 'Operations Section Chief',
        icon: 'âš™ï¸',
        description: 'Manages tactical operations to achieve incident objectives.',
        responsibilities: ['Direct tactical operations', 'Manage field resources', 'Report to IC', 'Execute IAP'],
        color: 'from-orange-500 to-yellow-500'
      },
      {
        id: 'planning_chief',
        title: 'Planning Section Chief',
        icon: 'ğŸ“‹',
        description: 'Collects and evaluates information for incident planning.',
        responsibilities: ['Gather intelligence', 'Prepare IAP', 'Track resources', 'Document incident'],
        color: 'from-blue-500 to-cyan-500'
      },
      {
        id: 'logistics_chief',
        title: 'Logistics Section Chief',
        icon: 'ğŸ“¦',
        description: 'Provides resources and services to support incident operations.',
        responsibilities: ['Procure resources', 'Manage facilities', 'Provide communications', 'Support personnel'],
        color: 'from-green-500 to-emerald-500'
      },
      {
        id: 'finance_chief',
        title: 'Finance/Admin Section Chief',
        icon: 'ğŸ’°',
        description: 'Monitors costs and provides accounting and procurement services.',
        responsibilities: ['Track costs', 'Process claims', 'Manage contracts', 'Maintain records'],
        color: 'from-purple-500 to-pink-500'
      }
    ];
    
    // ============================================
    // Scenarios (Based on Philippine Hazards)
    // ============================================
    
    const SCENARIOS = [
      {
        id: 'typhoon_response',
        title: 'ğŸŒ€ Super Typhoon Response',
        description: 'Signal No. 5 typhoon making landfall in Eastern Visayas. Mass evacuation and rescue operations required.',
        difficulty: 'Hard',
        hazardType: 'Typhoon',
        location: 'Eastern Visayas',
        coordinates: { lat: 11.5, lng: 125 },
        briefing: `
          <p class="font-bold text-white">INCIDENT SITUATION REPORT</p>
          <p class="mt-2"><strong>Incident Type:</strong> Super Typhoon (Signal No. 5)</p>
          <p><strong>Location:</strong> Eastern Visayas Region</p>
          <p><strong>Time:</strong> ${new Date().toLocaleString()}</p>
          <p class="mt-3"><strong>Current Status:</strong></p>
          <ul class="list-disc ml-5 mt-1">
            <li>Wind speeds: 220+ km/h sustained</li>
            <li>Storm surge warning: 5-6 meters</li>
            <li>Affected population: ~2.5 million</li>
            <li>Evacuation centers: 85% capacity</li>
          </ul>
          <p class="mt-3"><strong>GeoRiskPH HazardHunter Data:</strong></p>
          <ul class="list-disc ml-5 mt-1">
            <li>Flood susceptibility: HIGH</li>
            <li>Landslide prone areas: 23 barangays</li>
            <li>Storm surge zones: Coastal communities</li>
          </ul>
        `,
        decisions: [
          {
            phase: 'Initial Response',
            objective: 'Establish Incident Command Post',
            question: 'Where should you establish the ICP based on GeoRiskPH flood and storm surge data?',
            options: [
              { text: 'Provincial Capitol (inland, elevated)', correct: true, points: 100, feedback: 'Correct! Per ICS protocols, ICP should be in a safe, accessible location away from hazard zones.' },
              { text: 'Coastal Municipal Hall', correct: false, points: 20, feedback: 'Risky choice. Storm surge zones are not suitable for ICP as per NDRRMC guidelines.' },
              { text: 'Near the affected area for faster response', correct: false, points: 30, feedback: 'While proximity helps, safety is priority. RA 10121 emphasizes responder safety first.' },
              { text: 'Wait for the typhoon to pass', correct: false, points: 10, feedback: 'Incorrect. ICP must be established immediately per ICS protocols.' }
            ]
          },
          {
            phase: 'Resource Mobilization',
            objective: 'Deploy Search and Rescue Teams',
            question: 'How should you prioritize SAR deployment based on hazard mapping?',
            options: [
              { text: 'Deploy to high-risk flood and landslide areas first', correct: true, points: 100, feedback: 'Excellent! Using GeoRiskPH data for prioritization aligns with DRRM best practices.' },
              { text: 'Deploy equally to all areas', correct: false, points: 40, feedback: 'Resources should be prioritized based on risk assessment per RA 12287.' },
              { text: 'Wait for distress calls before deploying', correct: false, points: 20, feedback: 'Proactive deployment is essential. Pre-positioned resources save lives.' },
              { text: 'Focus only on urban areas', correct: false, points: 30, feedback: 'Rural areas often have higher vulnerability and less local capacity.' }
            ]
          },
          {
            phase: 'Operations',
            objective: 'Manage Evacuation Centers',
            question: 'An evacuation center reports overcrowding (150% capacity). What is your priority action?',
            options: [
              { text: 'Activate secondary evacuation sites and coordinate transport', correct: true, points: 100, feedback: 'Correct! Per DSWD guidelines, overcrowding requires immediate decongestion.' },
              { text: 'Ask evacuees to return home', correct: false, points: 0, feedback: 'Dangerous! Sending people back during active typhoon violates duty of care.' },
              { text: 'Request military to enforce capacity limits', correct: false, points: 30, feedback: 'Enforcement is not the priority; providing safe alternatives is.' },
              { text: 'Document and report only', correct: false, points: 20, feedback: 'Documentation is important but immediate action is required.' }
            ]
          },
          {
            phase: 'Coordination',
            objective: 'Inter-Agency Coordination',
            question: 'Multiple agencies are responding without coordination. How do you establish unified command?',
            options: [
              { text: 'Convene immediate coordination meeting with all agency heads', correct: true, points: 100, feedback: 'Per ICS, unified command requires face-to-face coordination among agency representatives.' },
              { text: 'Issue orders to all agencies', correct: false, points: 30, feedback: 'Other agencies have their own chains of command. Coordination, not command, is key.' },
              { text: 'Let each agency operate independently', correct: false, points: 10, feedback: 'This leads to resource duplication and gaps. ICS requires integration.' },
              { text: 'Report to NDRRMC and wait for instructions', correct: false, points: 40, feedback: 'Local ICS should be self-sufficient initially per RA 10121.' }
            ]
          },
          {
            phase: 'Recovery Transition',
            objective: 'Begin Early Recovery Planning',
            question: 'As the typhoon passes, what should be your immediate planning priority?',
            options: [
              { text: 'Rapid damage assessment using DANA protocols', correct: true, points: 100, feedback: 'Correct! DANA is mandated for post-disaster assessment under DRRM framework.' },
              { text: 'Immediately declare calamity status', correct: false, points: 50, feedback: 'Calamity declaration requires assessment data first per RA 10121.' },
              { text: 'Stand down ICS operations', correct: false, points: 20, feedback: 'ICS continues through recovery phase. Premature demobilization is harmful.' },
              { text: 'Focus only on rescue operations', correct: false, points: 40, feedback: 'Response and recovery should be parallel processes.' }
            ]
          }
        ]
      },
      {
        id: 'earthquake_response',
        title: 'ğŸšï¸ Major Earthquake Response',
        description: 'Magnitude 7.2 earthquake strikes Metro Manila. Building collapses and infrastructure damage reported.',
        difficulty: 'Hard',
        hazardType: 'Earthquake',
        location: 'Metro Manila',
        coordinates: { lat: 14.6, lng: 121 },
        briefing: `
          <p class="font-bold text-white">INCIDENT SITUATION REPORT</p>
          <p class="mt-2"><strong>Incident Type:</strong> Major Earthquake (M7.2)</p>
          <p><strong>Location:</strong> Metro Manila and surrounding provinces</p>
          <p><strong>Time:</strong> ${new Date().toLocaleString()}</p>
          <p class="mt-3"><strong>Current Status:</strong></p>
          <ul class="list-disc ml-5 mt-1">
            <li>Multiple building collapses reported</li>
            <li>Infrastructure damage: bridges, roads</li>
            <li>Power and communications disrupted</li>
            <li>Hospitals overwhelmed</li>
          </ul>
          <p class="mt-3"><strong>GeoRiskPH Data:</strong></p>
          <ul class="list-disc ml-5 mt-1">
            <li>Liquefaction zones: Coastal areas, reclaimed land</li>
            <li>Ground shaking amplification: Soft soil areas</li>
            <li>Fault lines: West Valley Fault active</li>
          </ul>
        `,
        decisions: [
          {
            phase: 'Initial Response',
            objective: 'Establish Communications',
            question: 'Communications infrastructure is down. What is your first action?',
            options: [
              { text: 'Activate emergency radio network and satellite phones', correct: true, points: 100, feedback: 'Correct! Redundant communications are essential per ICS protocols.' },
              { text: 'Wait for cell towers to be restored', correct: false, points: 10, feedback: 'Waiting is not an option. Alternative communications must be immediate.' },
              { text: 'Send runners with messages', correct: false, points: 40, feedback: 'Traditional methods are backup only. Technology solutions are primary.' },
              { text: 'Use social media', correct: false, points: 30, feedback: 'Social media requires internet which may be unavailable.' }
            ]
          },
          {
            phase: 'Search and Rescue',
            objective: 'Prioritize USAR Operations',
            question: 'Multiple collapsed structures reported. How do you prioritize USAR teams?',
            options: [
              { text: 'Use structural triage: highest survival probability first', correct: true, points: 100, feedback: 'Correct! INSARAG guidelines emphasize maximizing saves with limited resources.' },
              { text: 'Respond to calls in order received', correct: false, points: 30, feedback: 'First-in-first-out is not optimal for multi-site emergencies.' },
              { text: 'Focus on largest buildings only', correct: false, points: 40, feedback: 'Building size doesn\'t correlate with survival probability.' },
              { text: 'Wait for international USAR teams', correct: false, points: 20, feedback: 'Local response is critical in first 72 hours. International teams are augmentation.' }
            ]
          },
          {
            phase: 'Medical Operations',
            objective: 'Manage Mass Casualty',
            question: 'Hospitals are at 200% capacity. What is your priority action?',
            options: [
              { text: 'Establish field medical stations and implement triage protocols', correct: true, points: 100, feedback: 'Correct! Field expansion and START triage are standard mass casualty procedures.' },
              { text: 'Transport all patients to hospitals', correct: false, points: 20, feedback: 'This overwhelms facilities further. Field stabilization is essential.' },
              { text: 'Request military hospital ships', correct: false, points: 40, feedback: 'Good long-term option but immediate field response is priority.' },
              { text: 'Prioritize VIP patients', correct: false, points: 0, feedback: 'Triage must be based on medical need, not status.' }
            ]
          },
          {
            phase: 'Infrastructure',
            objective: 'Critical Infrastructure Assessment',
            question: 'Multiple aftershocks expected. What infrastructure assessment is priority?',
            options: [
              { text: 'Assess dams, bridges, and utilities for immediate hazards', correct: true, points: 100, feedback: 'Correct! Secondary hazards from infrastructure failure can cause more casualties.' },
              { text: 'Assess all buildings systematically', correct: false, points: 50, feedback: 'Important but critical infrastructure takes priority for immediate safety.' },
              { text: 'Wait until aftershocks subside', correct: false, points: 20, feedback: 'Hazards must be identified immediately. Aftershocks continue for days.' },
              { text: 'Focus only on government buildings', correct: false, points: 30, feedback: 'Critical infrastructure affects more people than government facilities.' }
            ]
          },
          {
            phase: 'Public Information',
            objective: 'Crisis Communication',
            question: 'Rumors about a tsunami are spreading. What is your communication strategy?',
            options: [
              { text: 'Issue clear, authoritative statements through all channels with factual updates', correct: true, points: 100, feedback: 'Correct! Transparent, rapid communication counters misinformation per crisis communication protocols.' },
              { text: 'Ignore rumors and focus on operations', correct: false, points: 20, feedback: 'Rumors cause panic. Information management is essential per ICS.' },
              { text: 'Only communicate when you have complete information', correct: false, points: 30, feedback: 'Waiting leads to information vacuum. Regular updates are critical.' },
              { text: 'Arrest people spreading rumors', correct: false, points: 10, feedback: 'Enforcement is not the priority. Correct information is.' }
            ]
          }
        ]
      },
      {
        id: 'flood_response',
        title: 'ğŸŒŠ Urban Flood Emergency',
        description: 'Southwest monsoon enhanced flooding in NCR. Multiple barangays submerged, rescue operations ongoing.',
        difficulty: 'Medium',
        hazardType: 'Flood',
        location: 'National Capital Region',
        coordinates: { lat: 14.5, lng: 121 },
        briefing: `
          <p class="font-bold text-white">INCIDENT SITUATION REPORT</p>
          <p class="mt-2"><strong>Incident Type:</strong> Urban Flooding</p>
          <p><strong>Location:</strong> NCR - Multiple cities affected</p>
          <p><strong>Time:</strong> ${new Date().toLocaleString()}</p>
          <p class="mt-3"><strong>Current Status:</strong></p>
          <ul class="list-disc ml-5 mt-1">
            <li>Continuous heavy rainfall: 100mm+ in 6 hours</li>
            <li>Flood depths: 0.5m to 3m in various areas</li>
            <li>Stranded residents: ~50,000 estimated</li>
            <li>Roads impassable in 40+ barangays</li>
          </ul>
          <p class="mt-3"><strong>GeoRiskPH Flood Data:</strong></p>
          <ul class="list-disc ml-5 mt-1">
            <li>High susceptibility zones: Low-lying areas</li>
            <li>River basin overflow: Marikina, Pasig rivers</li>
            <li>Pump stations: Some non-operational</li>
          </ul>
        `,
        decisions: [
          {
            phase: 'Initial Assessment',
            objective: 'Situational Awareness',
            question: 'Flood waters are rising rapidly. What is your first priority?',
            options: [
              { text: 'Establish real-time monitoring with PAGASA and EFCOS', correct: true, points: 100, feedback: 'Correct! Real-time data is essential for decision-making per RA 10121.' },
              { text: 'Begin immediate rescue operations', correct: false, points: 60, feedback: 'Rescue is important but situational awareness guides effective response.' },
              { text: 'Wait for official flood advisory', correct: false, points: 20, feedback: 'Local monitoring should complement national advisories.' },
              { text: 'Evacuate all flood-prone areas', correct: false, points: 50, feedback: 'Good but needs to be informed by current data.' }
            ]
          },
          {
            phase: 'Rescue Operations',
            objective: 'Deploy Rescue Assets',
            question: 'Rubber boats are limited. How do you prioritize deployment?',
            options: [
              { text: 'Deploy to areas with deepest flooding and most vulnerable populations', correct: true, points: 100, feedback: 'Correct! Prioritization based on risk and vulnerability aligns with DRRM principles.' },
              { text: 'Deploy to areas with most requests', correct: false, points: 50, feedback: 'Request volume may not correlate with actual need.' },
              { text: 'Keep boats in reserve for emergencies', correct: false, points: 20, feedback: 'Current situation IS an emergency. Resources must be deployed.' },
              { text: 'Request additional boats from other regions', correct: false, points: 40, feedback: 'Good for augmentation but immediate deployment with available resources is priority.' }
            ]
          },
          {
            phase: 'Logistics',
            objective: 'Resource Prepositioning',
            question: 'Food and water supplies are running low at evacuation centers. What do you prioritize?',
            options: [
              { text: 'Activate pre-positioned supplies and coordinate with DSWD for resupply', correct: true, points: 100, feedback: 'Correct! Pre-positioning and coordination are DRRM best practices.' },
              { text: 'Purchase supplies from local stores', correct: false, points: 40, feedback: 'May not be sufficient or cost-effective during emergencies.' },
              { text: 'Request donations through media', correct: false, points: 30, feedback: 'Takes time and may result in inappropriate donations.' },
              { text: 'Ration existing supplies', correct: false, points: 50, feedback: 'Rationing is temporary. Resupply coordination is essential.' }
            ]
          },
          {
            phase: 'Health',
            objective: 'Disease Prevention',
            question: 'Flood waters are contaminated. What health measures do you implement?',
            options: [
              { text: 'Deploy health teams for surveillance and distribute water purification supplies', correct: true, points: 100, feedback: 'Correct! DOH protocols require disease surveillance and safe water during floods.' },
              { text: 'Wait until after the flood recedes', correct: false, points: 20, feedback: 'Health response must be concurrent with rescue operations.' },
              { text: 'Issue health advisory only', correct: false, points: 40, feedback: 'Advisories need to be accompanied by concrete interventions.' },
              { text: 'Focus only on injured persons', correct: false, points: 30, feedback: 'Preventive health is equally important as curative care.' }
            ]
          }
        ]
      }
    ];
    
    // ============================================
    // Scoring Rubrics (Scientific Framework)
    // ============================================
    
    const SCORING_RUBRICS = {
      decision_speed: {
        name: 'Decision Speed',
        weight: 0.25,
        levels: [
          { min: 0, max: 10, score: 4, label: 'Exemplary' },
          { min: 10, max: 20, score: 3, label: 'Proficient' },
          { min: 20, max: 30, score: 2, label: 'Developing' },
          { min: 30, max: Infinity, score: 1, label: 'Beginning' }
        ]
      },
      protocol_adherence: {
        name: 'Protocol Adherence',
        weight: 0.35,
        levels: [
          { min: 100, max: 100, score: 4, label: 'Exemplary' },
          { min: 85, max: 99, score: 3, label: 'Proficient' },
          { min: 70, max: 84, score: 2, label: 'Developing' },
          { min: 0, max: 69, score: 1, label: 'Beginning' }
        ]
      },
      resource_management: {
        name: 'Resource Management',
        weight: 0.25,
        levels: [
          { min: 90, max: 100, score: 4, label: 'Optimal' },
          { min: 75, max: 89, score: 3, label: 'Efficient' },
          { min: 60, max: 74, score: 2, label: 'Adequate' },
          { min: 0, max: 59, score: 1, label: 'Inefficient' }
        ]
      },
      communication: {
        name: 'Communication',
        weight: 0.15,
        levels: [
          { min: 90, max: 100, score: 4, label: 'Clear & Timely' },
          { min: 75, max: 89, score: 3, label: 'Mostly Clear' },
          { min: 60, max: 74, score: 2, label: 'Needs Work' },
          { min: 0, max: 59, score: 1, label: 'Unclear' }
        ]
      }
    };
    
    // ============================================
    // SDK Initialization
    // ============================================
    
    const dataHandler = {
      onDataChanged(data) {
        allRecords = data;
        updateStats();
        updateLeaderboard();
      }
    };
    
    async function initializeApp() {
      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => {
            config = { ...defaultConfig, ...newConfig };
            applyConfig();
          },
          mapToCapabilities: (cfg) => ({
            recolorables: [
              {
                get: () => cfg.background_color || defaultConfig.background_color,
                set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
              },
              {
                get: () => cfg.surface_color || defaultConfig.surface_color,
                set: (v) => { cfg.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); }
              },
              {
                get: () => cfg.text_color || defaultConfig.text_color,
                set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
              },
              {
                get: () => cfg.primary_action || defaultConfig.primary_action,
                set: (v) => { cfg.primary_action = v; window.elementSdk.setConfig({ primary_action: v }); }
              },
              {
                get: () => cfg.secondary_action || defaultConfig.secondary_action,
                set: (v) => { cfg.secondary_action = v; window.elementSdk.setConfig({ secondary_action: v }); }
              }
            ],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['app_title', cfg.app_title || defaultConfig.app_title],
            ['welcome_message', cfg.welcome_message || defaultConfig.welcome_message]
          ])
        });
      }
      
      // Initialize Data SDK
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize Data SDK');
        }
      }
      
      // Initialize UI
      renderRoles();
      renderScenarios();
      applyConfig();
    }
    
    function applyConfig() {
      const navTitle = document.getElementById('nav-title');
      const heroTitle = document.getElementById('hero-title');
      
      if (navTitle) navTitle.textContent = config.app_title || defaultConfig.app_title;
      if (heroTitle) heroTitle.textContent = config.welcome_message || defaultConfig.welcome_message;
    }
    
    // ============================================
    // UI Functions
    // ============================================
    
    function showScreen(screenId) {
      const screens = ['home', 'player-setup', 'simulation', 'results', 'leaderboard', 'learn'];
      screens.forEach(s => {
        const el = document.getElementById(`${s}-screen`);
        if (el) el.classList.toggle('hidden', s !== screenId);
      });
    }
    
    function showToast(message, type = 'info') {
      const container = document.getElementById('toast-container');
      const colors = {
        success: 'from-green-500 to-emerald-600',
        error: 'from-red-500 to-rose-600',
        info: 'from-blue-500 to-cyan-600',
        warning: 'from-yellow-500 to-orange-600'
      };
      
      const toast = document.createElement('div');
      toast.className = `toast glass-card p-4 bg-gradient-to-r ${colors[type]} text-white font-medium max-w-sm`;
      toast.textContent = message;
      container.appendChild(toast);
      
      setTimeout(() => toast.remove(), 4000);
    }
    
    function renderRoles() {
      const container = document.getElementById('role-selection');
      container.innerHTML = ICS_ROLES.map(role => `
        <div class="role-card glass-card p-4 cursor-pointer transition-all ${selectedRole === role.id ? 'ring-2 ring-white' : ''}"
             onclick="selectRole('${role.id}')">
          <div class="flex items-start gap-4">
            <div class="text-4xl">${role.icon}</div>
            <div class="flex-1">
              <h4 class="font-bold text-white">${role.title}</h4>
              <p class="text-sm text-blue-100 mt-1">${role.description}</p>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function renderScenarios() {
      const container = document.getElementById('scenario-selection');
      container.innerHTML = SCENARIOS.map(scenario => `
        <div class="glass-card p-4 cursor-pointer transition-all ${selectedScenario === scenario.id ? 'ring-2 ring-white' : ''}"
             onclick="selectScenario('${scenario.id}')">
          <div class="flex items-center justify-between">
            <div>
              <h4 class="font-bold text-white text-lg">${scenario.title}</h4>
              <p class="text-sm text-blue-100 mt-1">${scenario.description}</p>
            </div>
            <span class="px-3 py-1 rounded-full text-xs font-medium ${
              scenario.difficulty === 'Hard' ? 'bg-red-500/30 text-red-200' :
              scenario.difficulty === 'Medium' ? 'bg-yellow-500/30 text-yellow-200' :
              'bg-green-500/30 text-green-200'
            }">${scenario.difficulty}</span>
          </div>
        </div>
      `).join('');
    }
    
    function selectRole(roleId) {
      selectedRole = roleId;
      renderRoles();
      checkStartButton();
    }
    
    function selectScenario(scenarioId) {
      selectedScenario = scenarioId;
      renderScenarios();
      checkStartButton();
    }
    
    function checkStartButton() {
      const btn = document.getElementById('start-simulation-btn');
      const playerName = document.getElementById('player-name-input').value.trim();
      btn.disabled = !(selectedRole && selectedScenario && playerName);
    }
    
    document.getElementById('player-name-input').addEventListener('input', checkStartButton);
    
    // ============================================
    // Simulation Functions
    // ============================================
    
    function startSimulation() {
      currentPlayerName = document.getElementById('player-name-input').value.trim();
      currentDecisionIndex = 0;
      simulationScore = 0;
      correctDecisions = 0;
      totalDecisions = 0;
      simulationStartTime = Date.now();
      
      showScreen('simulation');
      renderSimulationMap();
      loadDecision();
      startSimulationTimer();
      showToast('Simulation started! Good luck, Commander!', 'success');
    }
    
    function renderSimulationMap() {
      const scenario = SCENARIOS.find(s => s.id === selectedScenario);
      const mapContainer = document.getElementById('simulation-map');
      
      mapContainer.innerHTML = `
        <svg viewBox="0 0 600 400" class="w-full h-full">
          <defs>
            <linearGradient id="mapGrad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:rgba(0,82,165,0.3)"/>
              <stop offset="100%" style="stop-color:rgba(0,82,165,0.1)"/>
            </linearGradient>
            <filter id="mapGlow">
              <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
              <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          
          <!-- Grid Lines -->
          ${Array.from({length: 10}, (_, i) => `
            <line x1="${i * 60}" y1="0" x2="${i * 60}" y2="400" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
            <line x1="0" y1="${i * 40}" x2="600" y2="${i * 40}" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
          `).join('')}
          
          <!-- Terrain/Region -->
          <path d="M50 200 Q150 100 250 150 T400 120 T550 180 L550 350 L50 350 Z" 
                fill="url(#mapGrad)" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
          
          <!-- Hazard Zones -->
          <ellipse cx="200" cy="220" rx="80" ry="60" fill="rgba(239,68,68,0.3)" stroke="rgba(239,68,68,0.6)" stroke-width="2">
            <animate attributeName="rx" values="80;90;80" dur="3s" repeatCount="indefinite"/>
          </ellipse>
          <ellipse cx="400" cy="180" rx="60" ry="45" fill="rgba(245,158,11,0.3)" stroke="rgba(245,158,11,0.6)" stroke-width="2">
            <animate attributeName="rx" values="60;70;60" dur="2.5s" repeatCount="indefinite"/>
          </ellipse>
          
          <!-- Command Post -->
          <g transform="translate(100, 300)">
            <circle r="15" fill="#22c55e" filter="url(#mapGlow)"/>
            <text x="25" y="5" fill="white" font-size="12" font-weight="bold">ICP</text>
          </g>
          
          <!-- Resource Points -->
          <g transform="translate(450, 280)">
            <circle r="10" fill="#3b82f6" filter="url(#mapGlow)"/>
            <text x="15" y="4" fill="white" font-size="10">Resources</text>
          </g>
          
          <!-- Incident Markers -->
          <g transform="translate(200, 220)">
            <circle r="12" fill="#ef4444" filter="url(#mapGlow)">
              <animate attributeName="opacity" values="1;0.5;1" dur="1s" repeatCount="indefinite"/>
            </circle>
            <text x="0" y="-20" fill="white" font-size="11" text-anchor="middle" font-weight="bold">${scenario.hazardType}</text>
          </g>
          
          <!-- Location Label -->
          <rect x="20" y="20" width="150" height="30" rx="8" fill="rgba(0,0,0,0.5)"/>
          <text x="30" y="40" fill="white" font-size="12" font-weight="bold">ğŸ“ ${scenario.location}</text>
          
          <!-- GeoRiskPH Attribution -->
          <rect x="420" y="360" width="170" height="30" rx="6" fill="rgba(0,0,0,0.4)"/>
          <text x="430" y="380" fill="rgba(255,255,255,0.8)" font-size="10">Data: GeoRiskPH HazardHunter</text>
        </svg>
      `;
      
      document.getElementById('incident-briefing').innerHTML = scenario.briefing;
    }
    
    function loadDecision() {
      const scenario = SCENARIOS.find(s => s.id === selectedScenario);
      const decision = scenario.decisions[currentDecisionIndex];
      
      if (!decision) {
        endSimulation();
        return;
      }
      
      document.getElementById('sim-phase').textContent = decision.phase;
      document.getElementById('current-objective').innerHTML = `
        <p class="font-bold text-white mb-2">${decision.objective}</p>
        <p class="text-lg">${decision.question}</p>
      `;
      
      const optionsContainer = document.getElementById('decision-options');
      optionsContainer.innerHTML = decision.options.map((opt, i) => `
        <button class="w-full text-left glass-card p-4 hover:bg-white/20 transition-all group"
                onclick="makeDecision(${i})">
          <div class="flex items-start gap-3">
            <span class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center font-bold text-white group-hover:bg-white/30">
              ${String.fromCharCode(65 + i)}
            </span>
            <span class="text-white flex-1">${opt.text}</span>
          </div>
        </button>
      `).join('');
      
      startDecisionTimer();
    }
    
    let decisionStartTime;
    
    function startDecisionTimer() {
      decisionStartTime = Date.now();
      let timeLeft = 30;
      
      clearInterval(decisionTimer);
      decisionTimer = setInterval(() => {
        timeLeft--;
        const timerEl = document.getElementById('decision-timer');
        timerEl.textContent = timeLeft;
        
        if (timeLeft <= 10) {
          timerEl.classList.add('timer-critical');
        } else {
          timerEl.classList.remove('timer-critical');
        }
        
        if (timeLeft <= 0) {
          clearInterval(decisionTimer);
          makeDecision(-1); // Timeout penalty
        }
      }, 1000);
    }
    
    function makeDecision(optionIndex) {
      clearInterval(decisionTimer);
      
      const scenario = SCENARIOS.find(s => s.id === selectedScenario);
      const decision = scenario.decisions[currentDecisionIndex];
      const decisionTime = (Date.now() - decisionStartTime) / 1000;
      
      totalDecisions++;
      
      let points = 0;
      let feedback = '';
      
      if (optionIndex >= 0 && decision.options[optionIndex]) {
        const option = decision.options[optionIndex];
        points = option.points;
        feedback = option.feedback;
        
        if (option.correct) {
          correctDecisions++;
          showToast('âœ“ Correct decision!', 'success');
        } else {
          showToast('âœ— Not optimal, but noted.', 'warning');
        }
        
        // Time bonus (faster = more points)
        const timeBonus = Math.max(0, Math.floor((30 - decisionTime) * 2));
        points += timeBonus;
      } else {
        feedback = 'Time expired! Quick decision-making is critical in emergencies.';
        showToast('â±ï¸ Time expired!', 'error');
      }
      
      simulationScore += points;
      
      // Update progress display
      const accuracy = totalDecisions > 0 ? Math.round((correctDecisions / totalDecisions) * 100) : 0;
      document.getElementById('accuracy-percent').textContent = `${accuracy}%`;
      document.getElementById('accuracy-bar').style.width = `${accuracy}%`;
      document.getElementById('current-score').textContent = simulationScore;
      
      // Show feedback briefly then proceed
      const optionsContainer = document.getElementById('decision-options');
      optionsContainer.innerHTML = `
        <div class="glass-card p-4 ${points >= 80 ? 'bg-green-500/20' : 'bg-yellow-500/20'}">
          <p class="text-white font-medium mb-2">${points >= 80 ? 'âœ“' : 'â–³'} ${feedback}</p>
          <p class="text-blue-200 text-sm">Points earned: ${points}</p>
        </div>
      `;
      
      setTimeout(() => {
        currentDecisionIndex++;
        loadDecision();
      }, 2500);
    }
    
    function startSimulationTimer() {
      clearInterval(simulationTimer);
      simulationTimer = setInterval(() => {
        const elapsed = Math.floor((Date.now() - simulationStartTime) / 1000);
        const mins = Math.floor(elapsed / 60).toString().padStart(2, '0');
        const secs = (elapsed % 60).toString().padStart(2, '0');
        document.getElementById('sim-timer').textContent = `â±ï¸ ${mins}:${secs}`;
        
        // Update efficiency based on time
        const maxTime = 300; // 5 minutes ideal
        const efficiency = Math.max(0, Math.round((1 - (elapsed / maxTime)) * 100));
        document.getElementById('efficiency-percent').textContent = `${Math.max(0, efficiency)}%`;
        document.getElementById('efficiency-bar').style.width = `${Math.max(0, efficiency)}%`;
      }, 1000);
    }
    
    async function endSimulation() {
      clearInterval(simulationTimer);
      clearInterval(decisionTimer);
      
      const timeTaken = Math.floor((Date.now() - simulationStartTime) / 1000);
      const accuracy = totalDecisions > 0 ? (correctDecisions / totalDecisions) * 100 : 0;
      
      // Calculate rubric scores
      const rubricScores = calculateRubricScores(timeTaken, accuracy);
      const finalScore = Math.round(simulationScore * (rubricScores.total / 4));
      
      // Determine grade
      const grade = getGrade(finalScore);
      
      // Save results
      if (window.dataSdk && allRecords.length < 999) {
        const result = await window.dataSdk.create({
          id: `session_${Date.now()}`,
          player_name: currentPlayerName,
          scenario_id: selectedScenario,
          role: selectedRole,
          score: finalScore,
          time_taken: timeTaken,
          decisions_made: totalDecisions,
          correct_decisions: correctDecisions,
          completed_at: new Date().toISOString()
        });
        
        if (!result.isOk) {
          showToast('Could not save results', 'error');
        }
      }
      
      // Display results
      showScreen('results');
      renderResults(finalScore, grade, rubricScores, timeTaken);
    }
    
    function calculateRubricScores(timeTaken, accuracy) {
      const avgDecisionTime = timeTaken / totalDecisions;
      
      const scores = {};
      let totalWeight = 0;
      let weightedSum = 0;
      
      // Decision Speed
      for (const level of SCORING_RUBRICS.decision_speed.levels) {
        if (avgDecisionTime >= level.min && avgDecisionTime < level.max) {
          scores.decision_speed = { score: level.score, label: level.label };
          break;
        }
      }
      
      // Protocol Adherence
      for (const level of SCORING_RUBRICS.protocol_adherence.levels) {
        if (accuracy >= level.min && accuracy <= level.max) {
          scores.protocol_adherence = { score: level.score, label: level.label };
          break;
        }
      }
      
      // Resource Management (based on score efficiency)
      const maxPossibleScore = totalDecisions * 130; // 100 base + 30 time bonus
      const efficiency = (simulationScore / maxPossibleScore) * 100;
      for (const level of SCORING_RUBRICS.resource_management.levels) {
        if (efficiency >= level.min && efficiency <= level.max) {
          scores.resource_management = { score: level.score, label: level.label };
          break;
        }
      }
      
      // Communication (based on timeliness)
      const timeEfficiency = Math.max(0, (1 - (timeTaken / 300)) * 100);
      for (const level of SCORING_RUBRICS.communication.levels) {
        if (timeEfficiency >= level.min && timeEfficiency <= level.max) {
          scores.communication = { score: level.score, label: level.label };
          break;
        }
      }
      
      // Calculate weighted total
      Object.keys(SCORING_RUBRICS).forEach(key => {
        if (scores[key]) {
          weightedSum += scores[key].score * SCORING_RUBRICS[key].weight;
          totalWeight += SCORING_RUBRICS[key].weight;
        }
      });
      
      scores.total = totalWeight > 0 ? weightedSum / totalWeight * 4 : 0;
      
      return scores;
    }
    
    function getGrade(score) {
      if (score >= 450) return { grade: 'A+', badge: 'ğŸ†', title: 'Exemplary Commander', color: 'from-yellow-400 to-amber-500' };
      if (score >= 400) return { grade: 'A', badge: 'ğŸ¥‡', title: 'Expert Commander', color: 'from-yellow-500 to-orange-500' };
      if (score >= 350) return { grade: 'B+', badge: 'ğŸ¥ˆ', title: 'Proficient Leader', color: 'from-gray-300 to-gray-400' };
      if (score >= 300) return { grade: 'B', badge: 'ğŸ¥‰', title: 'Competent Responder', color: 'from-amber-600 to-amber-700' };
      if (score >= 250) return { grade: 'C', badge: 'ğŸ“œ', title: 'Developing Skills', color: 'from-blue-400 to-blue-500' };
      return { grade: 'D', badge: 'ğŸ“š', title: 'More Training Needed', color: 'from-gray-500 to-gray-600' };
    }
    
    function renderResults(finalScore, grade, rubricScores, timeTaken) {
      const scenario = SCENARIOS.find(s => s.id === selectedScenario);
      const role = ICS_ROLES.find(r => r.id === selectedRole);
      
      document.getElementById('result-badge').className = `w-32 h-32 mx-auto mb-4 rounded-full flex items-center justify-center text-6xl bg-gradient-to-br ${grade.color}`;
      document.getElementById('result-badge').textContent = grade.badge;
      document.getElementById('result-title').textContent = grade.title;
      document.getElementById('result-subtitle').textContent = `${currentPlayerName} | ${role.title} | ${scenario.title}`;
      
      document.getElementById('score-breakdown').innerHTML = `
        <div class="flex justify-between items-center py-2 border-b border-white/20">
          <span class="text-blue-200">Base Score</span>
          <span class="text-white font-bold">${simulationScore}</span>
        </div>
        <div class="flex justify-between items-center py-2 border-b border-white/20">
          <span class="text-blue-200">Decisions Made</span>
          <span class="text-white font-bold">${totalDecisions}</span>
        </div>
        <div class="flex justify-between items-center py-2 border-b border-white/20">
          <span class="text-blue-200">Correct Decisions</span>
          <span class="text-white font-bold">${correctDecisions} / ${totalDecisions}</span>
        </div>
        <div class="flex justify-between items-center py-2">
          <span class="text-blue-200">Time Taken</span>
          <span class="text-white font-bold">${Math.floor(timeTaken / 60)}m ${timeTaken % 60}s</span>
        </div>
      `;
      
      document.getElementById('rubric-assessment').innerHTML = Object.keys(SCORING_RUBRICS).map(key => `
        <div class="flex justify-between items-center">
          <span class="text-blue-200">${SCORING_RUBRICS[key].name}</span>
          <span class="px-2 py-1 rounded text-xs font-medium ${
            rubricScores[key]?.score >= 3 ? 'bg-green-500/30 text-green-200' :
            rubricScores[key]?.score >= 2 ? 'bg-yellow-500/30 text-yellow-200' :
            'bg-red-500/30 text-red-200'
          }">${rubricScores[key]?.label || 'N/A'}</span>
        </div>
      `).join('');
      
      document.getElementById('final-score').textContent = finalScore;
      document.getElementById('final-grade').textContent = `Grade: ${grade.grade}`;
      
      // Animate score bar
      setTimeout(() => {
        const maxScore = 500;
        const percentage = Math.min(100, (finalScore / maxScore) * 100);
        document.getElementById('final-score-bar').style.width = `${percentage}%`;
      }, 100);
    }
    
    function restartSimulation() {
      startSimulation();
    }
    
    // ============================================
    // Statistics & Leaderboard
    // ============================================
    
    function updateStats() {
      const sessions = allRecords.length;
      const avgScore = sessions > 0 ? Math.round(allRecords.reduce((sum, r) => sum + (r.score || 0), 0) / sessions) : 0;
      const totalDecisionsMade = allRecords.reduce((sum, r) => sum + (r.decisions_made || 0), 0);
      
      // Find best role
      const roleScores = {};
      allRecords.forEach(r => {
        if (!roleScores[r.role]) roleScores[r.role] = [];
        roleScores[r.role].push(r.score || 0);
      });
      
      let bestRole = '--';
      let bestRoleAvg = 0;
      Object.keys(roleScores).forEach(role => {
        const avg = roleScores[role].reduce((a, b) => a + b, 0) / roleScores[role].length;
        if (avg > bestRoleAvg) {
          bestRoleAvg = avg;
          const roleObj = ICS_ROLES.find(r => r.id === role);
          bestRole = roleObj ? roleObj.icon : role;
        }
      });
      
      document.getElementById('stat-sessions').textContent = sessions;
      document.getElementById('stat-avg-score').textContent = `${avgScore}`;
      document.getElementById('stat-best-role').textContent = bestRole;
      document.getElementById('stat-total-decisions').textContent = totalDecisionsMade;
    }
    
    function updateLeaderboard() {
      const container = document.getElementById('leaderboard-content');
      const emptyState = document.getElementById('empty-leaderboard');
      
      if (allRecords.length === 0) {
        container.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
      }
      
      container.classList.remove('hidden');
      emptyState.classList.add('hidden');
      
      const sorted = [...allRecords].sort((a, b) => (b.score || 0) - (a.score || 0)).slice(0, 10);
      
      container.innerHTML = sorted.map((record, i) => {
        const role = ICS_ROLES.find(r => r.id === record.role);
        const scenario = SCENARIOS.find(s => s.id === record.scenario_id);
        const medal = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : `${i + 1}`;
        
        return `
          <div class="glass-card p-4 flex items-center gap-4">
            <div class="text-2xl font-bold w-12 text-center ${i < 3 ? '' : 'text-white/60'}">${medal}</div>
            <div class="flex-1">
              <div class="font-bold text-white">${record.player_name || 'Anonymous'}</div>
              <div class="text-sm text-blue-200">${role?.icon || ''} ${role?.title || record.role} â€¢ ${scenario?.title || record.scenario_id}</div>
            </div>
            <div class="text-right">
              <div class="text-2xl font-bold text-white">${record.score || 0}</div>
              <div class="text-xs text-blue-200">${record.correct_decisions || 0}/${record.decisions_made || 0} correct</div>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function toggleReference() {
      const ref = document.getElementById('ics-reference');
      const arrow = document.getElementById('ref-arrow');
      ref.classList.toggle('hidden');
      arrow.classList.toggle('rotate-180');
    }
    
    // Initialize on load
    initializeApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d28904463616e8c',t:'MTc3MTg2OTAwNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
