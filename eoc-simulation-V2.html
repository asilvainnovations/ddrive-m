<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EOC Simulation Training | Emergency Operations Center</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Chakra+Petch:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ========================================
    üé® BRAND DESIGN TOKENS & ELECTRIC FUTURE
    ======================================== */
    :root {
      /* Primary Brand Colors */
      --brand-primary: #0A2463;
      --brand-secondary: #0D3B66;
      --brand-accent: #00B4D8;
      --brand-light: #F8F9FA;
      --brand-dark: #1A1A1A;
      
      /* Electric Future Color Palette */
      --electric-cyan: #06b6d4;
      --electric-purple: #8b5cf6;
      --electric-pink: #ec4899;
      --electric-green: #10b981;
      
      /* Deep Navy Backgrounds */
      --deep-navy-1: #0b1121;
      --deep-navy-2: #162032;
      --deep-navy-3: #1e2a3a;
      
      /* Category Colors */
      --category-systems: #2E5EFF;
      --category-risk: #FF9F1C;
      --category-resilience: #2D6A4F;
      --category-ai: #FF6B6B;
      --category-leadership: #4ECDC4;
      
      /* Game specific colors */
      --game-bg: var(--deep-navy-1);
      --game-surface: var(--deep-navy-2);
      --game-border: #334155;
      --game-text: #e2e8f0;
      --game-accent: var(--electric-cyan);
    }
    
    body {
      font-family: 'Inter', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background-color: var(--game-bg);
      color: var(--game-text);
    }
    
    .game-title {
      font-family: 'Chakra Petch', sans-serif;
    }
    
    /* ========================================
    üé¨ ANIMATIONS - ENHANCED
    ======================================== */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes pulse-alert {
      0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
      50% { opacity: 0.7; box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    @keyframes rain {
      0% { transform: translateY(-100%) rotate(15deg); opacity: 0; }
      10% { opacity: 1; }
      100% { transform: translateY(200%) rotate(15deg); opacity: 0; }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    @keyframes ripple {
      0% { transform: scale(0); opacity: 1; }
      100% { transform: scale(4); opacity: 0; }
    }
    @keyframes glow {
      0%, 100% { box-shadow: 0 0 20px rgba(6, 182, 212, 0.3); }
      50% { box-shadow: 0 0 40px rgba(6, 182, 212, 0.6); }
    }
    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* Animation Classes */
    .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
    .animate-scaleIn { animation: scaleIn 0.4s ease-out forwards; }
    .animate-slideUp { animation: slideUp 0.5s ease-out forwards; }
    .alert-pulse { animation: pulse-alert 2s ease-in-out infinite; }
    .float-animation { animation: float 3s ease-in-out infinite; }
    .rain-drop { animation: rain 1s linear infinite; }
    .shake-effect { animation: shake 0.3s ease-in-out infinite; }
    .notification-slide { animation: slideIn 0.3s ease-out; }
    .shimmer { 
      background: linear-gradient(90deg, var(--game-surface) 25%, rgba(255,255,255,0.1) 50%, var(--game-surface) 75%);
      background-size: 200% 100%;
      animation: shimmer 2s infinite;
    }
    .glow-effect { animation: glow 3s ease-in-out infinite; }
    .animate-gradient-shift { 
      animation: gradient-shift 8s ease infinite;
      background-size: 200% 200%;
    }
    
    /* ========================================
    üó∫Ô∏è MAP STYLES - ENHANCED GLASSMORPHISM
    ======================================== */
    .map-container {
      display: grid;
      grid-template-columns: 1fr 240px;
      gap: 20px;
      align-items: start;
    }
    
    .map-grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      grid-template-rows: repeat(8, 1fr);
      gap: 3px;
      background: linear-gradient(135deg, var(--game-surface) 0%, var(--game-bg) 100%);
      padding: 16px;
      border-radius: 16px;
      border: 2px solid var(--game-border);
      min-height: 500px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
    }
    
    .map-grid::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 30% 30%, rgba(6, 182, 212, 0.08) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }
    
    .cell {
      aspect-ratio: 1;
      border-radius: 8px;
      transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);
      z-index: 1;
      border: 1.5px solid rgba(255, 255, 255, 0.1);
    }
    
    .cell::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.12) 0%, transparent 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
    }
    
    .cell:hover::before {
      opacity: 1;
    }
    
    .cell:hover {
      transform: scale(1.18) translateY(-2px);
      z-index: 20;
      box-shadow: 0 12px 30px rgba(6, 182, 212, 0.55);
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    .cell-water {
      background: linear-gradient(135deg, #0369a1 0%, #0284c7 100%);
      border: 1.5px solid #0ea5e9;
    }
    
    .cell-land {
      background: linear-gradient(135deg, #15803d 0%, #22c55e 100%);
      border: 1.5px solid #86efac;
    }
    
    .cell-urban {
      background: linear-gradient(135deg, #475569 0%, #64748b 100%);
      border: 1.5px solid #cbd5e1;
    }
    
    .cell-flooded {
      background: linear-gradient(135deg, #6d28d9 0%, #7c3aed 100%);
      border: 2.5px solid #a78bfa;
      animation: pulse-alert 2s ease-in-out infinite, shake 3s ease-in-out infinite;
    }
    
    .cell-affected {
      background: linear-gradient(135deg, #b91c1c 0%, #dc2626 100%);
      border: 2.5px solid #fca5a5;
      animation: shake 0.5s ease-in-out infinite;
    }
    
    .cell-evacuated {
      background: linear-gradient(135deg, #b45309 0%, #d97706 100%);
      border: 2.5px solid #fed7aa;
    }
    
    .cell-safe {
      background: linear-gradient(135deg, #047857 0%, #10b981 100%);
      border: 2.5px solid #6ee7b7;
      animation: glow 4s ease-in-out infinite;
    }
    
    .map-legend {
      background: linear-gradient(135deg, var(--game-surface) 0%, var(--game-bg) 100%);
      border: 2px solid var(--game-border);
      border-radius: 16px;
      padding: 20px;
      max-height: 520px;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
      position: relative;
    }
    
    .map-legend::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(6, 182, 212, 0.05) 0%, transparent 100%);
      border-radius: 16px;
      pointer-events: none;
      z-index: 0;
    }
    
    .legend-title {
      font-weight: 700;
      color: var(--game-accent);
      margin-bottom: 16px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      position: relative;
      z-index: 1;
    }
    
    .legend-section {
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--game-border);
      position: relative;
      z-index: 1;
    }
    
    .legend-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
      font-size: 14px;
      padding: 10px;
      border-radius: 8px;
      transition: all 0.25s ease;
      cursor: help;
      position: relative;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .legend-item:hover {
      background: rgba(6, 182, 212, 0.12);
      transform: translateX(5px);
      border-color: rgba(6, 182, 212, 0.3);
    }
    
    .legend-color-box {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 1.5px solid rgba(255, 255, 255, 0.35);
      flex-shrink: 0;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
    }
    
    .legend-text {
      color: var(--game-text);
      font-size: 14px;
      flex: 1;
      font-weight: 500;
    }
    
    .legend-icon {
      font-size: 26px;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.08);
    }
    
    .cell-label {
      position: absolute;
      bottom: 4px;
      right: 4px;
      background: rgba(0, 0, 0, 0.85);
      color: white;
      font-size: 10px;
      padding: 3px 6px;
      border-radius: 4px;
      opacity: 0;
      transition: opacity 0.25s ease;
      font-weight: 600;
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
    
    .cell:hover .cell-label {
      opacity: 1;
    }
    
    /* ========================================
    üéØ ENHANCED TOOLTIPS - GLASSMORPHISM
    ======================================== */
    .tooltip {
      visibility: hidden;
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
      z-index: 1000;
      position: absolute;
    }
    
    .has-tooltip:hover .tooltip {
      visibility: visible;
      opacity: 1;
      transform: translateY(-4px);
    }
    
    .tooltip-content {
      background: linear-gradient(135deg, var(--game-surface) 0%, var(--game-bg) 100%);
      border: 2px solid var(--electric-cyan);
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 14px;
      color: var(--game-text);
      white-space: nowrap;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.55), 0 0 25px rgba(6, 182, 212, 0.3);
      position: relative;
      font-weight: 500;
      backdrop-filter: blur(12px);
      max-width: 300px;
      text-align: center;
    }
    
    .tooltip-content::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), transparent);
      border-radius: 10px;
      pointer-events: none;
    }
    
    .tooltip-arrow {
      position: absolute;
      width: 0;
      height: 0;
      border-left: 7px solid transparent;
      border-right: 7px solid transparent;
      border-top: 7px solid var(--electric-cyan);
      bottom: -7px;
      left: 50%;
      transform: translateX(-50%);
    }
    
    .tooltip-arrow-inner {
      position: absolute;
      width: 0;
      height: 0;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-top: 6px solid var(--game-surface);
      left: -6px;
      top: -6px;
    }
    
    /* ========================================
    üéÆ UI COMPONENTS - GLASSMORPHISM ENHANCEMENTS
    ======================================== */
    .resource-card, .decision-btn, .role-card, .scenario-card, .stat-card, .leaderboard-entry, .btn-primary {
      position: relative;
      overflow: hidden;
      transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 12px;
      backdrop-filter: blur(12px);
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.12);
    }
    
    .resource-card::before, .decision-btn::before, .role-card::before, .scenario-card::before, 
    .stat-card::before, .leaderboard-entry::before, .btn-primary::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 12px;
      z-index: 0;
    }
    
    .resource-card:hover:not(:disabled)::before, 
    .decision-btn:hover::before,
    .role-card:hover::before, 
    .scenario-card:hover::before,
    .stat-card:hover::before,
    .leaderboard-entry:hover::before,
    .btn-primary:hover::before {
      opacity: 1;
    }
    
    .resource-card:hover:not(:disabled),
    .decision-btn:hover,
    .role-card:hover,
    .scenario-card:hover,
    .stat-card:hover,
    .leaderboard-entry:hover,
    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35), 0 0 20px rgba(6, 182, 212, 0.25);
      border-color: rgba(6, 182, 212, 0.4);
      z-index: 10;
    }
    
    .resource-card:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .progress-bar {
      transition: width 0.7s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 9999px;
      height: 6px;
    }
    
    .modal-overlay {
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(12px);
    }
    
    /* ========================================
    üì± SCROLLBAR STYLING
    ======================================== */
    .scrollbar-thin::-webkit-scrollbar {
      width: 10px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-track {
      background: var(--game-bg);
      border-radius: 6px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: var(--game-border);
      border-radius: 6px;
      border: 2px solid var(--game-bg);
      transition: background 0.3s ease;
    }
    
    .scrollbar-thin::-webkit-scrollbar-thumb:hover {
      background: var(--electric-cyan);
    }
    
    /* ========================================
    üé® BRAND ELEMENTS
    ======================================== */
    .text-gradient {
      background: linear-gradient(135deg, var(--electric-cyan) 0%, var(--electric-purple) 50%, var(--electric-pink) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
    }
    
    .bg-brand-gradient {
      background: linear-gradient(135deg, var(--brand-primary) 0%, var(--brand-secondary) 50%, var(--brand-accent) 100%);
    }
    
    .glass-panel {
      background: rgba(22, 32, 50, 0.78);
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      border-radius: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
    }
    
    .glass-panel::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(
        125deg,
        rgba(6, 182, 212, 0.08) 0%,
        rgba(139, 92, 246, 0.08) 35%,
        rgba(236, 72, 153, 0.08) 100%
      );
      pointer-events: none;
    }
    
    /* ========================================
    üì¢ NOTIFICATION STYLES
    ======================================== */
    .notification {
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.45), 0 0 25px rgba(6, 182, 212, 0.3);
      border-left: 4px solid;
      backdrop-filter: blur(12px);
      background: rgba(22, 32, 50, 0.85);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
    
    .notification.success { border-left-color: var(--electric-green); }
    .notification.error { border-left-color: var(--electric-pink); }
    .notification.warning { border-left-color: #f59e0b; }
    .notification.info { border-left-color: var(--electric-cyan); }
    
    /* ========================================
    üåê RESPONSIVE DESIGN
    ======================================== */
    @media (max-width: 1024px) {
      .map-container {
        grid-template-columns: 1fr;
      }
      .map-legend {
        max-height: 350px;
        margin-top: 16px;
      }
    }
    
    @media (max-width: 768px) {
      .cell {
        font-size: 24px;
      }
      .map-grid {
        min-height: 400px;
        padding: 12px;
        gap: 2px;
      }
      .legend-item {
        font-size: 13px;
        padding: 8px;
      }
      .legend-color-box, .legend-icon {
        width: 28px;
        height: 28px;
      }
    }
    
    /* ========================================
    üé≠ FOCUS STYLES
    ======================================== */
    button:focus-visible,
    a:focus-visible,
    input:focus-visible,
    textarea:focus-visible {
      outline: 3px solid var(--electric-cyan);
      outline-offset: 2px;
      border-radius: 8px;
      box-shadow: 0 0 0 4px rgba(6, 182, 212, 0.25);
    }
    
    /* ========================================
    ‚ú® BUTTON SHIMMER EFFECT
    ======================================== */
    .shimmer-effect {
      position: relative;
      overflow: hidden;
    }
    
    .shimmer-effect::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        45deg,
        transparent,
        rgba(255, 255, 255, 0.2),
        transparent
      );
      transform: rotate(30deg);
      animation: shimmer 2.5s infinite;
    }
    
    /* ========================================
    üí´ RIPPLE EFFECT FOR BUTTONS
    ======================================== */
    .ripple {
      position: relative;
      overflow: hidden;
      transform: translate3d(0, 0, 0);
    }
    
    .ripple::after {
      content: "";
      display: block;
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
      background-repeat: no-repeat;
      background-position: 50%;
      transform: scale(10, 10);
      opacity: 0;
      transition: transform .5s, opacity 1s;
    }
    
    .ripple:active::after {
      transform: scale(0, 0);
      opacity: .3;
      transition: 0s;
    }
    /* ========================================
   üî¥ CRITICAL ACCESSIBILITY FIXES - ADD THESE LINES
   ======================================== */
.notification {
  background-color: #ffffff !important;
  color: #1e293b !important;
  border-left-width: 4px !important;
  border-left-style: solid !important;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06) !important;
  padding: 12px 16px !important;
  border-radius: 8px !important;
  margin-bottom: 8px !important;
}
.notification.error { 
  border-left-color: #dc2626 !important; 
  background-color: #fff1f2 !important;
  color: #b91c1c !important;
}
.notification.success { 
  border-left-color: #10b981 !important; 
  background-color: #f0fdf4 !important;
}
.notification.warning { 
  border-left-color: #f59e0b !important; 
  background-color: #fffbeb !important;
  color: #b45309 !important;
}
.notification.info { 
  border-left-color: #06b6d4 !important; 
  background-color: #ecfeff !important;
}
    #selected-cell-info {
  background-color: #ffffff !important;
  color: #1e293b !important;
  border-left: 4px solid #06b6d4 !important;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06) !important;
  padding: 1.5rem !important;
  border-radius: 12px !important;
  margin-top: 1.5rem !important;
}
#selected-cell-info h4 {
  color: #0a2463 !important;
  font-weight: 700 !important;
}
#selected-cell-info p {
  color: #64748b !important;
}
    .cell {
  color: #1e293b !important;
  border: 1px solid #e2e8f0 !important;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
}
.cell-flooded { 
  background: linear-gradient(135deg, #f0abfc 0%, #e879f9 100%) !important; 
  border: 2px solid #c084fc !important;
  color: #7e22ce !important;
}
.cell-affected { 
  background: linear-gradient(135deg, #fecaca 0%, #fecaca 100%) !important; 
  border: 2px solid #fca5a5 !important;
  color: #b91c1c !important;
}
.cell-evacuated { 
  background: linear-gradient(135deg, #ffedd5 0%, #ffedd5 100%) !important; 
  border: 2px solid #fed7aa !important;
  color: #b45309 !important;
}
.cell-safe { 
  background: linear-gradient(135deg, #bbf7d0 0%, #bbf7d0 100%) !important; 
  border: 2px solid #86efac !important;
  color: #166534 !important;
}
.cell-water { 
  background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%) !important; 
  border-color: #93c5fd !important;
  color: #1e40af !important;
}
.cell-land { 
  background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%) !important; 
  border-color: #86efac !important;
  color: #166534 !important;
}
.cell-urban { 
  background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%) !important; 
  border-color: #cbd5e1 !important;
  color: #334155 !important;
}
.cell-label {
  background: rgba(255, 255, 255, 0.95) !important;
  color: #1e293b !important;
  border: 1px solid #e2e8f0 !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
}

    input, textarea, select {
  background-color: #ffffff !important;
  color: #1e293b !important;
  border: 1px solid #e2e8f0 !important;
}
input::placeholder, textarea::placeholder {
  color: #64748b !important;
  opacity: 1 !important;
}
  </style>
</head>
<body class="h-full bg-white text-gray-900 font-sans overflow-auto">
  <div id="app" class="h-full w-full">
    <!-- Title Screen - GLASSMORPHISM ENHANCED -->
    <div id="title-screen" class="h-full w-full flex flex-col items-center justify-center p-6 bg-gradient-to-br from-[var(--deep-navy-1)] via-[var(--deep-navy-2)] to-[var(--deep-navy-1)]">
      <div class="text-center max-w-3xl animate-fadeIn">
        <div class="mb-10 relative">
          <svg class="w-36 h-36 mx-auto text-[var(--electric-cyan)] float-animation glow-effect" viewBox="0 0 100 100" fill="none">
            <circle cx="50" cy="50" r="45" stroke="currentColor" stroke-width="3" stroke-dasharray="280" stroke-dashoffset="0">
              <animate attributeName="stroke-dashoffset" values="280;0" dur="8s" repeatCount="indefinite"/>
            </circle>
            <path d="M50 20 L50 55 L70 70" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-dasharray="60" stroke-dashoffset="60">
              <animate attributeName="stroke-dashoffset" values="60;0" dur="2s" fill="freeze"/>
            </path>
            <circle cx="50" cy="50" r="6" fill="currentColor"/>
            <path d="M25 50 L15 50 M75 50 L85 50 M50 25 L50 15 M50 75 L50 85" stroke="currentColor" stroke-width="2" stroke-dasharray="10" stroke-dashoffset="10">
              <animate attributeName="stroke-dashoffset" values="10;0" dur="1.5s" fill="freeze" begin="0.5s"/>
            </path>
          </svg>
          <div class="absolute inset-0 bg-[var(--electric-cyan)] rounded-full blur-3xl opacity-20 animate-pulse"></div>
        </div>
        <h1 id="main-title" class="game-title text-6xl md:text-7xl font-bold text-gradient mb-4 animate-scaleIn tracking-tight">
          EOC SIMULATION
        </h1>
        <h2 id="sub-title" class="text-2xl md:text-3xl text-slate-300 mb-6 animate-slideUp">
          Emergency Operations Center Training Platform
        </h2>
        <p id="lgu-display" class="text-xl text-[var(--electric-cyan)] mb-10 font-semibold animate-slideUp flex items-center justify-center gap-3">
          <span class="w-3 h-3 rounded-full bg-[var(--electric-green)] animate-pulse-slow"></span>
          MDDRO: Municipality of XYZ, Province of ABC
        </p>
        <p id="welcome-text" class="text-slate-400 mb-12 leading-relaxed text-lg max-w-3xl mx-auto animate-slideUp">
          Train your emergency response skills through realistic disaster scenarios. Make critical decisions, manage resources, and coordinate rescue operations with our immersive simulation platform.
        </p>
        <div class="space-y-5 mb-12 animate-slideUp">
          <input type="text" id="player-name" placeholder="Enter your name"
            class="w-full max-w-md px-6 py-4 bg-[var(--deep-navy-2)] border-2 border-[var(--game-border)] rounded-2xl text-center focus:border-[var(--electric-cyan)] focus:outline-none transition-all focus:ring-4 focus:ring-[var(--electric-cyan)]/25 text-lg placeholder:text-slate-500">
        </div>
        <button id="start-btn" onclick="startGame()"
          class="btn-primary shimmer-effect px-10 py-5 bg-gradient-to-r from-[var(--electric-cyan)] to-[var(--electric-purple)] hover:from-[var(--electric-cyan)] hover:to-[var(--electric-pink)] text-white font-bold text-xl rounded-2xl transition-all shadow-2xl hover:shadow-[var(--electric-cyan)]/40 relative group has-tooltip ripple">
          üö® START SIMULATION
          <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-5 group-hover:visible group-hover:opacity-100">
            <div class="tooltip-content flex flex-col items-center gap-2">
              <div class="font-bold">Begin Emergency Response Training</div>
              <div class="text-xs mt-1">Complete realistic disaster scenarios to build critical decision-making skills</div>
              <div class="tooltip-arrow">
                <div class="tooltip-arrow-inner"></div>
              </div>
            </div>
          </div>
        </button>
        <div class="mt-12 flex flex-wrap justify-center gap-10 text-sm text-slate-400 animate-fadeIn">
          <div class="flex flex-col items-center gap-3 group transition-all hover:text-[var(--electric-cyan)]">
            <div class="text-3xl mb-1">üéØ</div>
            <div class="font-medium">Decision Making</div>
            <div class="w-1 h-1 rounded-full bg-[var(--electric-cyan)] group-hover:scale-4 transition-transform"></div>
          </div>
          <div class="flex flex-col items-center gap-3 group transition-all hover:text-[var(--electric-purple)]">
            <div class="text-3xl mb-1">üì¶</div>
            <div class="font-medium">Resource Management</div>
            <div class="w-1 h-1 rounded-full bg-[var(--electric-purple)] group-hover:scale-4 transition-transform"></div>
          </div>
          <div class="flex flex-col items-center gap-3 group transition-all hover:text-[var(--electric-pink)]">
            <div class="text-3xl mb-1">üë•</div>
            <div class="font-medium">Coordination</div>
            <div class="w-1 h-1 rounded-full bg-[var(--electric-pink)] group-hover:scale-4 transition-transform"></div>
          </div>
          <div class="flex flex-col items-center gap-3 group transition-all hover:text-[var(--electric-green)]">
            <div class="text-3xl mb-1">üìä</div>
            <div class="font-medium">Performance Analytics</div>
            <div class="w-1 h-1 rounded-full bg-[var(--electric-green)] group-hover:scale-4 transition-transform"></div>
          </div>
        </div>
        <button onclick="showLeaderboard()"
          class="mt-10 text-[var(--electric-cyan)] hover:text-[var(--electric-purple)] underline text-sm relative group has-tooltip transition-all flex items-center gap-2 mx-auto">
          <span>View Training Records</span>
          <span class="text-lg">üìä</span>
          <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-4 group-hover:visible group-hover:opacity-100">
            <div class="tooltip-content flex items-center gap-2">
              View your saved simulation results and rankings
              <div class="tooltip-arrow">
                <div class="tooltip-arrow-inner"></div>
              </div>
            </div>
          </div>
        </button>
      </div>
    </div>

    <!-- Role Selection Screen - GLASSMORPHISM ENHANCED -->
    <div id="role-screen" class="hidden h-full w-full flex flex-col items-center justify-center p-6 bg-gradient-to-br from-[var(--deep-navy-1)] via-[var(--deep-navy-2)] to-[var(--deep-navy-1)] overflow-auto">
      <div class="max-w-5xl w-full animate-fadeIn">
        <h2 class="game-title text-5xl font-bold text-gradient mb-4 text-center animate-scaleIn">SELECT YOUR ROLE</h2>
        <p class="text-slate-400 mb-10 text-xl text-center animate-fadeIn max-w-3xl mx-auto">
          Choose your position in the Emergency Operations Center to begin your training
        </p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl w-full mx-auto animate-slideUp">
          <!-- Role cards with enhanced glassmorphism -->
          <button onclick="selectRole('incident_commander')"
            class="role-card p-8 bg-[var(--deep-navy-2)]/90 border-2 border-[var(--game-border)] rounded-2xl hover:border-[var(--electric-pink)] transition-all text-left group has-tooltip relative backdrop-blur-sm">
            <div class="flex items-center gap-6 mb-5">
              <span class="text-6xl">üéñÔ∏è</span>
              <div>
                <h3 class="font-bold text-2xl text-[var(--electric-pink)] group-hover:text-[var(--electric-pink)]/90 transition-colors">Incident Commander</h3>
                <p class="text-sm text-slate-400 mt-1">Overall strategic leadership</p>
              </div>
            </div>
            <p class="text-sm text-slate-400 leading-relaxed">
              Make final decisions on resource deployment, evacuation orders, and inter-agency coordination. Highest responsibility with full strategic oversight.
            </p>
            <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-5 group-hover:visible group-hover:opacity-100">
              <div class="tooltip-content">
                Highest responsibility - All decisions impact overall strategy and resource allocation
                <div class="tooltip-arrow">
                  <div class="tooltip-arrow-inner"></div>
                </div>
              </div>
            </div>
          </button>
          
          <button onclick="selectRole('operations')"
            class="role-card p-8 bg-[var(--deep-navy-2)]/90 border-2 border-[var(--game-border)] rounded-2xl hover:border-[var(--electric-cyan)] transition-all text-left group has-tooltip relative backdrop-blur-sm">
            <div class="flex items-center gap-6 mb-5">
              <span class="text-6xl">üîß</span>
              <div>
                <h3 class="font-bold text-2xl text-[var(--electric-cyan)] group-hover:text-[var(--electric-cyan)]/90 transition-colors">Operations Chief</h3>
                <p class="text-sm text-slate-400 mt-1">Field operations management</p>
              </div>
            </div>
            <p class="text-sm text-slate-400 leading-relaxed">
              Direct search and rescue teams, manage evacuation routes, and coordinate ground response operations across multiple hazard zones.
            </p>
            <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-5 group-hover:visible group-hover:opacity-100">
              <div class="tooltip-content">
                Focus on execution - Manage field operations and rescue teams with tactical precision
                <div class="tooltip-arrow">
                  <div class="tooltip-arrow-inner"></div>
                </div>
              </div>
            </div>
          </button>
          
          <button onclick="selectRole('logistics')"
            class="role-card p-8 bg-[var(--deep-navy-2)]/90 border-2 border-[var(--game-border)] rounded-2xl hover:border-[var(--electric-green)] transition-all text-left group has-tooltip relative backdrop-blur-sm">
            <div class="flex items-center gap-6 mb-5">
              <span class="text-6xl">üì¶</span>
              <div>
                <h3 class="font-bold text-2xl text-[var(--electric-green)] group-hover:text-[var(--electric-green)]/90 transition-colors">Logistics Chief</h3>
                <p class="text-sm text-slate-400 mt-1">Resource management</p>
              </div>
            </div>
            <p class="text-sm text-slate-400 leading-relaxed">
              Manage supplies, equipment, and personnel allocation across evacuation centers and response teams. Optimize resource distribution during crisis.
            </p>
            <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-5 group-hover:visible group-hover:opacity-100">
              <div class="tooltip-content">
                Critical role - Optimize resource allocation and distribution for maximum impact
                <div class="tooltip-arrow">
                  <div class="tooltip-arrow-inner"></div>
                </div>
              </div>
            </div>
          </button>
          
          <button onclick="selectRole('information')"
            class="role-card p-8 bg-[var(--deep-navy-2)]/90 border-2 border-[var(--game-border)] rounded-2xl hover:border-[var(--electric-purple)] transition-all text-left group has-tooltip relative backdrop-blur-sm">
            <div class="flex items-center gap-6 mb-5">
              <span class="text-6xl">üì¢</span>
              <div>
                <h3 class="font-bold text-2xl text-[var(--electric-purple)] group-hover:text-[var(--electric-purple)]/90 transition-colors">Public Information</h3>
                <p class="text-sm text-slate-400 mt-1">Communications & alerts</p>
              </div>
            </div>
            <p class="text-sm text-slate-400 leading-relaxed">
              Issue public warnings, coordinate with media, and ensure accurate information dissemination. Control narrative and maintain public trust.
            </p>
            <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-5 group-hover:visible group-hover:opacity-100">
              <div class="tooltip-content">
                Essential for coordination - Control public messaging and alerts to prevent panic
                <div class="tooltip-arrow">
                  <div class="tooltip-arrow-inner"></div>
                </div>
              </div>
            </div>
          </button>
        </div>
      </div>
    </div>

    <!-- Scenario Selection Screen - GLASSMORPHISM ENHANCED -->
    <div id="scenario-screen" class="hidden h-full w-full flex flex-col items-center justify-center p-6 bg-gradient-to-br from-[var(--deep-navy-1)] via-[var(--deep-navy-2)] to-[var(--deep-navy-1)] overflow-auto">
      <div class="max-w-6xl w-full animate-fadeIn">
        <h2 class="game-title text-5xl font-bold text-gradient mb-4 text-center animate-scaleIn">SELECT SCENARIO</h2>
        <p class="text-slate-400 mb-10 text-xl text-center animate-fadeIn max-w-3xl mx-auto">
          Choose the disaster scenario for this simulation training session
        </p>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl w-full mx-auto animate-slideUp">
          <!-- Scenario cards with enhanced glassmorphism -->
          <button onclick="selectScenario('typhoon')"
            class="scenario-card p-9 bg-[var(--deep-navy-2)]/90 border-2 border-[var(--game-border)] rounded-2xl hover:border-[var(--electric-cyan)] transition-all text-center group has-tooltip relative backdrop-blur-sm overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-br from-[var(--electric-cyan)]/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
            <span class="text-7xl mb-6 block">üåÄ</span>
            <h3 class="font-bold text-2xl text-[var(--electric-cyan)] group-hover:text-[var(--electric-cyan)]/90 mb-4 transition-colors">Super Typhoon</h3>
            <p class="text-sm text-slate-400 mb-5">Signal No. 4 ‚Ä¢ Heavy flooding ‚Ä¢ Strong winds</p>
            <div class="flex justify-center gap-3 flex-wrap">
              <span class="px-4 py-1.5 bg-[var(--electric-cyan)]/20 text-[var(--electric-cyan)] rounded-full text-xs font-semibold border border-[var(--electric-cyan)]/30">üí® Wind Damage</span>
              <span class="px-4 py-1.5 bg-blue-900/30 text-blue-300 rounded-full text-xs font-semibold border border-blue-500/30">üåä Flooding</span>
            </div>
            <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-5 group-hover:visible group-hover:opacity-100">
              <div class="tooltip-content">
                Multi-hazard scenario - Manage wind damage and flooding with complex resource allocation challenges
                <div class="tooltip-arrow">
                  <div class="tooltip-arrow-inner"></div>
                </div>
              </div>
            </div>
          </button>
          
          <button onclick="selectScenario('earthquake')"
            class="scenario-card p-9 bg-[var(--deep-navy-2)]/90 border-2 border-[var(--game-border)] rounded-2xl hover:border-[var(--electric-pink)] transition-all text-center group has-tooltip relative backdrop-blur-sm overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-br from-[var(--electric-pink)]/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
            <span class="text-7xl mb-6 block">üèöÔ∏è</span>
            <h3 class="font-bold text-2xl text-[var(--electric-pink)] group-hover:text-[var(--electric-pink)]/90 mb-4 transition-colors">Major Earthquake</h3>
            <p class="text-sm text-slate-400 mb-5">Magnitude 7.2 ‚Ä¢ Structural collapse ‚Ä¢ Aftershocks</p>
            <div class="flex justify-center gap-3 flex-wrap">
              <span class="px-4 py-1.5 bg-orange-900/30 text-orange-300 rounded-full text-xs font-semibold border border-orange-500/30">üèóÔ∏è Collapse</span>
              <span class="px-4 py-1.5 bg-red-900/30 text-red-300 rounded-full text-xs font-semibold border border-red-500/30">üî• Fire Risk</span>
            </div>
            <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-5 group-hover:visible group-hover:opacity-100">
              <div class="tooltip-content">
                Severe scenario - Handle massive casualties and displacement with limited initial resources
                <div class="tooltip-arrow">
                  <div class="tooltip-arrow-inner"></div>
                </div>
              </div>
            </div>
          </button>
          
          <button onclick="selectScenario('flood')"
            class="scenario-card p-9 bg-[var(--deep-navy-2)]/90 border-2 border-[var(--game-border)] rounded-2xl hover:border-[var(--electric-green)] transition-all text-center group has-tooltip relative backdrop-blur-sm overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-br from-[var(--electric-green)]/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
            <span class="text-7xl mb-6 block">üåä</span>
            <h3 class="font-bold text-2xl text-[var(--electric-green)] group-hover:text-[var(--electric-green)]/90 mb-4 transition-colors">Flash Flood</h3>
            <p class="text-sm text-slate-400 mb-5">Monsoon rains ‚Ä¢ Rising waters ‚Ä¢ Dam release</p>
            <div class="flex justify-center gap-3 flex-wrap">
              <span class="px-4 py-1.5 bg-blue-900/30 text-blue-300 rounded-full text-xs font-semibold border border-blue-500/30">üö£ Rescue Ops</span>
              <span class="px-4 py-1.5 bg-indigo-900/30 text-indigo-300 rounded-full text-xs font-semibold border border-indigo-500/30">üè† Evacuation</span>
            </div>
            <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-5 group-hover:visible group-hover:opacity-100">
              <div class="tooltip-content">
                Water-focused scenario - Rescue operations and evacuation critical with time-sensitive decisions
                <div class="tooltip-arrow">
                  <div class="tooltip-arrow-inner"></div>
                </div>
              </div>
            </div>
          </button>
        </div>
        <button onclick="goBack('role')"
          class="mt-12 text-slate-400 hover:text-[var(--electric-cyan)] transition-all flex items-center gap-2 group mx-auto">
          <span class="transition-transform group-hover:-translate-x-1 text-lg">‚Üê</span> 
          <span class="text-lg font-medium">Back to Role Selection</span>
        </button>
      </div>
    </div>

    <!-- Main Game Screen - GLASSMORPHISM ENHANCED -->
    <div id="game-screen" class="hidden h-full w-full flex flex-col bg-[var(--deep-navy-1)]">
      <!-- Top HUD - GLASSMORPHISM -->
      <div class="flex-shrink-0 bg-[var(--deep-navy-2)]/95 backdrop-blur-sm border-b border-[var(--game-border)] p-5 shadow-lg">
        <div class="flex flex-wrap items-center justify-between gap-5">
          <div class="flex items-center gap-5">
            <div id="scenario-badge" class="flex items-center gap-3 px-5 py-2.5 bg-[var(--electric-cyan)]/15 rounded-xl relative group has-tooltip border border-[var(--electric-cyan)]/30">
              <span id="scenario-icon" class="text-xl">üåÄ</span>
              <span id="scenario-name" class="font-bold text-[var(--electric-cyan)] text-lg">TYPHOON MARING</span>
              <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-4 group-hover:visible group-hover:opacity-100">
                <div class="tooltip-content">
                  Current disaster scenario information and alert status
                  <div class="tooltip-arrow">
                    <div class="tooltip-arrow-inner"></div>
                  </div>
                </div>
              </div>
            </div>
            <div id="alert-level" class="flex items-center gap-3 px-5 py-2.5 bg-[var(--electric-pink)]/15 rounded-xl alert-pulse relative group has-tooltip border border-[var(--electric-pink)]/30">
              <span class="text-xl">‚ö†Ô∏è</span>
              <span class="font-bold text-[var(--electric-pink)] text-lg">SIGNAL NO. 4</span>
              <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-4 group-hover:visible group-hover:opacity-100">
                <div class="tooltip-content">
                  Hazard alert level indicating extreme danger severity - take immediate protective actions
                  <div class="tooltip-arrow">
                    <div class="tooltip-arrow-inner"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="flex items-center gap-6">
            <div class="flex items-center gap-3 relative group has-tooltip">
              <span class="text-slate-400 text-xl">‚è±Ô∏è</span>
              <span id="game-timer" class="font-mono text-[var(--electric-cyan)] font-bold text-2xl">15:00</span>
              <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-4 group-hover:visible group-hover:opacity-100">
                <div class="tooltip-content">
                  Time remaining in simulation - make decisions quickly but thoughtfully
                  <div class="tooltip-arrow">
                    <div class="tooltip-arrow-inner"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="flex items-center gap-3 relative group has-tooltip">
              <span class="text-slate-400 text-xl">üìä</span>
              <span id="current-score" class="font-mono text-[var(--electric-green)] font-bold text-2xl">0</span>
              <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-4 group-hover:visible group-hover:opacity-100">
                <div class="tooltip-content">
                  Training performance score - based on lives saved, resources used, and decision quality
                  <div class="tooltip-arrow">
                    <div class="tooltip-arrow-inner"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Game Area -->
      <div class="flex-1 flex flex-col lg:flex-row overflow-hidden">
        <!-- Left Panel - Map & Status -->
        <div class="lg:w-2/3 flex flex-col p-6 overflow-auto scrollbar-thin">
          <!-- Map Section - ENHANCED GLASSMORPHISM -->
          <div class="glass-panel rounded-2xl p-7 mb-7 shadow-2xl border border-[var(--game-border)]/50">
            <div class="flex items-center justify-between mb-6">
              <h3 class="font-bold text-xl text-slate-200 flex items-center gap-4">
                <span class="text-2xl">üó∫Ô∏è</span> 
                <span>Area Map - <span id="map-area-name" class="text-[var(--electric-cyan)]">Municipality Overview</span></span>
              </h3>
              <div class="flex items-center gap-2 text-sm text-slate-400">
                <span>üí°</span>
                <span>Hover over cells for details ‚Ä¢ Click to take action</span>
              </div>
            </div>
            <div class="map-container">
              <!-- Main Map Grid -->
              <div id="game-map" class="map-grid">
                <!-- Map cells will be generated here by JavaScript -->
              </div>
              
              <!-- Legend Panel - ENHANCED -->
              <div class="map-legend scrollbar-thin">
                <div class="legend-title">
                  <span class="text-xl">üìã</span> 
                  <span>Interactive Legend</span>
                </div>
                
                <!-- Area Types -->
                <div class="legend-section">
                  <div style="font-size: 12px; font-weight: 700; color: #94a3b8; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.8px;">
                    Area Types
                  </div>
                  <div class="legend-item" title="Urban residential and commercial areas">
                    <div class="legend-icon">üèòÔ∏è</div>
                    <div class="legend-text">Urban Zones</div>
                  </div>
                  <div class="legend-item" title="Bodies of water and rivers">
                    <div class="legend-icon">üåä</div>
                    <div class="legend-text">Water Bodies</div>
                  </div>
                  <div class="legend-item" title="Agricultural and forested areas">
                    <div class="legend-icon">üå≥</div>
                    <div class="legend-text">Natural Areas</div>
                  </div>
                  <div class="legend-item" title="Key facilities and infrastructure">
                    <div class="legend-icon">üèõÔ∏è</div>
                    <div class="legend-text">Critical Facilities</div>
                  </div>
                </div>
                
                <!-- Status Colors -->
                <div class="legend-section">
                  <div style="font-size: 12px; font-weight: 700; color: #94a3b8; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.8px;">
                    Status Indicators
                  </div>
                  <div class="legend-item" title="Normal conditions, no immediate threat">
                    <div class="legend-color-box" style="background: linear-gradient(135deg, #475569 0%, #64748b 100%); border: 1.5px solid #cbd5e1;"></div>
                    <div class="legend-text">Normal Status</div>
                  </div>
                  <div class="legend-item" title="Population affected by disaster - requires immediate attention">
                    <div class="legend-color-box" style="background: linear-gradient(135deg, #b91c1c 0%, #dc2626 100%); border: 2.5px solid #fca5a5;"></div>
                    <div class="legend-text">Affected Area</div>
                  </div>
                  <div class="legend-item" title="Areas submerged by floodwater - rescue operations critical">
                    <div class="legend-color-box" style="background: linear-gradient(135deg, #6d28d9 0%, #7c3aed 100%); border: 2.5px solid #a78bfa;"></div>
                    <div class="legend-text">Flooded Zone</div>
                  </div>
                  <div class="legend-item" title="Evacuation in progress - monitor resource allocation">
                    <div class="legend-color-box" style="background: linear-gradient(135deg, #b45309 0%, #d97706 100%); border: 2.5px solid #fed7aa;"></div>
                    <div class="legend-text">Evacuation Zone</div>
                  </div>
                  <div class="legend-item" title="All residents secured to safety - maintain monitoring">
                    <div class="legend-color-box" style="background: linear-gradient(135deg, #047857 0%, #10b981 100%); border: 2.5px solid #6ee7b7;"></div>
                    <div class="legend-text">Safe Zone</div>
                  </div>
                </div>
                
                <!-- Quick Info -->
                <div class="legend-section">
                  <div style="font-size: 12px; font-weight: 700; color: #94a3b8; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.8px;">
                    Pro Tips
                  </div>
                  <div style="font-size: 13px; color: #cbd5e1; line-height: 1.6; padding: 10px; background: rgba(6, 182, 212, 0.08); border-radius: 8px; border-left: 3px solid var(--game-accent);">
                    üí° <strong>Hover</strong> over cells to see detailed information. <strong>Click</strong> affected areas to deploy rescue resources. Prioritize high-population zones and use evacuation trucks for preventative measures.
                  </div>
                </div>
              </div>
            </div>
            
            <div id="selected-cell-info" class="mt-6 p-6 bg-[var(--deep-navy-2)]/80 backdrop-blur-sm rounded-xl hidden border-l-4 border-[var(--electric-cyan)] shadow-lg">
              <div class="flex items-center justify-between mb-5">
                <div>
                  <h4 id="cell-name" class="font-bold text-[var(--electric-cyan)] text-2xl">Area Name</h4>
                  <p id="cell-status" class="text-sm text-slate-300 mt-2 flex items-center gap-2">
                    <span class="w-2.5 h-2.5 rounded-full bg-[var(--electric-green)]"></span>
                    Status information
                  </p>
                </div>
                <div class="flex-shrink-0">
                  <div class="w-16 h-16 rounded-xl bg-[var(--deep-navy-3)] flex items-center justify-center text-3xl" id="cell-icon">üè†</div>
                </div>
              </div>
              <div id="cell-actions" class="flex flex-wrap gap-3 pt-4 border-t border-[var(--game-border)]">
                <!-- Action buttons will appear here -->
              </div>
            </div>
          </div>

          <!-- Stats Dashboard - GLASSMORPHISM ENHANCED -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5">
            <div class="stat-card glass-panel rounded-xl p-5 text-center border border-[var(--game-border)]/50 shadow-lg relative group has-tooltip">
              <div class="text-4xl mb-3">üë•</div>
              <div id="stat-population" class="text-3xl font-bold text-white">12,450</div>
              <div class="text-sm text-slate-300 mt-2 font-medium">Total Population</div>
              <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-4 group-hover:visible group-hover:opacity-100">
                <div class="tooltip-content">
                  Total residents in affected area requiring protection and assistance
                  <div class="tooltip-arrow">
                    <div class="tooltip-arrow-inner"></div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="stat-card glass-panel rounded-xl p-5 text-center border border-[var(--game-border)]/50 shadow-lg relative group has-tooltip">
              <div class="text-4xl mb-3">üèÉ</div>
              <div id="stat-evacuated" class="text-3xl font-bold text-[var(--electric-green)]">0</div>
              <div class="text-sm text-slate-300 mt-2 font-medium">Evacuated</div>
              <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-4 group-hover:visible group-hover:opacity-100">
                <div class="tooltip-content">
                  People successfully moved to safety zones - your primary success metric
                  <div class="tooltip-arrow">
                    <div class="tooltip-arrow-inner"></div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="stat-card glass-panel rounded-xl p-5 text-center border border-[var(--game-border)]/50 shadow-lg relative group has-tooltip">
              <div class="text-4xl mb-3">‚ö†Ô∏è</div>
              <div id="stat-affected" class="text-3xl font-bold text-[var(--electric-pink)]">0</div>
              <div class="text-sm text-slate-300 mt-2 font-medium">Affected</div>
              <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-4 group-hover:visible group-hover:opacity-100">
                <div class="tooltip-content">
                  People impacted by the disaster requiring immediate assistance
                  <div class="tooltip-arrow">
                    <div class="tooltip-arrow-inner"></div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="stat-card glass-panel rounded-xl p-5 text-center border border-[var(--game-border)]/50 shadow-lg relative group has-tooltip">
              <div class="text-4xl mb-3">üíî</div>
              <div id="stat-casualties" class="text-3xl font-bold text-[var(--electric-purple)]">0</div>
              <div class="text-sm text-slate-300 mt-2 font-medium">Casualties</div>
              <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-4 group-hover:visible group-hover:opacity-100">
                <div class="tooltip-content">
                  Deaths and severe injuries - minimize at all costs through timely decisions
                  <div class="tooltip-arrow">
                    <div class="tooltip-arrow-inner"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Panel - Controls & Events - GLASSMORPHISM ENHANCED -->
        <div class="lg:w-1/3 flex flex-col bg-[var(--deep-navy-2)]/90 backdrop-blur-sm border-l border-[var(--game-border)]/50 overflow-hidden shadow-2xl">
          <!-- Resources Section -->
          <div class="p-6 border-b border-[var(--game-border)]/50">
            <h3 class="font-bold text-xl text-slate-200 mb-5 flex items-center gap-3">
              <span class="text-2xl">üì¶</span> Available Resources
            </h3>
            <div id="resources-panel" class="grid grid-cols-1 gap-4">
              <!-- Resource cards will be generated by JavaScript -->
            </div>
          </div>
          
          <!-- Active Events / Decisions -->
          <div class="flex-1 flex flex-col overflow-hidden">
            <div class="p-6 border-b border-[var(--game-border)]/50">
              <h3 class="font-bold text-xl text-slate-200 flex items-center gap-3">
                <span class="text-2xl">üö®</span> Active Situation
              </h3>
            </div>
            <div id="events-panel" class="flex-1 overflow-auto p-6 scrollbar-thin">
              <div id="current-decision" class="glass-panel rounded-xl p-6 border border-[var(--game-border)]/50 shadow-lg">
                <p class="text-slate-400 text-center text-lg">Simulation initializing...</p>
                <p class="text-slate-500 text-center mt-2 text-sm">Prepare for emergency response operations</p>
              </div>
            </div>
          </div>
          
          <!-- Communication Log - GLASSMORPHISM ENHANCED -->
          <div class="p-5 border-t border-[var(--game-border)]/50 max-h-56 overflow-auto scrollbar-thin bg-[var(--deep-navy-2)]/50">
            <h3 class="font-bold text-slate-200 mb-3 text-base flex items-center gap-2">
              <span class="text-xl">üìª</span> Communications Log
            </h3>
            <div id="comm-log" class="space-y-2.5 text-sm">
              <div class="text-slate-500 flex items-start gap-2">
                <span class="text-[var(--electric-cyan)] font-medium">[SYSTEM]</span>
                <span>EOC simulation platform ready</span>
              </div>
              <div class="text-slate-500 flex items-start gap-2">
                <span class="text-[var(--electric-green)] font-medium">[READY]</span>
                <span>Select role and scenario to begin training</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Screen - GLASSMORPHISM ENHANCED -->
    <div id="results-screen" class="hidden h-full w-full flex flex-col items-center justify-center p-6 bg-gradient-to-br from-[var(--deep-navy-1)] via-[var(--deep-navy-2)] to-[var(--deep-navy-1)] overflow-auto">
      <div class="max-w-4xl w-full text-center animate-fadeIn">
        <div class="mb-10 animate-scaleIn relative">
          <span id="result-icon" class="text-9xl">üèÜ</span>
          <div class="absolute inset-0 bg-[var(--electric-cyan)] rounded-full blur-3xl opacity-25 animate-pulse-slow"></div>
        </div>
        <h2 class="game-title text-5xl font-bold text-gradient mb-4 animate-slideUp">SIMULATION COMPLETE</h2>
        <p id="result-message" class="text-2xl text-slate-300 mb-10 animate-slideUp max-w-3xl mx-auto">
          Excellent emergency response performance!
        </p>
        
        <div class="glass-panel rounded-2xl p-9 mb-10 shadow-2xl border border-[var(--game-border)]/50 animate-slideUp">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-10">
            <div class="text-center">
              <div class="text-5xl font-bold text-[var(--electric-cyan)]" id="result-score">0</div>
              <div class="text-base text-slate-300 mt-3 font-medium">Final Score</div>
            </div>
            <div class="text-center">
              <div class="text-5xl font-bold text-[var(--electric-green)]" id="result-saved">0</div>
              <div class="text-base text-slate-300 mt-3 font-medium">Lives Saved</div>
            </div>
            <div class="text-center">
              <div class="text-5xl font-bold text-[var(--electric-purple)]" id="result-efficiency">0%</div>
              <div class="text-base text-slate-300 mt-3 font-medium">Resource Efficiency</div>
            </div>
            <div class="text-center">
              <div class="text-5xl font-bold text-[var(--electric-pink)]" id="result-decisions">0</div>
              <div class="text-base text-slate-300 mt-3 font-medium">Decisions Made</div>
            </div>
          </div>
          
          <div class="border-t border-[var(--game-border)] pt-8">
            <h4 class="font-bold text-xl text-slate-200 mb-6 text-center">Performance Analysis</h4>
            <div id="performance-bars" class="space-y-5 max-w-2xl mx-auto">
              <!-- Performance bars will be generated by JavaScript -->
            </div>
          </div>
        </div>
        
        <div id="result-feedback" class="glass-panel rounded-xl p-7 mb-10 text-left border border-[var(--game-border)]/50 shadow-lg animate-slideUp">
          <h4 class="font-bold text-2xl text-[var(--electric-cyan)] mb-4 flex items-center gap-3">
            <span class="text-3xl">üìã</span> 
            Training Debriefing
          </h4>
          <ul id="feedback-list" class="text-base text-slate-300 space-y-3 leading-relaxed pl-5">
            <!-- Feedback items will be generated by JavaScript -->
          </ul>
        </div>
        
        <div class="flex flex-wrap justify-center gap-6 animate-slideUp">
          <button onclick="restartGame()"
            class="btn-primary shimmer-effect px-9 py-4 bg-gradient-to-r from-[var(--electric-cyan)] to-[var(--electric-purple)] hover:from-[var(--electric-cyan)] hover:to-[var(--electric-pink)] text-white font-bold text-lg rounded-xl transition-all shadow-xl hover:shadow-[var(--electric-cyan)]/50 relative group has-tooltip ripple">
            üîÑ Play Again
            <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-4 group-hover:visible group-hover:opacity-100">
              <div class="tooltip-content">
                Run another training simulation with the same or different scenario
                <div class="tooltip-arrow">
                  <div class="tooltip-arrow-inner"></div>
                </div>
              </div>
            </div>
          </button>
          <button onclick="returnToTitle()"
            class="px-9 py-4 bg-[var(--deep-navy-2)] hover:bg-[var(--deep-navy-3)] text-white font-bold text-lg rounded-xl transition-all shadow-lg border border-[var(--game-border)] hover:border-[var(--electric-cyan)] relative group has-tooltip">
            üè† Return to Main Menu
            <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-4 group-hover:visible group-hover:opacity-100">
              <div class="tooltip-content">
                Return to title screen to select different role or scenario
                <div class="tooltip-arrow">
                  <div class="tooltip-arrow-inner"></div>
                </div>
              </div>
            </div>
          </button>
        </div>
      </div>
    </div>

    <!-- Leaderboard Modal - GLASSMORPHISM ENHANCED -->
    <div id="leaderboard-modal" class="hidden fixed inset-0 flex items-center justify-center p-4 z-50">
      <div class="modal-overlay absolute inset-0" onclick="hideLeaderboard()"></div>
      <div class="relative glass-panel rounded-2xl p-9 max-w-3xl w-full max-h-[85vh] overflow-auto shadow-2xl border border-[var(--game-border)]/50 animate-scaleIn">
        <button onclick="hideLeaderboard()"
          class="absolute top-6 right-6 text-slate-400 hover:text-[var(--electric-cyan)] text-4xl transition-all hover:rotate-90 hover:scale-110">
          √ó
        </button>
        <h3 class="game-title text-4xl font-bold text-gradient mb-8 text-center">üìä Training Records</h3>
        <div id="leaderboard-content" class="space-y-4 max-h-[calc(85vh-12rem)] overflow-y-auto pr-4 scrollbar-thin">
          <p class="text-slate-400 text-center py-8 text-lg">No records yet. Complete a simulation to save your score!</p>
        </div>
      </div>
    </div>

    <!-- Notification Toast Container -->
    <div id="notification-container" class="fixed top-6 right-6 z-50 space-y-4 max-w-sm">
      <!-- Notifications will appear here -->
    </div>
  </div>

  <script>
    // ===== CONFIGURATION & STATE =====
    const defaultConfig = {
      game_title: 'EOC SIMULATION',
      lgu_name: 'Municipality of XYZ, Province of ABC',
      welcome_message: 'Train your emergency response skills through realistic disaster scenarios. Make critical decisions, manage resources, and coordinate rescue operations.',
      background_color: '#ffffff',   // WAS '#0b1121'
      surface_color: '#f8fafc',      // WAS '#162032'
      text_color: '#1e293b',         // WAS '#e2e8f0'
      primary_color: '#06b6d4',
      secondary_color: '#8b5cf6'
    };
    
    let config = { ...defaultConfig };
    let gameRecords = [];
    
    // Game State
    let gameState = {
      playerName: '',
      role: '',
      scenario: '',
      score: 0,
      timeRemaining: 900,
      timerInterval: null,
      currentPhase: 0,
      decisions: [],
      population: 12450,
      evacuated: 0,
      affected: 0,
      casualties: 0,
      resources: {
        rescue_boats: { name: 'üö£ Rescue Boats', count: 8, max: 8 },
        medical_teams: { name: 'üè• Medical Teams', count: 5, max: 5 },
        evacuation_trucks: { name: 'üöõ Evac Trucks', count: 6, max: 6 },
        relief_packs: { name: 'üì¶ Relief Packs', count: 500, max: 500 },
        responders: { name: 'üë∑ Responders', count: 50, max: 50 }
      },
      mapCells: [],
      selectedCell: null,
      eventQueue: [],
      currentEvent: null,
      metrics: {
        responseTime: 0,
        resourceEfficiency: 100,
        communicationScore: 100,
        decisionQuality: 100
      }
    };
    
    // ===== SCENARIOS DATA =====
    const scenarios = {
      typhoon: {
        name: 'Super Typhoon Maring',
        icon: 'üåÄ',
        alertLevel: 'SIGNAL NO. 4',
        alertColor: 'pink',
        hazardTypes: ['flooding', 'wind_damage', 'landslide'],
        events: [
          {
            phase: 1,
            title: 'üåßÔ∏è Heavy Rainfall Warning',
            description: 'PAGASA reports 150mm rainfall in the last 3 hours. River levels rising rapidly in Barangay San Miguel.',
            options: [
              { text: 'Issue immediate evacuation order for riverside areas', effect: { evacuated: 800, score: 100, time: -60, resources: { evacuation_trucks: -2 } }, feedback: 'Quick evacuation saved many lives.' },
              { text: 'Monitor situation and prepare evacuation centers', effect: { affected: 200, score: 50, time: -30 }, feedback: 'Preparation helped but delayed response increased affected population.' },
              { text: 'Send warning through barangay officials only', effect: { affected: 400, score: 20, time: -20 }, feedback: 'Limited communication reach resulted in more people getting stranded.' }
            ]
          },
          {
            phase: 2,
            title: 'üåä Flash Flood in Purok 3',
            description: 'Water levels have risen to 1.5 meters. 200 families trapped in their homes. Some are on rooftops.',
            options: [
              { text: 'Deploy all available rescue boats immediately', effect: { evacuated: 600, score: 150, time: -90, resources: { rescue_boats: -6, responders: -20 } }, feedback: 'Aggressive rescue operation was highly effective.' },
              { text: 'Deploy rescue boats gradually while coordinating with Coast Guard', effect: { evacuated: 400, casualties: 5, score: 80, time: -60, resources: { rescue_boats: -4, responders: -15 } }, feedback: 'Coordinated approach was safer but some casualties occurred due to delay.' },
              { text: 'Wait for water levels to stabilize before rescue', effect: { casualties: 25, score: -50, time: -30 }, feedback: 'Waiting proved fatal for many stranded residents.' }
            ]
          },
          {
            phase: 3,
            title: 'üè• Medical Emergency at Evacuation Center',
            description: 'Multiple evacuees showing symptoms of hypothermia and respiratory infections. Medical supplies running low.',
            options: [
              { text: 'Request emergency medical supplies from provincial office', effect: { score: 80, time: -45, metrics: { communicationScore: 10 } }, feedback: 'Inter-agency coordination secured additional resources.' },
              { text: 'Redistribute existing supplies and prioritize critical cases', effect: { casualties: 3, score: 60, time: -30, resources: { relief_packs: -100 } }, feedback: 'Efficient triage but limited supplies led to some complications.' },
              { text: 'Send medical teams to evacuation center', effect: { score: 100, time: -60, resources: { medical_teams: -3 } }, feedback: 'Direct medical intervention improved health outcomes.' }
            ]
          },
          {
            phase: 4,
            title: 'üõ£Ô∏è Road Blocked by Landslide',
            description: 'Main highway to evacuation center blocked. Relief trucks cannot deliver supplies. 2,000 evacuees waiting.',
            options: [
              { text: 'Coordinate with DPWH for immediate clearing operations', effect: { score: 70, time: -120, metrics: { communicationScore: 15 } }, feedback: 'Inter-agency coordination resolved the blockage.' },
              { text: 'Find alternative routes through barangay roads', effect: { score: 90, time: -60, resources: { evacuation_trucks: -1 } }, feedback: 'Quick thinking found alternative supply routes.' },
              { text: 'Use boats to transport supplies via river', effect: { score: 100, time: -45, resources: { rescue_boats: -2 } }, feedback: 'Creative solution ensured continuous relief operations.' }
            ]
          },
          {
            phase: 5,
            title: 'üì¢ Misinformation Spreading',
            description: 'False reports of dam failure spreading panic on social media. Residents fleeing to higher ground chaotically.',
            options: [
              { text: 'Issue official statement through all channels immediately', effect: { score: 100, time: -30, metrics: { communicationScore: 20 } }, feedback: 'Clear communication prevented panic-induced accidents.' },
              { text: 'Contact dam management for verification first', effect: { affected: 100, score: 60, time: -45, metrics: { communicationScore: -10 } }, feedback: 'Verification caused delay but ensured accurate information.' },
              { text: 'Deploy responders to manage crowd movement', effect: { affected: 50, score: 70, time: -60, resources: { responders: -15 } }, feedback: 'Ground management helped but didn\'t address root cause.' }
            ]
          }
        ]
      },
      earthquake: {
        name: 'Magnitude 7.2 Earthquake',
        icon: 'üèöÔ∏è',
        alertLevel: 'INTENSITY VIII',
        alertColor: 'pink',
        hazardTypes: ['collapse', 'fire', 'aftershock'],
        events: [
          {
            phase: 1,
            title: 'üèóÔ∏è Building Collapse Reported',
            description: 'Multiple structures collapsed in commercial district. Estimated 150 people trapped. Aftershocks continuing.',
            options: [
              { text: 'Deploy all rescue teams with heavy equipment', effect: { evacuated: 100, score: 120, time: -90, resources: { responders: -30, medical_teams: -3 } }, feedback: 'Immediate deployment saved trapped survivors.' },
              { text: 'Assess structural safety before deploying teams', effect: { evacuated: 60, casualties: 15, score: 60, time: -60 }, feedback: 'Safety assessment caused delays but protected rescuers.' },
              { text: 'Coordinate with military for heavy equipment', effect: { evacuated: 80, casualties: 10, score: 80, time: -120, metrics: { communicationScore: 10 } }, feedback: 'Military assets proved valuable but took time to mobilize.' }
            ]
          },
          {
            phase: 2,
            title: 'üî• Fire Outbreak in Residential Area',
            description: 'Gas line rupture caused fire in Purok 5. Fire spreading to nearby wooden houses. 50 families at risk.',
            options: [
              { text: 'Evacuate affected areas and deploy fire volunteers', effect: { evacuated: 200, score: 100, time: -60, resources: { responders: -15 } }, feedback: 'Quick evacuation prevented casualties from fire.' },
              { text: 'Request BFP support for fire suppression', effect: { affected: 50, score: 80, time: -90, metrics: { communicationScore: 10 } }, feedback: 'Professional firefighting contained the blaze.' },
              { text: 'Cut power to prevent electrical fires', effect: { score: 60, time: -30 }, feedback: 'Preventive measure reduced fire spread risk.' }
            ]
          },
          {
            phase: 3,
            title: 'üè• Hospital Overwhelmed',
            description: 'District hospital over capacity. 200+ injured waiting for treatment. Medical supplies critically low.',
            options: [
              { text: 'Set up field hospital at evacuation center', effect: { score: 100, time: -60, resources: { medical_teams: -2, relief_packs: -150 } }, feedback: 'Field hospital effectively managed overflow patients.' },
              { text: 'Coordinate patient transfers to other hospitals', effect: { score: 80, time: -90, resources: { evacuation_trucks: -3 }, metrics: { communicationScore: 10 } }, feedback: 'Patient distribution eased hospital burden.' },
              { text: 'Request DOH emergency medical supplies', effect: { score: 70, time: -120, metrics: { communicationScore: 15 } }, feedback: 'National support replenished critical supplies.' }
            ]
          },
          {
            phase: 4,
            title: '‚ö†Ô∏è Strong Aftershock Warning',
            description: 'PHIVOLCS warns of possible magnitude 6.0 aftershock. Damaged structures at high risk of secondary collapse.',
            options: [
              { text: 'Immediately evacuate all damaged building areas', effect: { evacuated: 500, score: 120, time: -45, resources: { evacuation_trucks: -4, responders: -20 } }, feedback: 'Preemptive evacuation saved lives when aftershock struck.' },
              { text: 'Issue public warning and mark dangerous structures', effect: { affected: 100, score: 80, time: -30, metrics: { communicationScore: 10 } }, feedback: 'Warning helped but some ignored the alerts.' },
              { text: 'Suspend rescue operations until aftershock passes', effect: { casualties: 20, score: -30, time: -60 }, feedback: 'Suspension led to loss of trapped survivors.' }
            ]
          },
          {
            phase: 5,
            title: 'üè† Mass Displacement',
            description: '3,000+ residents homeless. Temporary shelters needed urgently. Rain expected tonight.',
            options: [
              { text: 'Open all schools and gyms as evacuation centers', effect: { evacuated: 1500, score: 100, time: -60, resources: { relief_packs: -200 } }, feedback: 'Multiple evacuation sites accommodated displaced families.' },
              { text: 'Request tents from DSWD regional office', effect: { evacuated: 800, score: 80, time: -120, metrics: { communicationScore: 10 } }, feedback: 'Additional shelter materials helped but took time.' },
              { text: 'Prioritize most vulnerable for indoor shelter', effect: { evacuated: 500, affected: 300, score: 60, time: -45, resources: { relief_packs: -100 } }, feedback: 'Triage approach protected vulnerable but left others exposed.' }
            ]
          }
        ]
      },
      flood: {
        name: 'Flash Flood Emergency',
        icon: 'üåä',
        alertLevel: 'RED WARNING',
        alertColor: 'cyan',
        hazardTypes: ['flooding', 'landslide'],
        events: [
          {
            phase: 1,
            title: 'üíß Dam Water Release',
            description: 'Upstream dam releasing water due to critical levels. Downstream barangays have 2 hours before water arrives.',
            options: [
              { text: 'Immediate forced evacuation of flood plains', effect: { evacuated: 1000, score: 150, time: -90, resources: { evacuation_trucks: -4, responders: -25 } }, feedback: 'Early evacuation ensured zero casualties from flooding.' },
              { text: 'Alert barangay captains to begin voluntary evacuation', effect: { evacuated: 600, affected: 200, score: 80, time: -60 }, feedback: 'Voluntary evacuation was partially effective.' },
              { text: 'Prepare rescue boats for deployment after flooding', effect: { casualties: 30, affected: 400, score: -20, time: -30, resources: { rescue_boats: -4 } }, feedback: 'Reactive approach resulted in preventable casualties.' }
            ]
          },
          {
            phase: 2,
            title: 'üö£ Stranded Residents in Sitio Riverside',
            description: '80 families stranded on rooftops. Water at chest level and rising. Children and elderly among them.',
            options: [
              { text: 'Deploy all rescue boats with medical personnel', effect: { evacuated: 300, score: 130, time: -75, resources: { rescue_boats: -6, medical_teams: -2, responders: -15 } }, feedback: 'Comprehensive rescue saved all stranded families.' },
              { text: 'Deploy rescue boats, request military helicopter support', effect: { evacuated: 280, score: 110, time: -90, resources: { rescue_boats: -4 }, metrics: { communicationScore: 15 } }, feedback: 'Air support accelerated rescue of critical cases.' },
              { text: 'Prioritize children and elderly for first rescue trips', effect: { evacuated: 150, affected: 50, score: 80, time: -60, resources: { rescue_boats: -3 } }, feedback: 'Prioritization protected vulnerable but delayed others.' }
            ]
          },
          {
            phase: 3,
            title: 'üè´ Evacuation Center Flooded',
            description: 'Elementary school evacuation center now flooded. 500 evacuees need to be relocated immediately.',
            options: [
              { text: 'Transfer all evacuees to gymnasium on higher ground', effect: { evacuated: 500, score: 100, time: -60, resources: { evacuation_trucks: -3, responders: -10 } }, feedback: 'Swift relocation prevented secondary displacement crisis.' },
              { text: 'Move evacuees to upper floors of school building', effect: { affected: 100, score: 60, time: -30 }, feedback: 'Temporary measure provided shelter but poor conditions.' },
              { text: 'Request provincial assistance for additional shelter', effect: { affected: 50, score: 80, time: -90, metrics: { communicationScore: 10 } }, feedback: 'Provincial support expanded shelter capacity.' }
            ]
          },
          {
            phase: 4,
            title: 'ü¶† Waterborne Disease Outbreak Risk',
            description: 'Health officer warns of potential leptospirosis outbreak. Contaminated flood water widespread.',
            options: [
              { text: 'Distribute water purification tablets and boots', effect: { score: 100, time: -45, resources: { relief_packs: -150 } }, feedback: 'Preventive measures significantly reduced disease cases.' },
              { text: 'Set up medical checkpoints at evacuation centers', effect: { score: 80, time: -60, resources: { medical_teams: -2 } }, feedback: 'Health monitoring enabled early treatment.' },
              { text: 'Issue public health advisory through loudspeakers', effect: { affected: 50, score: 50, time: -20, metrics: { communicationScore: 5 } }, feedback: 'Information campaign reached limited audience.' }
            ]
          },
          {
            phase: 5,
            title: 'üåßÔ∏è Second Wave Warning',
            description: 'PAGASA reports another storm cell approaching. Expected to intensify flooding in 4 hours.',
            options: [
              { text: 'Expand evacuation to include medium-risk areas', effect: { evacuated: 800, score: 120, time: -90, resources: { evacuation_trucks: -4, responders: -20 } }, feedback: 'Proactive expansion prevented second wave casualties.' },
              { text: 'Fortify current evacuation centers with supplies', effect: { score: 80, time: -60, resources: { relief_packs: -200 } }, feedback: 'Preparation helped weather the second wave.' },
              { text: 'Request national government disaster declaration', effect: { score: 70, time: -120, metrics: { communicationScore: 20 } }, feedback: 'National attention brought additional resources.' }
            ]
          }
        ]
      }
    };
    
    // ===== INITIALIZATION =====
    async function initializeApp() {
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => {
            config = { ...defaultConfig, ...newConfig };
            updateUIFromConfig();
          },
          mapToCapabilities: (cfg) => ({
            recolorables: [
              {
                get: () => cfg.background_color || defaultConfig.background_color,
                set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
              },
              {
                get: () => cfg.surface_color || defaultConfig.surface_color,
                set: (v) => { cfg.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); }
              },
              {
                get: () => cfg.text_color || defaultConfig.text_color,
                set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
              },
              {
                get: () => cfg.primary_color || defaultConfig.primary_color,
                set: (v) => { cfg.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); }
              },
              {
                get: () => cfg.secondary_color || defaultConfig.secondary_color,
                set: (v) => { cfg.secondary_color = v; window.elementSdk.setConfig({ secondary_color: v }); }
              }
            ],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['game_title', cfg.game_title || defaultConfig.game_title],
            ['lgu_name', cfg.lgu_name || defaultConfig.lgu_name],
            ['welcome_message', cfg.welcome_message || defaultConfig.welcome_message]
          ])
        });
      }
      
      if (window.dataSdk) {
        const dataHandler = {
          onDataChanged: (data) => {
            gameRecords = data || [];
            updateLeaderboardDisplay();
          }
        };
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          console.error('Failed to initialize data SDK');
        }
      }
      
      updateUIFromConfig();
    }
    
    function updateUIFromConfig() {
      const mainTitle = document.getElementById('main-title');
      const lguDisplay = document.getElementById('lgu-display');
      const welcomeText = document.getElementById('welcome-text');
      
      if (mainTitle) mainTitle.textContent = config.game_title || defaultConfig.game_title;
      if (lguDisplay) lguDisplay.innerHTML = `<span class="w-3 h-3 rounded-full bg-[var(--electric-green)] animate-pulse-slow mr-2"></span>${config.lgu_name || defaultConfig.lgu_name}`;
      if (welcomeText) welcomeText.textContent = config.welcome_message || defaultConfig.welcome_message;
    }
    
    // ===== SCREEN NAVIGATION =====
    function showScreen(screenId) {
      const screens = ['title-screen', 'role-screen', 'scenario-screen', 'game-screen', 'results-screen'];
      screens.forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      document.getElementById(screenId).classList.remove('hidden');
      
      // Reset scroll position when showing screen
      const screenElement = document.getElementById(screenId);
      if (screenElement) {
        screenElement.scrollTop = 0;
      }
    }
    
    function startGame() {
      const nameInput = document.getElementById('player-name');
      gameState.playerName = nameInput.value.trim() || 'EOC Trainee';
      showScreen('role-screen');
      
      // Add communication log entry
      addCommLog(`üë§ Player "${gameState.playerName}" has entered the EOC`);
    }
    
    function selectRole(role) {
      gameState.role = role;
      showScreen('scenario-screen');
      
      // Add communication log entry
      const roleNames = {
        incident_commander: 'Incident Commander',
        operations: 'Operations Chief',
        logistics: 'Logistics Chief',
        information: 'Public Information Officer'
      };
      addCommLog(`üéØ Role selected: ${roleNames[role]}`);
    }
    
    function selectScenario(scenario) {
      gameState.scenario = scenario;
      initializeGame();
      showScreen('game-screen');
      
      // Add communication log entry
      addCommLog(`üåÄ Scenario selected: ${scenarios[scenario].name}`);
      addCommLog('üéÆ Simulation starting in 3... 2... 1...');
    }
    
    function goBack(screen) {
      showScreen(screen + '-screen');
    }
    
    // ===== GAME INITIALIZATION =====
    function initializeGame() {
      const scenario = scenarios[gameState.scenario];
      
      // Reset game state
      gameState.score = 0;
      gameState.timeRemaining = 900;
      gameState.currentPhase = 0;
      gameState.decisions = [];
      gameState.evacuated = 0;
      gameState.affected = 0;
      gameState.casualties = 0;
      gameState.metrics = {
        responseTime: 0,
        resourceEfficiency: 100,
        communicationScore: 100,
        decisionQuality: 100
      };
      
      // Reset resources
      Object.keys(gameState.resources).forEach(key => {
        gameState.resources[key].count = gameState.resources[key].max;
      });
      
      // Update UI
      document.getElementById('scenario-icon').textContent = scenario.icon;
      document.getElementById('scenario-name').textContent = scenario.name.toUpperCase();
      document.getElementById('alert-level').innerHTML = `
        <span class="text-xl">‚ö†Ô∏è</span>
        <span class="font-bold text-[var(--electric-${scenario.alertColor})] text-lg">${scenario.alertLevel}</span>
      `;
      
      // Initialize map
      initializeMap();
      
      // Initialize resources panel
      updateResourcesPanel();
      
      // Start timer
      startTimer();
      
      // Start first event after brief delay
      setTimeout(() => triggerNextEvent(), 2500);
      
      // Add initial comm log
      addCommLog('üìª EOC activated. All units report to stations.');
      addCommLog(`üåê ${scenario.name} monitoring in progress.`);
      addCommLog('‚úÖ Systems operational. Ready for emergency response.');
    }
    
    function initializeMap() {
      const mapContainer = document.getElementById('game-map');
      mapContainer.innerHTML = '';
      
      const mapLayout = [
        { name: 'Coastal Area', type: 'water', icon: 'üåä' },
        { name: 'Port', type: 'urban', icon: '‚öì' },
        { name: 'Downtown Center', type: 'urban', icon: 'üè¢' },
        { name: 'Market District', type: 'urban', icon: 'üè™' },
        { name: 'Government Center', type: 'urban', icon: 'üèõÔ∏è' },
        { name: 'Hospital', type: 'urban', icon: 'üè•' },
        { name: 'School District', type: 'urban', icon: 'üè´' },
        { name: 'Resort Area', type: 'land', icon: 'üè®' },
        { name: 'Forest Reserve', type: 'land', icon: 'üå≤' },
        { name: 'Mountain', type: 'land', icon: '‚õ∞Ô∏è' },
        { name: 'Ridge Area', type: 'land', icon: 'üèîÔ∏è' },
        { name: 'Cliff Zone', type: 'land', icon: 'ü™®' },
        { name: 'Fishing Village', type: 'urban', icon: 'üé£' },
        { name: 'River Bridge', type: 'urban', icon: 'üåâ' },
        { name: 'Sports Complex', type: 'urban', icon: '‚öΩ' },
        { name: 'Commercial Area', type: 'urban', icon: 'üè≠' },
        { name: 'Residential Sector', type: 'urban', icon: 'üèòÔ∏è' },
        { name: 'Park Area', type: 'land', icon: 'üå≥' },
        { name: 'Farm Fields', type: 'land', icon: 'üåæ' },
        { name: 'Grassland', type: 'land', icon: 'üå±' },
        { name: 'Chapel', type: 'urban', icon: '‚õ™' },
        { name: 'Community Center', type: 'urban', icon: 'üèüÔ∏è' },
        { name: 'Industrial Zone', type: 'urban', icon: 'üèóÔ∏è' },
        { name: 'Open Water', type: 'water', icon: 'üíß' },
        { name: 'Riverside Purok', type: 'urban', icon: 'üè†' },
        { name: 'Main Highway', type: 'urban', icon: 'üõ£Ô∏è' },
        { name: 'Business District', type: 'urban', icon: 'üíº' },
        { name: 'Housing Complex', type: 'urban', icon: 'üèòÔ∏è' },
        { name: 'City Hall', type: 'urban', icon: 'üè¶' },
        { name: 'Convention Center', type: 'urban', icon: 'üé™' },
        { name: 'Recreation Area', type: 'land', icon: '‚õ∫' },
        { name: 'Eco Park', type: 'land', icon: 'ü¶ã' },
        { name: 'Wildlife Preserve', type: 'land', icon: 'ü¶Å' },
        { name: 'Wetlands', type: 'water', icon: 'üåø' },
        { name: 'Canal System', type: 'water', icon: 'üö£' },
        { name: 'Pond', type: 'water', icon: 'üê¢' },
        { name: 'Entertainment Zone', type: 'urban', icon: 'üé≠' },
        { name: 'Shopping Mall', type: 'urban', icon: 'üõçÔ∏è' },
        { name: 'Residential Area', type: 'urban', icon: 'üè†' },
        { name: 'Parking Lot', type: 'urban', icon: 'üÖøÔ∏è' },
        { name: 'Office Tower', type: 'urban', icon: 'üè¢' },
        { name: 'Banking Sector', type: 'urban', icon: 'üè¶' },
        { name: 'Library', type: 'urban', icon: 'üìö' },
        { name: 'Mixed Park', type: 'land', icon: 'üé°' },
        { name: 'Garden Area', type: 'land', icon: 'üå∫' },
        { name: 'Lake', type: 'water', icon: 'üèûÔ∏è' },
        { name: 'Dam', type: 'water', icon: 'üîß' },
        { name: 'Reservoir', type: 'water', icon: 'üíß' }
      ];
      
      gameState.mapCells = [];
      
      for (let i = 0; i < mapLayout.length; i++) {
        const cellData = mapLayout[i];
        const cellData_complete = {
          id: i,
          name: cellData.name,
          type: cellData.type,
          icon: cellData.icon,
          status: 'normal',
          population: cellData.type === 'urban' ? Math.floor(Math.random() * 500) + 200 : 0,
          affected: 0,
          evacuated: 0
        };
        
        gameState.mapCells.push(cellData_complete);
        
        const cell = document.createElement('div');
        cell.className = `cell cell-${cellData.type} group has-tooltip relative`;
        cell.id = `cell-${i}`;
        cell.onclick = () => selectMapCell(i);
        cell.innerHTML = `
          <div class="text-3xl z-10">${cellData.icon}</div>
          <div class="cell-label">${cellData.name.substring(0, 12)}</div>
          <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-4 group-hover:visible group-hover:opacity-100 z-50">
            <div class="tooltip-content text-center max-w-xs">
              <div class="font-bold text-base">${cellData.name}</div>
              <div class="text-xs mt-2">${cellData.type === 'urban' ? 'üë• ' + cellData_complete.population.toLocaleString() + ' residents' : cellData.type === 'water' ? 'üíß Water body' : 'üå≥ Natural area'}</div>
              <div class="text-xs mt-1 opacity-80">${cellData.type === 'urban' ? 'Click to view actions' : 'Area monitoring active'}</div>
            </div>
            <div class="tooltip-arrow">
              <div class="tooltip-arrow-inner"></div>
            </div>
          </div>
        `;
        
        mapContainer.appendChild(cell);
      }
    }
    
    function selectMapCell(cellId) {
      gameState.selectedCell = cellId;
      const cell = gameState.mapCells[cellId];
      const infoPanel = document.getElementById('selected-cell-info');
      
      // Show info panel
      infoPanel.classList.remove('hidden');
      
      // Update cell name
      document.getElementById('cell-name').textContent = cell.name;
      
      // Update cell icon
      document.getElementById('cell-icon').textContent = cell.icon;
      
      // Update status with appropriate color and icon
      let statusText = '';
      let statusColor = '';
      let statusIcon = '';
      
      switch(cell.status) {
        case 'affected':
          statusText = `Affected (${cell.affected.toLocaleString()} people)`;
          statusColor = 'text-[var(--electric-pink)]';
          statusIcon = '‚ö†Ô∏è';
          break;
        case 'flooded':
          statusText = 'Flooded Zone';
          statusColor = 'text-[var(--electric-purple)]';
          statusIcon = 'üåä';
          break;
        case 'evacuated':
          statusText = 'Evacuation Zone';
          statusColor = 'text-[var(--electric-cyan)]';
          statusIcon = '‚úÖ';
          break;
        case 'safe':
          statusText = 'Safe Zone';
          statusColor = 'text-[var(--electric-green)]';
          statusIcon = 'üõ°Ô∏è';
          break;
        default:
          statusText = `Normal (Pop: ${cell.population.toLocaleString()})`;
          statusColor = 'text-[var(--electric-green)]';
          statusIcon = '‚úÖ';
      }
      
      document.getElementById('cell-status').innerHTML = `
        <span class="w-3 h-3 rounded-full mr-2 ${statusColor.replace('text', 'bg')}"></span>
        ${statusIcon} ${statusText}
      `;
      
      // Generate action buttons based on cell status
      const actionsDiv = document.getElementById('cell-actions');
      actionsDiv.innerHTML = '';
      
      if (cell.status === 'affected' && cell.affected > 0) {
        actionsDiv.innerHTML = `
          <button onclick="deployRescue(${cellId})" 
            class="px-5 py-2.5 bg-[var(--electric-cyan)] hover:bg-[var(--electric-cyan)]/90 text-white rounded-xl font-bold text-sm transition-all shadow-lg flex items-center gap-2 ripple">
            <span class="text-lg">üö£</span> Deploy Rescue Team
          </button>
          <button onclick="sendMedical(${cellId})" 
            class="px-5 py-2.5 bg-[var(--electric-purple)] hover:bg-[var(--electric-purple)]/90 text-white rounded-xl font-bold text-sm transition-all shadow-lg flex items-center gap-2 ripple">
            <span class="text-lg">üè•</span> Send Medical Aid
          </button>
        `;
      } else if (cell.type === 'urban' && cell.status === 'normal') {
        actionsDiv.innerHTML = `
          <button onclick="preEvacuate(${cellId})" 
            class="px-5 py-2.5 bg-[var(--electric-amber)] hover:bg-[var(--electric-amber)]/90 text-white rounded-xl font-bold text-sm transition-all shadow-lg flex items-center gap-2 ripple">
            <span class="text-lg">üì¢</span> Pre-Evacuate Area
          </button>
          <button onclick="deployMonitoring(${cellId})" 
            class="px-5 py-2.5 bg-[var(--deep-navy-3)] hover:bg-[var(--deep-navy-2)] text-[var(--electric-cyan)] border border-[var(--electric-cyan)]/30 rounded-xl font-bold text-sm transition-all shadow-lg flex items-center gap-2 ripple">
            <span class="text-lg">üëÅÔ∏è</span> Deploy Monitoring
          </button>
        `;
      } else if (cell.status === 'flooded') {
        actionsDiv.innerHTML = `
          <button onclick="deployRescue(${cellId})" 
            class="px-5 py-2.5 bg-[var(--electric-cyan)] hover:bg-[var(--electric-cyan)]/90 text-white rounded-xl font-bold text-sm transition-all shadow-lg flex items-center gap-2 ripple">
            <span class="text-lg">üö£</span> Water Rescue Operation
          </button>
          <button onclick="requestHelicopter(${cellId})" 
            class="px-5 py-2.5 bg-[var(--electric-pink)] hover:bg-[var(--electric-pink)]/90 text-white rounded-xl font-bold text-sm transition-all shadow-lg flex items-center gap-2 ripple">
            <span class="text-lg">üöÅ</span> Request Air Support
          </button>
        `;
      } else {
        actionsDiv.innerHTML = `
          <button onclick="closeCellInfo()" 
            class="px-5 py-2.5 bg-[var(--deep-navy-3)] hover:bg-[var(--deep-navy-2)] text-slate-300 rounded-xl font-medium text-sm transition-all">
            Close Details
          </button>
        `;
      }
    }
    
    function closeCellInfo() {
      document.getElementById('selected-cell-info').classList.add('hidden');
      gameState.selectedCell = null;
    }
    
    function deployRescue(cellId) {
      const cell = gameState.mapCells[cellId];
      
      // Check resources
      if (gameState.resources.rescue_boats.count < 1 || gameState.resources.responders.count < 5) {
        showNotification('‚ö†Ô∏è Insufficient resources for rescue operation!', 'error');
        return;
      }
      
      // Consume resources
      gameState.resources.rescue_boats.count = Math.max(0, gameState.resources.rescue_boats.count - 1);
      gameState.resources.responders.count = Math.max(0, gameState.resources.responders.count - 5);
      
      // Calculate rescued people
      const rescued = Math.min(cell.affected, 50);
      cell.affected -= rescued;
      cell.evacuated += rescued;
      gameState.evacuated += rescued;
      gameState.score += rescued * 2;
      
      // Update cell status if all affected people rescued
      if (cell.affected === 0) {
        cell.status = 'evacuated';
        updateCellVisual(cellId);
      }
      
      // Update UI
      updateStats();
      updateResourcesPanel();
      
      // Add communication log
      addCommLog(`üö£ Rescue team deployed to ${cell.name}. ${rescued} people rescued.`);
      
      // Show notification
      showNotification(`‚úÖ ${rescued} people rescued from ${cell.name}!`, 'success');
      
      // Keep cell info panel open with updated info
      selectMapCell(cellId);
      
      // Return resources after delay
      setTimeout(() => {
        gameState.resources.rescue_boats.count = Math.min(gameState.resources.rescue_boats.count + 1, gameState.resources.rescue_boats.max);
        gameState.resources.responders.count = Math.min(gameState.resources.responders.count + 5, gameState.resources.responders.max);
        updateResourcesPanel();
        addCommLog(`üö£ Rescue team returned from ${cell.name} and is ready for next deployment.`);
      }, 35000);
    }
    
    function sendMedical(cellId) {
      const cell = gameState.mapCells[cellId];
      
      if (gameState.resources.medical_teams.count < 1) {
        showNotification('‚ö†Ô∏è No medical teams available!', 'error');
        return;
      }
      
      gameState.resources.medical_teams.count -= 1;
      gameState.score += 30;
      
      // Reduce casualties
      const preventedCasualties = Math.min(5, Math.floor(cell.affected * 0.1));
      gameState.casualties = Math.max(0, gameState.casualties - preventedCasualties);
      
      updateStats();
      updateResourcesPanel();
      
      addCommLog(`üè• Medical team deployed to ${cell.name}. Health conditions stabilized.`);
      showNotification(`‚úÖ Medical aid delivered to ${cell.name}! ${preventedCasualties} potential casualties prevented.`, 'success');
      
      selectMapCell(cellId);
      
      // Return medical team after delay
      setTimeout(() => {
        gameState.resources.medical_teams.count = Math.min(gameState.resources.medical_teams.count + 1, gameState.resources.medical_teams.max);
        updateResourcesPanel();
        addCommLog(`üè• Medical team returned from ${cell.name}.`);
      }, 40000);
    }
    
    function preEvacuate(cellId) {
      const cell = gameState.mapCells[cellId];
      
      if (gameState.resources.responders.count < 3) {
        showNotification('‚ö†Ô∏è Not enough responders available for evacuation!', 'error');
        return;
      }
      
      gameState.resources.responders.count -= 3;
      const evacuated = Math.floor(cell.population * 0.5);
      
      cell.population -= evacuated;
      cell.evacuated += evacuated;
      gameState.evacuated += evacuated;
      gameState.score += evacuated;
      cell.status = 'evacuated';
      
      updateCellVisual(cellId);
      updateStats();
      updateResourcesPanel();
      
      addCommLog(`üì¢ Pre-emptive evacuation order issued for ${cell.name}. ${evacuated} residents moved to safety.`);
      showNotification(`‚úÖ ${evacuated} people evacuated from ${cell.name}!`, 'success');
      
      selectMapCell(cellId);
      
      // Return responders after delay
      setTimeout(() => {
        gameState.resources.responders.count = Math.min(gameState.resources.responders.count + 3, gameState.resources.responders.max);
        updateResourcesPanel();
        addCommLog(`‚úÖ Evacuation team returned from ${cell.name}.`);
      }, 25000);
    }
    
    function deployMonitoring(cellId) {
      const cell = gameState.mapCells[cellId];
      
      gameState.score += 20;
      addCommLog(`üëÅÔ∏è Monitoring deployed to ${cell.name}. Early warning system activated.`);
      showNotification(`‚úÖ Monitoring deployed to ${cell.name}. You'll receive alerts if conditions change.`, 'info');
      
      selectMapCell(cellId);
    }
    
    function requestHelicopter(cellId) {
      const cell = gameState.mapCells[cellId];
      
      if (gameState.resources.responders.count < 8) {
        showNotification('‚ö†Ô∏è Need at least 8 responders for helicopter operation!', 'error');
        return;
      }
      
      gameState.resources.responders.count -= 8;
      gameState.score += 80;
      
      const rescued = Math.min(cell.affected, 80);
      cell.affected -= rescued;
      cell.evacuated += rescued;
      gameState.evacuated += rescued;
      
      if (cell.affected === 0) {
        cell.status = 'evacuated';
        updateCellVisual(cellId);
      }
      
      updateStats();
      updateResourcesPanel();
      
      addCommLog(`üöÅ HELICOPTER DEPLOYED to ${cell.name}! ${rescued} people rescued from flooded area.`);
      showNotification(`‚úÖ AIR RESCUE SUCCESS! ${rescued} people rescued from ${cell.name} by helicopter!`, 'success');
      
      selectMapCell(cellId);
      
      // Return responders after longer delay
      setTimeout(() => {
        gameState.resources.responders.count = Math.min(gameState.resources.responders.count + 8, gameState.resources.responders.max);
        updateResourcesPanel();
        addCommLog(`üöÅ Helicopter team returned from ${cell.name}.`);
      }, 50000);
    }
    
    function updateCellVisual(cellId) {
      const cell = gameState.mapCells[cellId];
      const cellElement = document.getElementById(`cell-${cellId}`);
      
      // Update classes based on status
      let baseClass = `cell cell-${cell.type} group has-tooltip relative`;
      if (cell.status !== 'normal') {
        baseClass += ` cell-${cell.status}`;
      }
      
      cellElement.className = baseClass;
    }
    
    function affectRandomCells() {
      const urbanCells = gameState.mapCells.filter(c => c.type === 'urban' && c.status === 'normal');
      if (urbanCells.length === 0) return;
      
      // Determine number of cells to affect based on scenario phase
      const numToAffect = Math.min(
        Math.floor(Math.random() * 3) + 1, 
        urbanCells.length,
        Math.ceil((gameState.currentPhase + 1) / 2)
      );
      
      for (let i = 0; i < numToAffect; i++) {
        if (urbanCells.length === 0) break;
        
        const randomIndex = Math.floor(Math.random() * urbanCells.length);
        const cell = urbanCells[randomIndex];
        const affected = Math.floor(cell.population * (Math.random() * 0.3 + 0.2));
        
        cell.affected = affected;
        cell.status = Math.random() > 0.5 ? 'affected' : 'flooded';
        gameState.affected += affected;
        
        updateCellVisual(cell.id);
        urbanCells.splice(randomIndex, 1);
        
        // Add communication log for each affected area
        addCommLog(`‚ö†Ô∏è ${cell.name} reporting ${affected} people in distress! Status: ${cell.status.toUpperCase()}`);
        
        // Show notification for first affected area
        if (i === 0) {
          showNotification(`üö® EMERGENCY: ${cell.name} requires immediate assistance!`, 'error');
        }
      }
      
      updateStats();
    }
    
    // ===== RESOURCES MANAGEMENT =====
    function updateResourcesPanel() {
      const panel = document.getElementById('resources-panel');
      panel.innerHTML = '';
      
      Object.entries(gameState.resources).forEach(([key, resource]) => {
        const percentage = (resource.count / resource.max) * 100;
        let colorClass = 'bg-[var(--electric-green)]';
        let barColor = 'bg-[var(--electric-green)]';
        
        if (percentage < 30) {
          colorClass = 'bg-[var(--electric-pink)]';
          barColor = 'bg-[var(--electric-pink)]';
        } else if (percentage < 60) {
          colorClass = 'bg-[var(--electric-amber)]';
          barColor = 'bg-[var(--electric-amber)]';
        }
        
        const card = document.createElement('div');
        card.className = 'resource-card glass-panel rounded-xl p-4 border border-[var(--game-border)]/30';
        card.innerHTML = `
          <div class="flex items-center justify-between mb-3">
            <span class="text-base font-medium text-slate-200">${resource.name}</span>
            <span class="text-lg font-bold ${colorClass}">${resource.count}/${resource.max}</span>
          </div>
          <div class="flex items-center gap-3">
            <div class="flex-1 bg-[var(--deep-navy-3)] rounded-full h-3 overflow-hidden">
              <div class="progress-bar ${barColor} h-3 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
            </div>
            <span class="text-sm font-medium text-slate-300">${Math.round(percentage)}%</span>
          </div>
        `;
        
        panel.appendChild(card);
      });
    }
    
    // ===== EVENTS & DECISIONS =====
    function triggerNextEvent() {
      const scenario = scenarios[gameState.scenario];
      
      // Check if simulation is complete
      if (gameState.currentPhase >= scenario.events.length) {
        endGame();
        return;
      }
      
      // Affect some map cells before showing event
      affectRandomCells();
      
      const event = scenario.events[gameState.currentPhase];
      gameState.currentEvent = event;
      
      // Display decision
      displayDecision(event);
      
      gameState.currentPhase++;
    }
    
    function displayDecision(event) {
      const decisionPanel = document.getElementById('current-decision');
      
      // Create options HTML
      const optionsHTML = event.options.map((option, index) => `
        <button onclick="makeDecision(${index})"
          class="decision-btn w-full p-4 bg-[var(--deep-navy-2)] hover:bg-[var(--deep-navy-3)] border border-[var(--game-border)] hover:border-[var(--electric-cyan)] rounded-xl text-left text-base transition-all group ripple">
          <span class="text-slate-200 font-medium">${option.text}</span>
          <div class="mt-2 text-sm text-slate-400 opacity-90">${option.feedback}</div>
        </button>
      `).join('');
      
      decisionPanel.innerHTML = `
        <div class="mb-5">
          <div class="flex items-center gap-3 mb-3">
            <span class="text-3xl">${event.title.substring(0, 2)}</span>
            <h4 class="font-bold text-xl text-[var(--electric-cyan)]">${event.title}</h4>
          </div>
          <p class="text-slate-300 text-base leading-relaxed">${event.description}</p>
        </div>
        <div class="space-y-3 mb-6">
          ${optionsHTML}
        </div>
        <div class="mt-4 pt-4 border-t border-[var(--game-border)] text-center text-sm text-slate-400">
          üìä Phase ${gameState.currentPhase} of ${scenarios[gameState.scenario].events.length} ‚Ä¢ Make your decision quickly but carefully
        </div>
      `;
    }
    
    function makeDecision(optionIndex) {
      const event = gameState.currentEvent;
      const option = event.options[optionIndex];
      const effect = option.effect;
      
      // Store decision
      gameState.decisions.push({
        phase: gameState.currentPhase,
        event: event.title,
        choice: option.text,
        feedback: option.feedback
      });
      
      // Apply effects
      if (effect.evacuated) {
        gameState.evacuated += effect.evacuated;
      }
      if (effect.affected) {
        gameState.affected += effect.affected;
      }
      if (effect.casualties) {
        gameState.casualties += effect.casualties;
      }
      if (effect.score) {
        gameState.score += effect.score;
      }
      if (effect.time) {
        gameState.timeRemaining += effect.time;
      }
      if (effect.resources) {
        Object.entries(effect.resources).forEach(([key, value]) => {
          if (gameState.resources[key]) {
            gameState.resources[key].count = Math.max(0, gameState.resources[key].count + value);
          }
        });
      }
      if (effect.metrics) {
        Object.entries(effect.metrics).forEach(([key, value]) => {
          if (gameState.metrics[key] !== undefined) {
            gameState.metrics[key] = Math.max(0, Math.min(100, gameState.metrics[key] + value));
          }
        });
      }
      
      // Update UI
      updateStats();
      updateResourcesPanel();
      
      // Show feedback notification
      const notificationType = effect.score > 50 ? 'success' : effect.score > 20 ? 'warning' : 'error';
      showNotification(`üìã Decision: ${option.feedback}`, notificationType);
      
      // Add to communication log
      addCommLog(`üìù Decision made: ${option.text.substring(0, 60)}${option.text.length > 60 ? '...' : ''}`);
      
      // Show transition message
      const decisionPanel = document.getElementById('current-decision');
      decisionPanel.innerHTML = `
        <div class="text-center py-10">
          <div class="text-5xl mb-4 animate-pulse">‚è≥</div>
          <p class="text-xl text-slate-300 font-medium mb-2">Processing response...</p>
          <p class="text-base text-[var(--electric-cyan)] mt-3">${option.feedback}</p>
          <div class="mt-6 flex justify-center">
            <div class="w-16 h-16 border-4 border-[var(--electric-cyan)] border-t-transparent rounded-full animate-spin"></div>
          </div>
        </div>
      `;
      
      // Trigger next event after delay
      setTimeout(() => triggerNextEvent(), 3500);
    }
    
    // ===== TIMER & STATS =====
    function startTimer() {
      if (gameState.timerInterval) {
        clearInterval(gameState.timerInterval);
      }
      
      gameState.timerInterval = setInterval(() => {
        gameState.timeRemaining--;
        updateTimerDisplay();
        
        // End game if time runs out
        if (gameState.timeRemaining <= 0) {
          endGame();
        }
      }, 1000);
    }
    
    function updateTimerDisplay() {
      const minutes = Math.floor(gameState.timeRemaining / 60);
      const seconds = gameState.timeRemaining % 60;
      
      const timerElement = document.getElementById('game-timer');
      timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      // Change color when time is low
      if (gameState.timeRemaining <= 60) {
        timerElement.classList.add('text-[var(--electric-pink)]');
        timerElement.classList.add('animate-pulse');
      } else {
        timerElement.classList.remove('text-[var(--electric-pink)]');
        timerElement.classList.remove('animate-pulse');
      }
    }
    
    function updateStats() {
      document.getElementById('stat-evacuated').textContent = gameState.evacuated.toLocaleString();
      document.getElementById('stat-affected').textContent = gameState.affected.toLocaleString();
      document.getElementById('stat-casualties').textContent = gameState.casualties.toLocaleString();
      document.getElementById('current-score').textContent = gameState.score.toLocaleString();
      
      // Update population stat (total affected + evacuated + safe)
      const safePopulation = gameState.population - gameState.affected - gameState.evacuated - gameState.casualties;
      document.getElementById('stat-population').textContent = gameState.population.toLocaleString();
    }
    
    // ===== COMMUNICATION LOG =====
    function addCommLog(message) {
      const logContainer = document.getElementById('comm-log');
      const time = new Date().toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit',
        hour12: false 
      });
      
      // Create log entry with appropriate color coding
      let prefix = '[INFO]';
      let colorClass = 'text-slate-400';
      
      if (message.includes('EOC activated')) {
        prefix = '[SYSTEM]';
        colorClass = 'text-[var(--electric-cyan)] font-medium';
      } else if (message.includes('Simulation starting')) {
        prefix = '[READY]';
        colorClass = 'text-[var(--electric-green)] font-medium';
      } else if (message.includes('EMERGENCY') || message.includes('reporting')) {
        prefix = '[ALERT]';
        colorClass = 'text-[var(--electric-pink)] font-bold';
      } else if (message.includes('rescued') || message.includes('evacuated')) {
        prefix = '[SUCCESS]';
        colorClass = 'text-[var(--electric-green)] font-medium';
      } else if (message.includes('Deployed') || message.includes('deployed')) {
        prefix = '[ACTION]';
        colorClass = 'text-[var(--electric-purple)] font-medium';
      }
      
      const entry = document.createElement('div');
      entry.className = 'notification-slide flex items-start gap-2';
      entry.innerHTML = `
        <span class="text-xs text-slate-500 min-w-[60px]">${time}</span>
        <span class="${colorClass}">${prefix}</span>
        <span>${message}</span>
      `;
      
      logContainer.insertBefore(entry, logContainer.firstChild);
      
      // Keep only last 15 entries
      while (logContainer.children.length > 15) {
        logContainer.removeChild(logContainer.lastChild);
      }
      
      // Auto-scroll to top
      logContainer.scrollTop = 0;
    }
    
    // ===== NOTIFICATIONS =====
    function showNotification(message, type = 'info') {
      const container = document.getElementById('notification-container');
      
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification ${type} glass-panel p-4 rounded-xl shadow-xl max-w-sm animate-slideIn`;
      
      // Set icon and color based on type
      let icon = '‚ÑπÔ∏è';
      switch(type) {
        case 'success':
          icon = '‚úÖ';
          break;
        case 'error':
          icon = 'üö®';
          break;
        case 'warning':
          icon = '‚ö†Ô∏è';
          break;
        case 'info':
          icon = '‚ÑπÔ∏è';
          break;
      }
      
      notification.innerHTML = `
        <div class="flex items-start gap-3">
          <span class="text-2xl flex-shrink-0">${icon}</span>
          <div class="flex-1">
            <p class="font-medium">${message}</p>
            <p class="text-xs text-slate-400 mt-1">EOC Simulation ‚Ä¢ ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
          </div>
        </div>
      `;
      
      container.appendChild(notification);
      
      // Auto-remove after delay
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 5000);
    }
    
    // ===== GAME END =====
    function endGame() {
      if (gameState.timerInterval) {
        clearInterval(gameState.timerInterval);
      }
      
      // Calculate final metrics
      const totalPopulation = gameState.population;
      const livesSaved = gameState.evacuated;
      const casualtyRate = (gameState.casualties / totalPopulation) * 100;
      
      const resourcesUsed = Object.values(gameState.resources).reduce((acc, r) => acc + (r.max - r.count), 0);
      const totalResources = Object.values(gameState.resources).reduce((acc, r) => acc + r.max, 0);
      const resourceEfficiency = Math.round(((totalResources - resourcesUsed) / totalResources) * 100);
      
      // Determine result tier and message
      let resultIcon = 'üèÜ';
      let resultMessage = 'Outstanding emergency response performance!';
      
      if (gameState.casualties > 50) {
        resultIcon = 'üòî';
        resultMessage = 'The situation was extremely challenging. Review your decisions to identify improvement opportunities for future responses.';
      } else if (gameState.casualties > 20) {
        resultIcon = 'üìà';
        resultMessage = 'Good effort under pressure! Focus on faster response times and resource allocation to improve outcomes.';
      } else if (gameState.casualties > 5) {
        resultIcon = 'üëç';
        resultMessage = 'Well done! Your response saved many lives. Continue refining your decision-making process.';
      } else if (gameState.casualties === 0 && gameState.score > 500) {
        resultIcon = 'üåü';
        resultMessage = 'PERFECT RESPONSE! Zero casualties with excellent resource management. You demonstrated exceptional emergency leadership.';
      }
      
      // Update results screen
      document.getElementById('result-icon').textContent = resultIcon;
      document.getElementById('result-message').textContent = resultMessage;
      document.getElementById('result-score').textContent = gameState.score.toLocaleString();
      document.getElementById('result-saved').textContent = livesSaved.toLocaleString();
      document.getElementById('result-efficiency').textContent = resourceEfficiency + '%';
      document.getElementById('result-decisions').textContent = gameState.decisions.length;
      
      // Generate performance bars
      const performanceBars = document.getElementById('performance-bars');
      performanceBars.innerHTML = `
        <div class="space-y-4">
          <div>
            <div class="flex justify-between mb-1.5">
              <span class="text-sm font-medium text-slate-300">Response Speed</span>
              <span class="text-sm font-bold text-[var(--electric-cyan)]">${Math.min(100, 100 - (gameState.casualties * 2))}%</span>
            </div>
            <div class="w-full bg-[var(--deep-navy-3)] rounded-full h-3 overflow-hidden">
              <div class="bg-[var(--electric-cyan)] h-3 rounded-full transition-all duration-1000" style="width: ${Math.min(100, 100 - (gameState.casualties * 2))}%"></div>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between mb-1.5">
              <span class="text-sm font-medium text-slate-300">Resource Management</span>
              <span class="text-sm font-bold text-[var(--electric-green)]">${resourceEfficiency}%</span>
            </div>
            <div class="w-full bg-[var(--deep-navy-3)] rounded-full h-3 overflow-hidden">
              <div class="bg-[var(--electric-green)] h-3 rounded-full transition-all duration-1000" style="width: ${resourceEfficiency}%"></div>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between mb-1.5">
              <span class="text-sm font-medium text-slate-300">Communication</span>
              <span class="text-sm font-bold text-[var(--electric-purple)]">${gameState.metrics.communicationScore}%</span>
            </div>
            <div class="w-full bg-[var(--deep-navy-3)] rounded-full h-3 overflow-hidden">
              <div class="bg-[var(--electric-purple)] h-3 rounded-full transition-all duration-1000" style="width: ${gameState.metrics.communicationScore}%"></div>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between mb-1.5">
              <span class="text-sm font-medium text-slate-300">Lives Saved</span>
              <span class="text-sm font-bold text-[var(--electric-amber)]">${Math.min(100, Math.round((livesSaved / 2000) * 100))}%</span>
            </div>
            <div class="w-full bg-[var(--deep-navy-3)] rounded-full h-3 overflow-hidden">
              <div class="bg-[var(--electric-amber)] h-3 rounded-full transition-all duration-1000" style="width: ${Math.min(100, Math.round((livesSaved / 2000) * 100))}%"></div>
            </div>
          </div>
        </div>
      `;
      
      // Generate feedback
      const feedbackList = document.getElementById('feedback-list');
      let feedbackHTML = '';
      
      // Add feedback from last 3 decisions
      gameState.decisions.slice(-3).forEach(d => {
        feedbackHTML += `<li class="flex items-start gap-2"><span class="text-[var(--electric-cyan)]">‚Ä¢</span> ${d.feedback}</li>`;
      });
      
      // Add special achievements
      if (gameState.casualties === 0) {
        feedbackHTML += '<li class="text-[var(--electric-green)] flex items-start gap-2"><span>‚òÖ</span> <span>Zero casualties achieved! Exceptional leadership and rapid response.</span></li>';
      }
      if (resourceEfficiency > 85) {
        feedbackHTML += '<li class="text-[var(--electric-cyan)] flex items-start gap-2"><span>‚òÖ</span> <span>Outstanding resource efficiency demonstrated throughout the simulation.</span></li>';
      }
      if (gameState.evacuated > 2500) {
        feedbackHTML += '<li class="text-[var(--electric-amber)] flex items-start gap-2"><span>‚òÖ</span> <span>Mass evacuation successfully coordinated with minimal disruption.</span></li>';
      }
      if (gameState.metrics.communicationScore > 90) {
        feedbackHTML += '<li class="text-[var(--electric-purple)] flex items-start gap-2"><span>‚òÖ</span> <span>Excellent communication strategy maintained throughout the crisis.</span></li>';
      }
      
      // Add improvement suggestions if needed
      if (gameState.casualties > 30) {
        feedbackHTML += '<li class="text-[var(--electric-pink)] flex items-start gap-2"><span>üí°</span> <span>Consider faster deployment of rescue resources in future scenarios to reduce casualties.</span></li>';
      }
      if (resourceEfficiency < 60) {
        feedbackHTML += '<li class="text-[var(--electric-pink)] flex items-start gap-2"><span>üí°</span> <span>Resource allocation could be optimized - focus on high-impact areas first.</span></li>';
      }
      
      feedbackList.innerHTML = feedbackHTML || '<li>No specific feedback available for this simulation.</li>';
      
      // Save to Data SDK
      saveGameRecord(resourceEfficiency);
      
      // Show results screen
      showScreen('results-screen');
      
      // Add final communication log
      addCommLog('üèÅ SIMULATION COMPLETE');
      addCommLog(`üìä Final Score: ${gameState.score.toLocaleString()} ‚Ä¢ Lives Saved: ${gameState.evacuated.toLocaleString()} ‚Ä¢ Casualties: ${gameState.casualties.toLocaleString()}`);
    }
    
    async function saveGameRecord(resourceEfficiency) {
      if (!window.dataSdk) return;
      
      // Don't save if we already have 1000 records
      if (gameRecords.length >= 1000) {
        console.log('Maximum records reached');
        return;
      }
      
      const record = {
        session_id: Date.now().toString(),
        player_name: gameState.playerName,
        role: gameState.role,
        scenario: gameState.scenario,
        score: gameState.score,
        casualties_prevented: gameState.evacuated,
        resources_efficiency: resourceEfficiency,
        response_time: 900 - gameState.timeRemaining,
        decisions_made: gameState.decisions.length,
        completed_at: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(record);
      if (!result.isOk) {
        console.error('Failed to save game record');
      }
    }
    
    // ===== LEADERBOARD =====
    function showLeaderboard() {
      document.getElementById('leaderboard-modal').classList.remove('hidden');
      updateLeaderboardDisplay();
    }
    
    function hideLeaderboard() {
      document.getElementById('leaderboard-modal').classList.add('hidden');
    }
    
    function updateLeaderboardDisplay() {
      const content = document.getElementById('leaderboard-content');
      
      if (!gameRecords || gameRecords.length === 0) {
        content.innerHTML = `
          <div class="text-center py-12">
            <div class="text-6xl mb-4 opacity-20">üìä</div>
            <p class="text-xl text-slate-400 mb-2">No training records yet</p>
            <p class="text-slate-500">Complete a simulation to save your score and appear on the leaderboard!</p>
          </div>
        `;
        return;
      }
      
      // Sort records by score (descending) and take top 10
      const sortedRecords = [...gameRecords]
        .sort((a, b) => b.score - a.score)
        .slice(0, 15);
      
      // Generate leaderboard HTML
      content.innerHTML = sortedRecords.map((record, index) => {
        // Get scenario icon
        const scenarioIcon = record.scenario === 'typhoon' ? 'üåÄ' : 
                             record.scenario === 'earthquake' ? 'üèöÔ∏è' : 'üåä';
        
        // Format date
        const date = new Date(record.completed_at).toLocaleDateString('en-PH', { 
          month: 'short', 
          day: 'numeric',
          year: 'numeric'
        });
        
        // Determine medal icon
        let medalIcon = 'üèÖ';
        if (index === 0) medalIcon = 'ü•á';
        else if (index === 1) medalIcon = 'ü•à';
        else if (index === 2) medalIcon = 'ü•â';
        
        // Determine role display name
        const roleNames = {
          incident_commander: 'Incident Commander',
          operations: 'Operations Chief',
          logistics: 'Logistics Chief',
          information: 'PIO'
        };
        
        return `
          <div class="leaderboard-entry glass-panel rounded-xl p-4 flex items-center gap-4 border border-[var(--game-border)]/30 hover:border-[var(--electric-cyan)]/50">
            <div class="flex-shrink-0 w-10 h-10 rounded-full bg-[var(--deep-navy-3)] flex items-center justify-center font-bold text-lg ${index < 3 ? 'text-[var(--electric-amber)]' : 'text-slate-400'}">
              ${medalIcon}
            </div>
            <div class="flex-1 min-w-0">
              <div class="font-bold text-lg text-slate-200 truncate">${record.player_name}</div>
              <div class="text-xs text-slate-400 mt-0.5 flex flex-wrap items-center gap-2">
                <span class="flex items-center gap-1"><span class="text-[var(--electric-cyan)]">${scenarioIcon}</span> ${record.scenario.replace('_', ' ')}</span>
                <span class="flex items-center gap-1"><span class="text-[var(--electric-purple)]">üéØ</span> ${roleNames[record.role] || record.role}</span>
                <span>${date}</span>
              </div>
            </div>
            <div class="text-right flex-shrink-0">
              <div class="font-bold text-2xl text-[var(--electric-cyan)]">${record.score.toLocaleString()}</div>
              <div class="text-xs text-slate-400 mt-0.5">points</div>
              <div class="text-[10px] text-[var(--electric-green)] mt-1">${record.casualties_prevented.toLocaleString()} lives saved</div>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // ===== UTILITY FUNCTIONS =====
    function restartGame() {
      showScreen('scenario-screen');
    }
    
    function returnToTitle() {
      showScreen('title-screen');
      
      // Reset game state
      gameState = {
        playerName: '',
        role: '',
        scenario: '',
        score: 0,
        timeRemaining: 900,
        timerInterval: null,
        currentPhase: 0,
        decisions: [],
        population: 12450,
        evacuated: 0,
        affected: 0,
        casualties: 0,
        resources: {
          rescue_boats: { name: 'üö£ Rescue Boats', count: 8, max: 8 },
          medical_teams: { name: 'üè• Medical Teams', count: 5, max: 5 },
          evacuation_trucks: { name: 'üöõ Evac Trucks', count: 6, max: 6 },
          relief_packs: { name: 'üì¶ Relief Packs', count: 500, max: 500 },
          responders: { name: 'üë∑ Responders', count: 50, max: 50 }
        },
        mapCells: [],
        selectedCell: null,
        eventQueue: [],
        currentEvent: null,
        metrics: {
          responseTime: 0,
          resourceEfficiency: 100,
          communicationScore: 100,
          decisionQuality: 100
        }
      };
      
      // Clear communication log
      document.getElementById('comm-log').innerHTML = `
        <div class="text-slate-500 flex items-start gap-2">
          <span class="text-[var(--electric-cyan)] font-medium">[SYSTEM]</span>
          <span>EOC simulation platform ready</span>
        </div>
        <div class="text-slate-500 flex items-start gap-2">
          <span class="text-[var(--electric-green)] font-medium">[READY]</span>
          <span>Select role and scenario to begin training</span>
        </div>
      `;
    }
    
    // ===== INITIALIZATION =====
    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
</body>
</html>
